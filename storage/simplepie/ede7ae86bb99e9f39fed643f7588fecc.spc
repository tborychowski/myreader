a:4:{s:5:"child";a:1:{s:0:"";a:1:{s:3:"rss";a:1:{i:0;a:6:{s:4:"data";s:1:" ";s:7:"attribs";a:1:{s:0:"";a:1:{s:7:"version";s:3:"2.0";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:0:"";a:1:{s:7:"channel";a:1:{i:0;a:6:{s:4:"data";s:18:"                  ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:4:{s:0:"";a:8:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:8:"Nettuts+";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:23:"http://net.tutsplus.com";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:34:"Web Development & Design Tutorials";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:13:"lastBuildDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Sat, 04 May 2013 22:52:05 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"language";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:9:"generator";a:1:{i:0;a:5:{s:4:"data";s:27:"http://wordpress.org/?v=3.5";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:5:"image";a:1:{i:0;a:6:{s:4:"data";s:0:"";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:1:{s:0:"";a:3:{s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:18:"http://nettuts.com";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:3:"url";a:1:{i:0;a:5:{s:4:"data";s:53:"http://envato.s3.amazonaws.com/rss_images/nettuts.jpg";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:7:"NETTUTS";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}}s:4:"item";a:10:{i:0;a:6:{s:4:"data";s:11:"           ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:5:{s:0:"";a:8:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:37:"Python Power Tools: virtualenvwrapper";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:54:"http://feedproxy.google.com/~r/nettuts/~3/_UPwiylkSos/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:97:"http://net.tutsplus.com/tutorials/python-tutorials/python-power-tools-virtualenvwrapper/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Fri, 03 May 2013 16:00:38 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:2:{i:0;a:5:{s:4:"data";s:6:"Python";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:1;a:5:{s:4:"data";s:6:"Videos";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:32:"http://net.tutsplus.com/?p=31569";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:2283:"<a
href='http://rss.buysellads.com/click.php?z=1260013&k=d754f1e9ba63a736ba8ff5ece958f7dd&a=31569&c=2034314006' target='_blank'><img
src='http://rss.buysellads.com/img.php?z=1260013&k=d754f1e9ba63a736ba8ff5ece958f7dd&a=31569&c=2034314006' border='0' alt='' /></a><p>In this series of videos, I&#8217;ll introduce you to several tools that you can add to your arsenal to become a better, more productive, programmer. In this episode, we&#8217;ll review a powerful companion app, <a
href="http://virtualenvwrapper.readthedocs.org/en/latest/">virtualenvwrapper</a>, that wraps virtualenv in a user friendly set of shell functions.<br
/> <span
id="more-31569"></span></p> <figure
class=tutorial_image> <iframe
width="600" height="338" src="http://www.youtube.com/embed/UcbUXq0wd-8?list=UUd-EhXGbXSozuzsAAdPIn3A" frameborder="0" allowfullscreen></iframe></p> <figcaption><a
href="http://tutsplus-media.s3.amazonaws.com/net.tutsplus.com/video/Python-Power-Tools-virtualenvwrapper.mp4"><strong>Download Video</strong></a></figcaption> </figure><blockquote><p> Hoping to dig into Django? Let me teach you in my Tuts+ Premium course: <a
href="https://tutsplus.com/course/django-unchained/">Django Unchained</a>!</p></blockquote><div class="feedflare">
<a href="http://feeds.feedburner.com/~ff/nettuts?a=_UPwiylkSos:PBnZHLtH28Y:yIl2AUoC8zA"><img src="http://feeds.feedburner.com/~ff/nettuts?d=yIl2AUoC8zA" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=_UPwiylkSos:PBnZHLtH28Y:F7zBnMyn0Lo"><img src="http://feeds.feedburner.com/~ff/nettuts?i=_UPwiylkSos:PBnZHLtH28Y:F7zBnMyn0Lo" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=_UPwiylkSos:PBnZHLtH28Y:V_sGLiPBpWU"><img src="http://feeds.feedburner.com/~ff/nettuts?i=_UPwiylkSos:PBnZHLtH28Y:V_sGLiPBpWU" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=_UPwiylkSos:PBnZHLtH28Y:gIN9vFwOqvQ"><img src="http://feeds.feedburner.com/~ff/nettuts?i=_UPwiylkSos:PBnZHLtH28Y:gIN9vFwOqvQ" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=_UPwiylkSos:PBnZHLtH28Y:TzevzKxY174"><img src="http://feeds.feedburner.com/~ff/nettuts?d=TzevzKxY174" border="0"></img></a>
</div><img src="http://feeds.feedburner.com/~r/nettuts/~4/_UPwiylkSos" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:9:"enclosure";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:3:{s:3:"url";s:102:"http://tutsplus-media.s3.amazonaws.com/net.tutsplus.com/video/Python-Power-Tools-virtualenvwrapper.mp4";s:6:"length";s:9:"239996851";s:4:"type";s:9:"video/mp4";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:17:"Christopher Roach";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:93:"http://net.tutsplus.com/tutorials/python-tutorials/python-power-tools-virtualenvwrapper/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:38:"http://purl.org/rss/1.0/modules/slash/";a:1:{s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:1:"2";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:88:"http://net.tutsplus.com/tutorials/python-tutorials/python-power-tools-virtualenvwrapper/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:1;a:6:{s:4:"data";s:11:"           ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:5:{s:0:"";a:8:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:30:"Python Power Tools: virtualenv";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:54:"http://feedproxy.google.com/~r/nettuts/~3/c_4JQDITxTQ/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:90:"http://net.tutsplus.com/tutorials/python-tutorials/python-power-tools-virtualenv/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Thu, 02 May 2013 16:42:19 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:2:{i:0;a:5:{s:4:"data";s:6:"Python";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:1;a:5:{s:4:"data";s:6:"Videos";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:32:"http://net.tutsplus.com/?p=31560";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:2284:"<a
href='http://rss.buysellads.com/click.php?z=1260013&k=d754f1e9ba63a736ba8ff5ece958f7dd&a=31560&c=129790427' target='_blank'><img
src='http://rss.buysellads.com/img.php?z=1260013&k=d754f1e9ba63a736ba8ff5ece958f7dd&a=31560&c=129790427' border='0' alt='' /></a><p>In this series of videos, I&#8217;ll introduce you to several tools that you can add to your arsenal to become a better, more productive, programmer. We&#8217;ll begin with <a
href="https://pypi.python.org/pypi/virtualenv">virtualenv</a>, which allows you to create isolated development environments for installing and upgrading software, without needing to worry about overrides or dependency issues.<br
/> <span
id="more-31560"></span></p> <figure
class=tutorial_image> <iframe
width="600" height="338" src="http://www.youtube.com/embed/IX-v6yvGYFg" frameborder="0" allowfullscreen></iframe></p> <figcaption><a
href="http://tutsplus-media.s3.amazonaws.com/net.tutsplus.com/video/Python-Power-Tools-virtualenv.mp4"><strong>Download Video</strong></a></figcaption> </figure><blockquote><p> Hoping to dig into Django? Let me teach you in my Tuts+ Premium course: <a
href="https://tutsplus.com/course/django-unchained/">Django Unchained</a>!</p></blockquote><div class="feedflare">
<a href="http://feeds.feedburner.com/~ff/nettuts?a=c_4JQDITxTQ:TPCyLbMQYvE:yIl2AUoC8zA"><img src="http://feeds.feedburner.com/~ff/nettuts?d=yIl2AUoC8zA" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=c_4JQDITxTQ:TPCyLbMQYvE:F7zBnMyn0Lo"><img src="http://feeds.feedburner.com/~ff/nettuts?i=c_4JQDITxTQ:TPCyLbMQYvE:F7zBnMyn0Lo" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=c_4JQDITxTQ:TPCyLbMQYvE:V_sGLiPBpWU"><img src="http://feeds.feedburner.com/~ff/nettuts?i=c_4JQDITxTQ:TPCyLbMQYvE:V_sGLiPBpWU" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=c_4JQDITxTQ:TPCyLbMQYvE:gIN9vFwOqvQ"><img src="http://feeds.feedburner.com/~ff/nettuts?i=c_4JQDITxTQ:TPCyLbMQYvE:gIN9vFwOqvQ" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=c_4JQDITxTQ:TPCyLbMQYvE:TzevzKxY174"><img src="http://feeds.feedburner.com/~ff/nettuts?d=TzevzKxY174" border="0"></img></a>
</div><img src="http://feeds.feedburner.com/~r/nettuts/~4/c_4JQDITxTQ" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:9:"enclosure";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:3:{s:3:"url";s:95:"http://tutsplus-media.s3.amazonaws.com/net.tutsplus.com/video/Python-Power-Tools-virtualenv.mp4";s:6:"length";s:9:"269879129";s:4:"type";s:9:"video/mp4";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:17:"Christopher Roach";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:86:"http://net.tutsplus.com/tutorials/python-tutorials/python-power-tools-virtualenv/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:38:"http://purl.org/rss/1.0/modules/slash/";a:1:{s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:1:"7";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:81:"http://net.tutsplus.com/tutorials/python-tutorials/python-power-tools-virtualenv/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:2;a:6:{s:4:"data";s:10:"          ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:5:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:26:"Getting Into Ember: Part 4";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:54:"http://feedproxy.google.com/~r/nettuts/~3/q1Zzl1QOgbk/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:85:"http://net.tutsplus.com/tutorials/javascript-ajax/getting-into-ember-part-4/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Tue, 30 Apr 2013 19:15:34 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:2:{i:0;a:5:{s:4:"data";s:17:"JavaScript & AJAX";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:1;a:5:{s:4:"data";s:5:"ember";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:32:"http://net.tutsplus.com/?p=31517";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:19090:"<a
href='http://rss.buysellads.com/click.php?z=1260013&k=d754f1e9ba63a736ba8ff5ece958f7dd&a=31517&c=879627671' target='_blank'><img
src='http://rss.buysellads.com/img.php?z=1260013&k=d754f1e9ba63a736ba8ff5ece958f7dd&a=31517&c=879627671' border='0' alt='' /></a><p>In my <a
href="http://net.tutsplus.com/tutorials/javascript-ajax/getting-into-ember-js-part-3/">previous tutorial</a>, I touched on how to use <code>Ember.Object</code> to define your models and work with datasets. In this section, we&#8217;ll look more closely at how Ember uses the <a
href="http://handlebarsjs.com/">Handlebars templating framework</a> to define your app&#39;s user interface.</p><p><span
id="more-31517"></span></p><hr
/><h2>Client-side Templates</h2><p>Most server-side developers are used to using templates to define markup that will be dynamically filled on the fly. If you&#39;ve ever used ASP.NET, ColdFusion, PHP or Rails then it&#39;s pretty much assured you know what I&#39;m talking about.</p><p>JavaScript Client-side templating has really taken off of late especially because of the focus on building more desktop-like experiences. This means that more of the processing is done on the client-side with data being mainly pulled via server-side API requests.</p><p>I remember writing about client-side templates some time ago when the <a
href="http://blog.reybango.com/2010/07/09/not-using-jquery-javascript-templates-youre-really-missing-out/">jQuery Template plugin</a> was first released. Nearly three years later, it&#39;s still the most read post on my blog, showing how interest in client-side templating has risen.  Since then, a number of other frameworks have been released, offering rich features and supportive communities. <a
href="http://handlebarsjs.com/">Handlebars</a> is one of the more popular options and the framework chosen by the Ember project to power it&#39;s templating needs. This makes sense as Handlerbars was created by Ember.js co-founder and core team member, <a
href="https://twitter.com/wycats">Yehuda Katz</a>. Note, though, that I&#39;m not planning on doing comparisons between templating frameworks and I will strictly focus on Handelbars since this is what Ember.js uses by default.</p><p>In the previous articles, I showed some very basic templates in the code:</p><pre class="brush: xml; title: ; notranslate">
&lt;script type=&quot;text/x-handlebars&quot;&gt;
    &lt;h2&gt;&lt;strong&gt;{{firstName}} {{lastName}}&lt;/strong&gt;&lt;/h2&gt;
&lt;/script&gt;
</pre><p>Two things that stand out are the type declaration for the script tag and the curly braces which act as delimiters for the expressions that Handlebars will act upon. This is very typical syntax that I&#39;ll discuss in more detail soon and you&#39;ll use consistently as you build Ember templates.</p><hr
/><h2>The Syntax</h2><p>Despite the fact that Handlebars uses a special syntax, at the end of the day, you&#39;re really working primarily with standard HTML markup. Handlebars serves to inject content into this markup to render data to the user. It does this by parsing the delimited expressions and replacing them with the data you&#39;ve asked Handlebars to work with. In the case of Ember, Handlebars provides the hooks and Ember uses them. That data typically comes from your controller (remember that controllers serve as the interface to your models).</p><p>The first thing any template needs is a script tag definition. Most of you have probably defined script tags to load your JavaScript library. In fact, you&#39;ve already done this to load Handlebars into your Ember project:</p><pre class="brush: xml; title: ; notranslate">
&lt;script src=&quot;js/libs/jquery-1.9.1.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;js/libs/handlebars-1.0.0-rc.3.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;js/libs/ember-1.0.0-rc.1.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;js/app.js&quot;&gt;&lt;/script&gt;
</pre><p>There&#39;s a slight difference with using it to define a template. First, we&#39;re specifying a <code>type</code> attribute of &quot;text/x-handlebars&quot;. This <code>type</code> is ignored by the browser but leaves the text available for inspection and allows Ember to identify templates within the app. In addition, Ember uses a data attribute called &quot;data-template-name&quot; which Ember can use to associate specific parts of your application with a template. For example, the following declaration defines a template with a name &quot;employee&quot;:</p><pre class="brush: xml; title: ; notranslate">
&lt;script type=&quot;text/x-handlebars&quot; data-template-name=&quot;employee&quot;&gt;
...
&lt;/script&gt;
</pre><p>When your application starts, Ember scans the DOM for <code>type=&quot;text/x-handlebars</code>, compiles the templates it finds, and stores them in a property of the Ember object, called <code>Ember.TEMPLATES</code> which it uses to figure out what to render for a given route. This is why following Ember&#39;s <a
href="http://emberjs.com/guides/concepts/naming-conventions/">naming conventions</a> is so important. In the example above, this template will be automatically associated to the employee route and controller you created in your application. Again, I can&#39;t stress enough how these naming conventions will make your development much easier.</p><p>Ember is reliant on URLs to determine the resources that need to be used and the templates that need to be rendered. Let&#39;s imagine that you had a profile page with the URL &quot;/profile&quot;. You would  have a resource, called <code>profile</code> that would load specific resources for that URL (like a route object) and you would also have a template by the same name. We reviewed defining resources and route objects in <a
href="http://net.tutsplus.com/tutorials/javascript-ajax/getting-into-ember-js-part-2/">part 2 of my Ember series</a> so if you&#39;re not sure about what I&#39;m discussing, be sure to hop back there to refresh yourself on this.</p><p>When you visit that URL, Ember knows it needs to load these resources and parse the template you&#39;ve defined. It does this via its naming conventions, knowing that because you went to &quot;/profile&quot; it needs to load the resources defined in the <code>profile</code>, and render the template, named <code>data-template-name=&quot;profile&quot;</code>.</p><ul><li><strong>Route:</strong> ProfileRoute</li><li><strong>Controller:</strong> ProfileController</li><li><strong>Template:</strong> profile (note that it&#39;s lowercase)</li></ul><p>Going over the naming conventions again, you&#39;ll see that the route, controller and template are all tied together using the same URL name with the exception that the template is spelled in lowercase. This is what allows Ember to manage everything behind the scenes without you having to do a lot of wiring up.</p><p>Also important to note is that, if you declare a template without a <code>data-template-name</code> attribute, Ember will assume that it is the Application-scoped template &#8211; the one typically used as a site-wide template for creating user interface elements, such as headers, footers and navigation. And if you don&#39;t explicitly define a template for an application or even a resource (e.g: for a URL), Ember does that automatically for you to ensure stability and consistency in your app.</p><hr
/><h2>Expressions</h2><p>The next step is to include your markup and the delimited expressions you&#39;ll be using to represent your data. Expressions are delimited, via double curly braces which allow them to be easily identified and parsed with data being passed from your controller. Here&#39;s an example:</p><pre class="brush: xml; title: ; notranslate">
&lt;script type=&quot;text/x-handlebars&quot;&gt;
    &lt;h2&gt;&lt;strong&gt;{{firstName}} {{lastName}}&lt;/strong&gt;&lt;/h2&gt;
&lt;/script&gt;
</pre><p>In this case, the <code>{{firstName}}</code> and <code>{{lastName}}</code> expressions will be parsed by Ember and replaced by actual data. In addition, Ember sets up observers so that as your data changes, your template is automatically updated and the updates reflected to the user of your app.</p><p>So far, I&#39;ve shown you a very simple example, but the takeaway is that:</p><ul><li>Ember uses a special type attribute to define templates.<li>Templates use standard markup along with delimited expressions, which are parsed on the client-side.<li>These templates have the full feature set capabilities of Handlebars.<li>Ember sets up observers to dynamically update your user interface data, as it changes.</ul><p>This offers a lot of flexibility in how you structure your user interface. Let&#39;s continue looking at the features that are available.</p><hr
/><h2>Advanced Expressions</h2><p>Remember that Ember leverages Handlebars, so you have access to its full breadth of expressions here. Conditional expressions are a must, in order to render almost anything useful; Handlebars offers quite a number of options.</p><p>Let&#8217;s say that I had a JSON dataset that looked like this:</p><pre class="brush: jscript; title: ; notranslate">
&quot;items&quot;: [{
    &quot;title&quot;: &quot;Tearable Cloth Simulation in JavaScript&quot;,
    &quot;url&quot;: &quot;http://codepen.io/stuffit/pen/KrAwx&quot;,
    &quot;id&quot;: 5592679,
    &quot;commentCount&quot;: 20,
    &quot;points&quot;: 127,
    &quot;postedAgo&quot;: &quot;1 hour ago&quot;,
    &quot;postedBy&quot;: &quot;NathanKP&quot;
}, {
    &quot;title&quot;: &quot;Netflix now bigger than HBO&quot;,
    &quot;url&quot;: &quot;http://qz.com/77067/netflix-now-bigger-than-hbo/&quot;,
    &quot;id&quot;: 5592403,
    &quot;commentCount&quot;: 68,
    &quot;points&quot;: 96,
    &quot;postedAgo&quot;: &quot;2 hours ago&quot;,
    &quot;postedBy&quot;: &quot;edouard1234567&quot;
}
</pre><p>If I wanted to ensure that the <code>title</code> data is available, I could add a conditional &quot;if&quot; statement by using the <code>#if</code> expression:</p><pre class="brush: jscript; title: ; notranslate">
{{#if item.title}}
    &lt;li&gt;{{item.title}} - {{item.postedAgo}} by {{item.postedBy}}&lt;/li&gt;
{{/if}}
</pre><p>This checks to see if <code>item.title</code> is not undefined, and continues processing the subsequent expressions for the <code>title</code>, <code>postedAgo</code> and <code>postedBy</code> data expressions.</p><p>Since this dataset contains more than one &quot;record&quot;, it&#39;s safe to assume that we&#39;d probably want to loop over each element of <code>item</code>. That&#39;s where the <code>{{#each}}</code> expression comes into play. It allows you to enumerate over a list of objects.  So, again, keeping in mind that templates are a combination of markup and Handlebars expressions, we can use the <code>#each</code> expression to loop through every item available within our Ember model object. Remember that the Ember model is derived from the controller, which is associated to the template, via Ember&#39;s naming conventions.</p><pre class="brush: xml; title: ; notranslate">
&lt;ul&gt;
    {{#each item in model}}
    {{#if item.title}}
        &lt;li&gt;{{item.title}} - {{item.postedAgo}} by {{item.postedBy}}&lt;/li&gt;
    {{/if}}
    {{/each}}
&lt;/ul&gt;
</pre><p>This would render out something similar to:</p><pre class="brush: xml; title: ; notranslate">
&lt;ul&gt;
&lt;li&gt;Tearable Cloth Simulation in JavaScript - 1 hour ago by NathanKP&lt;/li&gt;
&lt;li&gt;Netflix now bigger than HBO - 2 hours ago by edouard1234567&lt;/li&gt;
&lt;li&gt;Fast Database Emerges from MIT Class, GPUs and Student&amp;#39;s Invention - 33 minutes ago by signa11&lt;/li&gt;
&lt;li&gt; Connecting an iPad retina LCD to a PC - 6 hours ago by noonespecial&lt;/li&gt;
&lt;/ul&gt;
</pre><p>The distinct advantage is Ember&#39;s implicit specification of observer,s which will update your data upon an update.</p><p>If your conditional expression needs to be more complex, you&#39;ll want to create a <a
href="http://emberjs.com/guides/object-model/computed-properties/">computed property</a>. This allows you to create a property based off of a method that can apply complex code conditions to your data. Let&#39;s say I wanted to solely wanted to display data that had the title &quot;Tearable Cloth Simulation in JavaScript&quot;. There&#39;s a couple of things I need to setup:</p><ul><li>I need a computed property to scan each item and tell me if the title matches</li><li>I need to create a controller that can be used by each item being enumerated over in the template</li><li>I need to update the template so that it uses this controller for each item<br
/> The first thing I need to do is create the new controller that will wrap each item being looped over and create the computed property within it:</li></ul><pre class="brush: jscript; title: ; notranslate">
App.TitleController = Ember.ObjectController.extend({
    titleMatch: function() {
      return this.get(&amp;#39;title&amp;#39;) === &amp;quot;Tearable Cloth Simulation in JavaScript&amp;quot;;
    }.property()
});
</pre><p>Looking at the code, we&#39;re subclassing <code>Ember.ObjectController</code> to create the controller. This is the controller that will wrap each item being looped over in our template. Next, we&#39;re creating a method, called <code>titleMatch</code> which uses the <code>get()</code> method to pull back the current title, compare it to the text I&#39;ve defined, and return a boolean. Lastly, the Ember <em><a
href="http://emberjs.com/api/classes/Function.html#method_property">property()</a></em> method is called to define the <em>titleMatch</em> method as a computed property.</p><p>Once we have this in place, we update the template&#39;s <code>{{#each}}</code> expression to represent each item with the new controller we created. This is done by using the <em>itemController</em> directive. A key thing to understand is that <code>itemController</code> is a key phrase in Ember meant to associate a controller to items of a template. Don&#39;t confuse it for an actual controller name (as I did initially). The controller name is assigned to <code>itemController</code>, like this:</p><pre class="brush: xml; title: ; notranslate">
&lt;ul&gt;
   {{#each item in model itemController=&quot;title&quot;}}
      {{#if titleMatch}}
        &lt;li&gt;{{foo.title}} - {{foo.postedAgo}} by {{foo.postedBy}}&lt;/li&gt;
      {{/if}}
    {{/each}}
&lt;/ul&gt;
</pre><p>Again, naming conventions dictate that, when assigning names in templates, we use lowercase. In this case, we&#39;re assigning <code>TitleController</code> to <code>itemController</code>.</p><p>Now, as each item is looped over, the computed property, <code>titleMatch</code>, is used to evaluate the title and display data if it matches.</p><hr
/><h2>Binding Data to Elements</h2><p>Creating dynamic templates isn&#39;t just about spitting out text. There are times when the look and feel of the UI needs to be affected by data being processed. Displaying an image or building a link are great examples of this.</p><p>Binding data to an element requires using special Ember helpers that assist in defining an attribute&#39;s context, as well as ensuring that the attributes are updated properly when data changes. For element attributes, the <code>{{bindAttr}}</code> helper is used to fill in the values for an attribute. If we needed to dynamically specify the URL of an image, we&#39;d use the following syntax:</p><pre class="brush: xml; title: ; notranslate">
&lt;img {{bindAttr src=&quot;logoUrl&quot;}} alt=&quot;Logo&quot;&gt;
</pre><p>The same can be done for attributes that don&#39;t receive a value, such as <code>disabled</code>:</p><pre class="brush: xml; title: ; notranslate">
&lt;input type=&quot;checkbox&quot; {{bindAttr disabled=&quot;isAdministrator&quot;}}&gt;
</pre><p>In this case, <code>isAdminstrator</code> could be a computed property based off a method in the controller, or just a normal object property giving you a lot of flexibility in defining the conditions for disabling the checkbox. This flexibility carries over to defining class names as well. If I wanted to use a conditional statement to define if a class should be applied to my element, I could use the following code:</p><pre class="brush: xml; title: ; notranslate">
&lt;div {{bindAttr class=&quot;isUrgent&quot;}}&gt;
  Warning!
&lt;/div&gt;
</pre><p>Depending on the boolean state, my markup would either be:</p><pre class="brush: xml; title: ; notranslate">
&lt;div {{bindAttr class=&quot;is-urgent&quot;}}&gt;
  Warning!
&lt;/div&gt;
</pre><p>for a <code>true</code> condition, or:</p><pre class="brush: xml; title: ; notranslate">
&lt;div&gt;
  Warning!
&lt;/div&gt;
</pre><p>for a <code>false</code> condition. Note that, when I specified <code>isUrgent</code> for the class, Ember dasherized the name and rendered the class as <code>is-urgent</code>. If you&#39;d prefer to specify your own class based on the results, you can use a conditional expression similar to a ternary statement:</p><pre class="brush: xml; title: ; notranslate">
&lt;div {{bindAttr class=&quot;isUrgent:urgent:normal&quot;}}&gt;
</pre><p>This will return <code>urgent</code> or <code>normal</code> for the class, based on the conditional value of <code>isUrgent</code>.</p><hr
/><h2>Get to Know Templates</h2><p>Templates will be the foundation of your user interface, so it&#39;s going to be important that you spend time reading the docs at both the <a
href="http://emberjs.com/guides/templates/handlebars-basics/">Ember</a> and Handlebars site to get a good feel for their overall power. Even if you don&#39;t use Ember, Handlebars is a great framework for you to use day-to-day, and worth the investment in learning how to use it.</p><p> Gabriel Manricks wrote a <a
href="http://net.tutsplus.com/tutorials/javascript-ajax/introduction-to-handlebars/?search_index=1">great tutorial on Handlebars</a> here on Nettuts+ that you can use to get up to speed on the framework.</p><div class="feedflare">
<a href="http://feeds.feedburner.com/~ff/nettuts?a=q1Zzl1QOgbk:iaI8gUj1DAw:yIl2AUoC8zA"><img src="http://feeds.feedburner.com/~ff/nettuts?d=yIl2AUoC8zA" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=q1Zzl1QOgbk:iaI8gUj1DAw:F7zBnMyn0Lo"><img src="http://feeds.feedburner.com/~ff/nettuts?i=q1Zzl1QOgbk:iaI8gUj1DAw:F7zBnMyn0Lo" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=q1Zzl1QOgbk:iaI8gUj1DAw:V_sGLiPBpWU"><img src="http://feeds.feedburner.com/~ff/nettuts?i=q1Zzl1QOgbk:iaI8gUj1DAw:V_sGLiPBpWU" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=q1Zzl1QOgbk:iaI8gUj1DAw:gIN9vFwOqvQ"><img src="http://feeds.feedburner.com/~ff/nettuts?i=q1Zzl1QOgbk:iaI8gUj1DAw:gIN9vFwOqvQ" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=q1Zzl1QOgbk:iaI8gUj1DAw:TzevzKxY174"><img src="http://feeds.feedburner.com/~ff/nettuts?d=TzevzKxY174" border="0"></img></a>
</div><img src="http://feeds.feedburner.com/~r/nettuts/~4/q1Zzl1QOgbk" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:9:"Rey Bango";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:81:"http://net.tutsplus.com/tutorials/javascript-ajax/getting-into-ember-part-4/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:38:"http://purl.org/rss/1.0/modules/slash/";a:1:{s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:1:"5";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:76:"http://net.tutsplus.com/tutorials/javascript-ajax/getting-into-ember-part-4/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:3;a:6:{s:4:"data";s:10:"          ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:5:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:59:"HTTP: The Protocol Every Web Developer Must Know – Part 2";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:54:"http://feedproxy.google.com/~r/nettuts/~3/zIfp72fhgko/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:113:"http://net.tutsplus.com/tutorials/tools-and-tips/http-the-protocol-every-web-developer-must-know-part-2/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Mon, 29 Apr 2013 15:53:26 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:2:{i:0;a:5:{s:4:"data";s:12:"Tools & Tips";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:1;a:5:{s:4:"data";s:4:"http";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:32:"http://net.tutsplus.com/?p=31155";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:21987:"<a
href='http://rss.buysellads.com/click.php?z=1260013&k=d754f1e9ba63a736ba8ff5ece958f7dd&a=31155&c=1364702971' target='_blank'><img
src='http://rss.buysellads.com/img.php?z=1260013&k=d754f1e9ba63a736ba8ff5ece958f7dd&a=31155&c=1364702971' border='0' alt='' /></a><p>In my <a
href="http://net.tutsplus.com/tutorials/tools-and-tips/http-the-protocol-every-web-developer-must-know-part-1/">previous article</a>, we covered some of HTTP&#8217;s basics, such as the URL scheme, status codes and request/response headers. With that as our foundation, we will look at the finer aspects of HTTP, like connection handling, authentication and HTTP caching. These topics are fairly extensive, but we&#8217;ll cover the most important bits.</p><p><span
id="more-31155"></span></p><hr
/><h2>HTTP Connections</h2><p>A connection must be established between the client and server before they can communicate with each other, and HTTP uses the reliable TCP transport protocol to make this connection. By default, web traffic uses TCP port 80. A TCP stream is broken into IP packets, and it ensures that those packets always arrive in the correct order without fail. HTTP is an application layer protocol over TCP, which is over IP.</p><p>HTTPS is a secure version of HTTP, inserting an additional layer between HTTP and TCP called TLS or SSL (Transport Layer Security or Secure Sockets Layer, respectively). HTTPS communicates over port 443 by default, and we will look at HTTPS later in this article.</p><div
class='tutorial_image'><img
src='http://cdn.tutsplus.com/net.tutsplus.com/authors/jeremymcpeak/http2-http-https.png' alt='HTTP and HTTPS layers' title='' border='0'></div><p>An HTTP connection is identified by <code>&lt;source-IP, source-port&gt;</code> and <code>&lt;destination-IP, destination-port&gt;</code>. On a client, an HTTP application is identified by a <code>&lt;IP, port&gt;</code> tuple. Establishing a connection between two endpoints is a multi-step process and involves the following:</p><div
class='tutorial_image'><img
src='http://cdn.tutsplus.com/net.tutsplus.com/authors/jeremymcpeak/http2-connect-delays.png' alt='Connection Delays' title='' border='0'></div><ul><li>resolve IP address from host name via DNS</li><li>establish a connection with the server</li><li>send a request</li><li>wait for a response</li><li>close connection</li></ul><blockquote
class="pullquote"><p>The server is responsible for always responding with the correct headers and responses.</p></blockquote><p>In HTTP/1.0, all connections were closed after a single transaction. So, if a client wanted to request three separate images from the same server, it made three separate connections to the remote host. As you can see from the above diagram, this can introduce lot of network delays, resulting in a sub-optimal user experience.</p><p>To reduce connection-establishment delays, HTTP/1.1 introduced <strong>persistent connections</strong>, long-lived connections that stay open until the client closes them. Persistent connections are default in HTTP/1.1, and making a single transaction connection requires the client to set the <code>Connection: close</code> request header. This tells the server to close the connection after sending the response.</p><p>In addition to persistent connections, browsers/clients also employ a technique, called <strong>parallel connections</strong>, to minimize network delays. The age-old concept of parallel connections involves creating a pool of connections (generally capped at six connections). If there are six assets that the client needs to download from a website, the client makes six parallel connections to download those assets, resulting in a faster turnaround. This is a huge improvement over serial connections where the client only downloads an asset after completing the download for a previous asset.</p><p>Parallel connections, in combination with persistent connections, is today&#8217;s answer to minimizing network delays and creating a smooth experience on the client. For an in-depth treatment of HTTP connections, refer to the <a
href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8">Connections section</a> of the HTTP spec.</p><h3>Server-side Connection Handling</h3><p>The server mostly listens for incoming connections and processes them when it receives a request. The operations involve:</p><ul><li>establishing a socket to start listening on port 80 (or some other port)</li><li>receiving the request and parsing the message</li><li>processing the response</li><li>setting response headers</li><li>sending the response to the client</li><li>close the connection if a <code>Connection: close</code> request header was found</li></ul><p>Of course, this is not an exhaustive list of operations. Most applications/websites need to know who makes a request in order to create more customized responses. This is the realm of <strong>identification</strong> and <strong>authentication</strong>.</p><hr
/><h2>Identification and Authentication</h2><blockquote
class="pullquote"><p>HTTP is an application layer protocol over TCP, which is over IP.</p></blockquote><p>It is almost mandatory to know who connects to a server for tracking an app&#8217;s or site&#8217;s usage and the general interaction patterns of users. The premise of identification is to tailor the response in order to provide a personalized experience; naturally, the server must know who a user is in order to provide that functionality.</p><p>There are a few different ways a server can collect this information, and most websites use a hybrid of these approaches:</p><ul><li><strong>Request headers</strong>: <code>From</code>, <code>Referer</code>, <code>User-Agent</code> &#8211; We saw these headers in <a
href="http://net.tutsplus.com/tutorials/tools-and-tips/http-the-protocol-every-web-developer-must-know-part-1/">Part 1</a>.</li><li><strong>Client-IP</strong> &#8211; the IP address of the client</li><li><strong>Fat Urls</strong> &#8211; storing state of the current user by modifying the URL and redirecting to a different URL on each click; each click essentially accumulates state.</li><li><strong>Cookies</strong> &#8211; the most popular and non-intrusive approach.</li></ul><p>Cookies allow the server to attach arbitrary information for outgoing responses via the <code>Set-Cookie</code> response header. A cookie is set with one or more <em>name=value</em> pairs separated by semicolon (<strong>;</strong>), as in <code>Set-Cookie: session-id=12345ABC; username=nettuts</code>.</p><p>A server can also restrict the cookies to a specific <code>domain</code> and <code>path</code>, and it can make them persistent with an <code>expires</code> value. Cookies are automatically sent by the browser for each request made to a server, and the browser ensures that only the <code>domain</code>- and <code>path</code>-specific cookies are sent in the request. The request header <code>Cookie: name=value [; name2=value2]</code> is used to send these cookies to the server.</p><blockquote><p>The best way to identify a user is to require them to sign up and log in, but implementing this feature requires some effort by the developer, as well as the user.</p></blockquote><p>Techniques like <a
href="http://oauth.net/">OAuth</a> simplify this type of feature, but it still requires user consent in order to work properly. Authentication plays a large role here, and it is probably the only way to identify and verify the user.</p><h3>Authentication</h3><p>HTTP does support a rudimentary form of authentication called <strong>Basic Authentication</strong>, as well as the more secure <strong>Digest Authentication</strong>.</p><p>In Basic Authentication, the server initially denies the client&#8217;s request with a <code>WWW-Authenticate</code> response header and a <code>401 Unauthorized</code> status code. On seeing this header, the browser displays a login dialog, prompting for a username and password. This information is sent in a base-64 encoded format in the <code>Authentication</code> request header. The server can now validate the request and allow access if the credentials are valid. Some servers might also send an <code>Authentication-Info</code> header containing additional authentication details.</p><div
class='tutorial_image'><img
src='http://cdn.tutsplus.com/net.tutsplus.com/authors/jeremymcpeak/http2-authentication.png' alt='Authentication Challenge/Response' title='' border='0'></div><p>A corollary to Basic-Authentication is <strong>Proxy Authentication</strong>. Instead of a web server, the authetication challenge is requested by an intermediate proxy. The proxy sends a <code>Proxy-Authenticate</code> header with a <code>407 Unauthorized</code> status code. In return, the client is supposed to send the credentials via the <code>Proxy-Authorization</code> request header.</p><p>Digest Authentication is similar to Basic and uses the same handshake technique with the <code>WWW-Authenticate</code> and <code>Authorization</code> headers, but Digest uses a more secure hashing function to encrypt the username and password (commonly with MD5 or KD digest functions). Although Digest Authentication is supposed to be more secure than Basic, websites typically use Basic Authentication because of its simplicty. To mitigate the security concerns, Basic Auth is used in conjunction with SSL.</p><h3>Secure HTTP</h3><div
class='tutorial_image'><img
src='http://cdn.tutsplus.com/net.tutsplus.com/authors/jeremymcpeak/http2-https-addressbar.png' alt='HTTPS AddressBar' title='' border='0'></div><p>The HTTPS protocol provides a secure connection on the web. The easiest way to know if you are using HTTPS is to check the browser&#8217;s address bar. HTTPs&#8217; secure component involves inserting a layer of encryption/decryption between HTTP and TCP. This is the Secure Sockets Layer (SSL) or the improved Transport Layer Security (TLS).</p><p>SSL uses a powerful form of encryption using RSA and public-key cryptography. Because secure transactions are so important on the web, a ubiquitous standards-based Public-Key Infrastructure (PKI) effort has been underway for quite sometime.</p><p>Existing clients/servers do not have to change the way they handle messages because most of the hard work happens in the SSL layer. Thus, you can develop your web application using Basic Authentication and automatially reap the benefits of SSL by switching to the <code>https://</code> protocol. However, to make the web application work over HTTPS, you need to have a working digital certificate deployed on the server.</p><h4>Certificates</h4><p>Just as you need ID cards to show your identity, a web server needs a digital certificate to identify itself. Certificates (or &#8220;certs&#8221;) are issued by a Certificate Authority (CA) and vouch for your identity on the web. The CAs are the guardians of the PKI. The most common form of certificates is the <a
href="http://www.ietf.org/rfc/rfc2459.txt">X.509 v3 standard</a>, which contains information, such as:</p><ul><li>the certificate issuer</li><li>the algorithm used for the certificate</li><li>the subject name or organization for whom this cert is created</li><li>the public key information for the subject</li><li>the Certification Authority Signature, using the specified signing algorithm</li></ul><p>When a client makes a request over HTTPS, it first tries to locate a certificate on the server. If the cert is found, it attempts to verfiy it against its known list of CAs. If its not one of the listed CAs, it might show a dialog to the user warning about the website&#8217;s certficate.</p><p>Once the certificate is verified, the SSL handshake is complete and secure transmission is in effect.</p><hr
/><h2>HTTP Caching</h2><p>It is generally agreed that doing the same work twice is wasteful. This is the guiding principle around the concept of HTTP caching, a fundamental pillar of the HTTP Network Infrastructure. Because most of the operations are over a network, a cache helps save time, cost and bandwidth, as well as provide an improved experience on the web.</p><p>Caches are used at several places in the network infrastructure, from the browser to the origin server. Depending on where it is located, a cache can be categorized as:</p><ul><li><strong>Private</strong>: within a browser, caches usernames, passwords, URLs, browsing history and web content. They are generally small and specific to a user.</li><li><strong>Public</strong>: deployed as caching proxies between the server and client. These are much larger because they serve multiple users. A common practice is to keep multiple caching proxies between the client and the origin-server. This helps to serve frequently accessed content, while still allowing a trip to the server for infrequently needed content.</li></ul><div
class='tutorial_image'><img
src='http://cdn.tutsplus.com/net.tutsplus.com/authors/jeremymcpeak/http2-cache-topo.png' alt='Cache Topology' title='' border='0'></div><h3>Cache Processing</h3><p>Regardless of where a cache is located, the process of maintaining a cache is quite similar:</p><ul><li><strong>Receive</strong> request message.</li><li><strong>Parse</strong> the URL and headers.</li><li><strong>Lookup</strong> a local copy; otherwise, fetch and store locally</li><li>Do a <strong>freshness check</strong> to determine the age of the content in the cache; make a request to refresh the content only if necessary.</li><li>Create the <strong>response</strong> from the cached body and updated headers.</li><li><strong>Send</strong> the response back to client.</li><li>Optionally, <strong>log</strong> the transaction.</li></ul><p>Of course, the server is responsible for always responding with the correct headers and responses. If a document hasn&#8217;t changed, the server should respond with a <code>304 Not Modified</code>. If the cached copy has expired, it should generate a new response with updated response headers and return with a <code>200 OK</code>. If the resource is deleted, it should come back with <code>404 Not Found</code>. These responses help tune the cache and ensure that stale content is not kept for too long.</p><h3>Cache Control Headers</h3><blockquote
class="pullquote"><p>Parallel connections, in combination with persistent connections, is today’s answer to minimizing network delays.</p></blockquote><p>Now that we have a sense of how a cache works, it&#8217;s time to look at the request and response headers that enable the caching infrastructure. Keeping the content fresh and up-to-date is one of the primary responsibilities of the cache. To keep the cached copy consistent with the server, HTTP provides some simple mechanisms, namely <em>Document Expiration</em> and <em>Server Revalidation</em>.</p><h4>Document Expiration</h4><p>HTTP allows an origin-server to attach an <em>expiration date</em> to each document using the <code>Cache-Control</code> and <code>Expires</code> <em>response</em> headers. This helps the client and other cache servers know how long a document is valid and fresh. The cache can serve the copy as long as the <em>age</em> of the document is within the expiration date. Once a document expires, the cache must check with the server for a newer copy and update its local copy accordingly.</p><p><code>Expires</code> is an older HTTP/1.0 response header that specifies the value as an absolute date. This is only useful if the server clocks are in sync with the client, which is a terrible assumption to make. This header is less useful compared to the newer <code>Cache-Control: max-age=&lt;s&gt;</code> header introduced in HTTP/1.1. Here, <code>max-age</code> is a relative age, specified in seconds, from the time the response was created. Thus if a document should expire after one day, the expiration header should be <code>Cache-Control: max-age=86400</code>.</p><h4>Server Revalidation</h4><p>Once a cached document expires, the cache must revalidate with the server to check if the document has changed. This is called <em>server revalidation</em> and serves as a querying mechanism for the <em>stale-ness</em> of a document. Just because a cached copy has expired doesn&#8217;t mean that the server actually has newer content. Revalidation is just a means of ensuring that the cache stays fresh. Because of the expiration time (as specified in a previous server response), the cache doesn&#8217;t have to check with the server for every single request, thus saving bandwidth, time and reducing the network traffic.</p><blockquote><p>The combination of document expiration and server revalidation is a very effective mechanism, it and allows distributed systems to maintain copies with an expiration date.</p></blockquote><p>If the content is known to frequently change, the expiration time can be reduced&mdash;allowing the systems to re-sync more frequently.</p><p>The revalidation step can be accomplished with two kinds of request-headers: <code>If-Modified-Since</code> and <code>If-None-Match</code>. The former is for date-based validation while the latter uses Entity-Tags (ETags), a hash of the content. These headers use date or ETag values obtained from a previous server response. In case of <code>If-Modified-Since</code>, the <code>Last-Modified</code> response header is used; for <code>If-None-Match</code>, it is the <code>ETag</code> response header.</p><h4>Controlling the Cachability</h4><p>The validity period for a document should be defined by the server generating the document. If it&#8217;s a newspaper website, the homepage should expire after a day (or sometimes even every hour!). HTTP provides the <code>Cache-Control</code> and <code>Expires</code> response headers to set the expiration on documents. As mentioned earlier, <code>Expires</code> is based on absolute dates and not a reliable solution for controlling cache.</p><p>The <code>Cache-Control</code> header is far more useful and has a few different values to constrain how clients should be caching the response:</p><ul><li><strong>Cache-Control: no-cache</strong>: the client is allowed to store the document; however, it must revalidate with the server on every request. There is a HTTP/1.0 compatibility header called <strong>Pragma: no-cache</strong>, which works the same way.</li><li><strong>Cache-Control: no-store</strong>: this is a stronger directive to the client to not store the document at all.</li><li><strong>Cache-Control: must-revalidate</strong>: this tells the client to bypass its freshness calculation and always revalidate with the server. It is not allowed to serve the cached response in case the server is unavailable.</li><li><strong>Cache-Control: max-age</strong>: this sets a relative expiration time (in seconds) from the time the response is generated.</li></ul><p>As an aside, if the server does not send any <code>Cache-Control</code> headers, the client is free to use its own heuristic expiration algorithm to determine freshness.</p><h4>Constraining Freshness from the Client</h4><p>Cachability is not just limited to the server. It can also be specified from the client. This allows the client to impose constraints on what it is willing to accept. This is possible via the same <code>Cache-Control</code> header, albeit with a few different values:</p><ul><li><strong>Cache-Control: min-fresh=&lt;s&gt;</strong>: the document must be fresh for at least <em>&lt;s&gt;</em> seconds.</li><li><strong>Cache-Control: max-stale</strong> or <strong>Cache-Control: max-stale=&lt;s&gt;</strong>: the document cannot be served from the cache if it has been stale for longer than <em>&lt;s&gt;</em> seconds.</li><li><strong>Cache-Control: max-age=&lt;s&gt;</strong>: the cache cannot return a document that has been cached longer than <em>&lt;s&gt;</em> seconds.</li><li><strong>Cache-Control: no-cache</strong> or <strong>Pragma: no-cache</strong>: the client will not accept a cached resource unless it has been revalidated.</li></ul><p>HTTP Caching is actually a very interesting topic, and there are some very sophisticated algorithms to manage cached content. For a deeper look into this topic, refer to the <a
href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html">Caching section</a> of the HTTP spec.</p><hr
/><h2>Summary</h2><p>Our tour of HTTP began with the foundation of URL schemes, status codes and request/response headers. Building upon those concepts, we looked at some of the finer areas of HTTP, such as connection handling, identification and authentication and caching. I am hopeful that this tour has given you a good taste for the breadth of HTTP and enough pointers to further explore this protocol.</p><h3>References</h3><ul><li><a
href="http://www.w3.org/Protocols/rfc2616/rfc2616.html">RFC 2616, HTTP specification</a></li><li><a
href="http://www.amazon.com/HTTP-Definitive-Guide-David-Gourley/dp/1565925092">HTTP Definitive Guide</a></li></ul><div class="feedflare">
<a href="http://feeds.feedburner.com/~ff/nettuts?a=zIfp72fhgko:jMufuOZXLAo:yIl2AUoC8zA"><img src="http://feeds.feedburner.com/~ff/nettuts?d=yIl2AUoC8zA" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=zIfp72fhgko:jMufuOZXLAo:F7zBnMyn0Lo"><img src="http://feeds.feedburner.com/~ff/nettuts?i=zIfp72fhgko:jMufuOZXLAo:F7zBnMyn0Lo" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=zIfp72fhgko:jMufuOZXLAo:V_sGLiPBpWU"><img src="http://feeds.feedburner.com/~ff/nettuts?i=zIfp72fhgko:jMufuOZXLAo:V_sGLiPBpWU" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=zIfp72fhgko:jMufuOZXLAo:gIN9vFwOqvQ"><img src="http://feeds.feedburner.com/~ff/nettuts?i=zIfp72fhgko:jMufuOZXLAo:gIN9vFwOqvQ" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=zIfp72fhgko:jMufuOZXLAo:TzevzKxY174"><img src="http://feeds.feedburner.com/~ff/nettuts?d=TzevzKxY174" border="0"></img></a>
</div><img src="http://feeds.feedburner.com/~r/nettuts/~4/zIfp72fhgko" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:12:"Pavan Podila";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:109:"http://net.tutsplus.com/tutorials/tools-and-tips/http-the-protocol-every-web-developer-must-know-part-2/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:38:"http://purl.org/rss/1.0/modules/slash/";a:1:{s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:1:"6";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:104:"http://net.tutsplus.com/tutorials/tools-and-tips/http-the-protocol-every-web-developer-must-know-part-2/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:4;a:6:{s:4:"data";s:11:"           ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:5:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:26:"Test-Driving Shell Scripts";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:54:"http://feedproxy.google.com/~r/nettuts/~3/8e2tSC6ql7w/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:85:"http://net.tutsplus.com/tutorials/tools-and-tips/test-driving-shell-scripts/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Fri, 26 Apr 2013 17:52:45 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:3:{i:0;a:5:{s:4:"data";s:12:"Tools & Tips";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:1;a:5:{s:4:"data";s:4:"bash";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:2;a:5:{s:4:"data";s:3:"tdd";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:32:"http://net.tutsplus.com/?p=31487";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:24279:"<a
href='http://rss.buysellads.com/click.php?z=1260013&k=d754f1e9ba63a736ba8ff5ece958f7dd&a=31487&c=1328835008' target='_blank'><img
src='http://rss.buysellads.com/img.php?z=1260013&k=d754f1e9ba63a736ba8ff5ece958f7dd&a=31487&c=1328835008' border='0' alt='' /></a><p>Writing shell scripts is very much like programming. Some scripts require little time investment; whereas, other complex scripts may require thought, planning and a larger commitment. From this perspective, it makes sense to take a test-driven approach and unit test our shell scripts.</p><p><span
id="more-31487"></span></p><p>To get the most out of this tutorial, you need to be familiar with the command line interface (CLI); you may want to check out the <a
href="http://net.tutsplus.com/tutorials/tools-and-tips/the-command-line-is-your-best-friend/?search_index=3">The Command Line is Your Best Friend</a> tutorial if you need a refresher. You also need a basic understanding of Bash-like shell scripting. Finally, you may want to familiarize yourself with the test-driven development (TDD) concepts and unit testing in general; be sure to check out these <a
href="http://net.tutsplus.com/sessions/test-driven-php/">Test-Driven PHP</a> tutorials to get the basic idea.</p><hr
/><h2>Prepare the Programming Environment</h2><p>First, you need a text editor to write your shell scripts and unit tests. Use your favorite!</p><p>We will use the <a
href="http://code.google.com/p/shunit2/downloads/list">shUnit2</a> shell unit testing framework to run our unit tests. It was designed for, and works with, Bash-like shells. shUnit2 is an open source framework released under the GPL license, and a copy of the framework is also included with this tutorial&#8217;s sample source code.</p><p>Installing shUnit2 is very easy; simply download and extract the archive to any location on your hard drive. It is written in Bash, and as such, the framework consists of only script files. If you plan to frequently use shUnit2, I highly recommend that you put it in a location in your PATH.</p><hr
/><h2>Writing our First Test</h2><p>For this tutorial, extract shUnit into a directory with the same name in your <code>Sources</code> folder (see the code attached to this tutorial). Create a <code>Tests</code> folder inside <code>Sources</code> and added a new file call <code>firstTest.sh</code>.</p><pre class="brush: bash; title: ; notranslate">
#! /usr/bin/env sh

### firstTest.sh ###

function testWeCanWriteTests () {
	assertEquals &quot;it works&quot; &quot;it works&quot;
}

## Call and Run all Tests
. &quot;../shunit2-2.1.6/src/shunit2&quot;
</pre><p>Than make your test file executable.</p><pre class="brush: bash; title: ; notranslate">$ cd __your_code_folder__/Tests
$ chmod +x firstTest.sh
</pre><p>Now you can simply run it and observe the output:</p><pre class="brush: bash; title: ; notranslate">
$ ./firstTest.sh
testWeCanWriteTests

Ran 1 test.

OK
</pre><p>It says we ran one successful test. Now, let&#8217;s cause the test to fail; change the <code>assertEquals</code> statement so that the two strings are not the same and run the test again:</p><pre class="brush: bash; title: ; notranslate">
$ ./firstTest.sh
testWeCanWriteTests
ASSERT:expected:&lt;it works&gt; but was:&lt;it does not work&gt;

Ran 1 test.

FAILED (failures=1)
</pre><hr
/><h2>A Tennis Game</h2><blockquote
class="pullquote"><p>You write acceptance tests at the beginning of a project/feature/story when you can clearly define a specific requirement.</p></blockquote><p>Now that we have a working testing environment, let&#8217;s write a script that reads a file, makes decisions based on the file&#8217;s contents and outputs information to the screen.</p><p>The main goal of the script is to show the score of a tennis game between two players. We will concentrate only on keeping the score of a single game; everything else is up to you. The scoring rules are:</p><ul><li>At the beginning, each player has a score of zero, called &#8220;love&#8221;</li><li>First, second and third balls won are marked as &#8220;fifteen&#8221;, &#8220;thirty&#8221;, and &#8220;forty&#8221;.</li><li>If at &#8220;forty&#8221; the score is equal, it is called &#8220;deuce&#8221;.</li><li>After this, the score is kept as &#8220;Advantage&#8221; for the player who scores one more point than the other player.</li><li>A player is the winner if he manages to have an advantage of at least two points and wins at least three points (that is, if he reached at least &#8220;forty&#8221;).</li></ul><hr
/><h2>Definition of Input and Output</h2><p>Our application will read the score from a file. Another system will push the information into this file. The first line of this data file will contain the names of the players. When a player scores a point, their name is written at the end of the file. A typical score file looks like this:</p><pre class="brush: xml; title: ; notranslate">
John - Michael
John
John
Michael
John
Michael
Michael
John
John
</pre><p>You can find this content in the <code>input.txt</code> file in the <code>Source</code> folder.</p><p>The output of our program writes the score to the screen one line at a time. The output should be:</p><pre class="brush: xml; title: ; notranslate">
John - Michael
John: 15 - Michael: 0
John: 30 - Michael: 0
John: 30 - Michael: 15
John: 40 - Michael: 15
John: 40 - Michael: 30
Deuce
John: Advantage
John: Winner
</pre><p>This output can be also found in the <code>output.txt</code> file. We will use this information to check if our program is correct.</p><hr
/><h2>The Acceptance Test</h2><p>You write acceptance tests at the beginning of a project/feature/story when you can clearly define a specific requirement. In our case, this test simply calls our soon-to-be-created script with the name of the input file as the parameter, and it expects the output to be identical with the hand-written file from the previous section:</p><pre class="brush: bash; title: ; notranslate">
#! /usr/bin/env sh

### acceptanceTest.sh ###

function testItCanProvideAllTheScores () {
	cd ..
	./tennisGame.sh ./input.txt &gt; ./results.txt
	diff ./output.txt ./results.txt
	assertTrue 'Expected output differs.' $?
}

## Call and Run all Tests
. &quot;../shunit2-2.1.6/src/shunit2&quot;
</pre><p>We will run our tests in the <code>Source/Tests</code> folder; therefore, <code>cd ..</code> takes us into the <code>Source</code> directory. Then it tries to run <code>tennisGamse.sh</code>, which does not yet exist. Then the <code>diff</code> command will compare the two files: <code>./output.txt</code> is our hand-written output and <code>./results.txt</code> will contain the result of our script. Finally, <code>assertTrue</code> checks the exit value of <code>diff</code>.</p><p>But for now, our test returns the following error:</p><pre class="brush: bash; title: ; notranslate">
$ ./acceptanceTest.sh
testItCanProvideAllTheScores
./acceptanceTest.sh: line 7: tennisGame.sh: command not found
diff: ./results.txt: No such file or directory
ASSERT:Expected output differs.

Ran 1 test.

FAILED (failures=1)
</pre><p>Let&#8217;s turn those errors into a nice failure by creating an empty file called <code>tennisGame.sh</code> and make it executable. Now when we run our test, we don&#8217;t get an error:</p><pre class="brush: bash; title: ; notranslate">
./acceptanceTest.sh
testItCanProvideAllTheScores
1,9d0
&lt; John - Michael
&lt; John: 15 - Michael: 0
&lt; John: 30 - Michael: 0
&lt; John: 30 - Michael: 15
&lt; John: 40 - Michael: 15
&lt; John: 40 - Michael: 30
&lt; Deuce
&lt; John: Advantage
&lt; John: Winner
ASSERT:Expected output differs.

Ran 1 test.

FAILED (failures=1)
</pre><hr
/><h2>Implementation with TDD</h2><p>Create another file called <code>unitTests.sh</code> for our unit tests. We don&#8217;t want to run our script for each test; we only want to run the functions that we test. So, we will make <code>tennisGame.sh</code> run only the functions that will reside in <code>functions.sh</code>:</p><pre class="brush: bash; title: ; notranslate">
#! /usr/bin/env sh

### unitTest.sh ###

source ../functions.sh

function testItCanProvideFirstPlayersName () {
	assertEquals 'John' `getFirstPlayerFrom 'John - Michael'`
}

## Call and Run all Tests
. &quot;../shunit2-2.1.6/src/shunit2&quot;
</pre><p>Our first test is simple. We attempt to retrieve the first player&#8217;s name when a line contains two names separated by a hyphen. This test will fail because we do not yet have a <code>getFirstPlayerFrom</code> function:</p><pre class="brush: bash; title: ; notranslate">
$ ./unitTest.sh
testItCanProvideFirstPlayersName
./unitTest.sh: line 8: getFirstPlayerFrom: command not found
shunit2:ERROR assertEquals() requires two or three arguments; 1 given
shunit2:ERROR 1: John 2:  3:

Ran 1 test.

OK
</pre><p>The implementation for <code>getFirstPlayerFrom</code>is very simple. It&#8217;s a regular expression that is pushed through the <code>sed</code> command:</p><pre class="brush: bash; title: ; notranslate">
### functions.sh ###

function getFirstPlayerFrom () {
	echo $1 | sed -e 's/-.*//'
}
</pre><p>Now the test passes:</p><pre class="brush: bash; title: ; notranslate">
$ ./unitTest.sh
testItCanProvideFirstPlayersName

Ran 1 test.

OK
</pre><p>Let&#8217;s write another test for the second player&#8217;s name:</p><pre class="brush: bash; title: ; notranslate">
### unitTest.sh ###

[...]

function testItCanProvideSecondPlayersName () {
	assertEquals 'Michael' `getSecondPlayerFrom 'John - Michael'`
}
</pre><p>The failure:</p><pre class="brush: bash; title: ; notranslate">
./unitTest.sh
testItCanProvideFirstPlayersName
testItCanProvideSecondPlayersName
ASSERT:expected:&lt;Michael&gt; but was:&lt;John&gt;

Ran 2 tests.

FAILED (failures=1)
</pre><p>And now the function implementation to make it pass:</p><pre class="brush: bash; title: ; notranslate">
### functions.sh ###

[...]

function getSecondPlayerFrom () {
	echo $1 | sed -e 's/.*-//'
}</pre><p>Now we have passing tests:</p><pre class="brush: bash; title: ; notranslate">$ ./unitTest.sh
testItCanProvideFirstPlayersName
testItCanProvideSecondPlayersName

Ran 2 tests.

OK
</pre><hr
/><h2>Let&#8217;s Speed Things Up</h2><p>Starting at this point, we will write a test and the implementation, and I will explain only what deserves to be mentioned.</p><p>Let&#8217;s test if we have a player with only one score. Added the following test:</p><pre class="brush: bash; title: ; notranslate">
function testItCanGetScoreForAPlayerWithOnlyOneWin () {
	standings=$'John - Michael\nJohn'
	assertEquals '1' `getScoreFor 'John' &quot;$standings&quot;`
}
</pre><p>And the solution:</p><pre class="brush: bash; title: ; notranslate">
function getScoreFor () {
	player=$1
	standings=$2
	totalMatches=$(echo &quot;$standings&quot; | grep $player | wc -l)
	echo $(($totalMatches-1))
}
</pre><p>We use some fancy-pants quoting to pass the newline sequence (<code>\n</code>) inside a string parameter. Then we use <code>grep</code> to find the lines that contain the player&#8217;s name and count them with <code>wc</code>. Finally, we subtract one from the result to counteract the presence of the first line (it contains only non-score related data).</p><blockquote><p>Now we are at the refactoring phase of TDD.</p></blockquote><p>I just realized that the code actually works for more than one point per player, and we can refactor our tests to reflect this. Change the above test function to the following:</p><pre class="brush: bash; title: ; notranslate">
function testItCanGetScoreForAPlayer () {
	standings=$'John - Michael\nJohn\nMichael\nJohn'
	assertEquals '2' `getScoreFor 'John' &quot;$standings&quot;`
}
</pre><p>The tests still passes. Time to move on with our logic:</p><pre class="brush: bash; title: ; notranslate">
function testItCanOutputScoreAsInTennisForFirstPoint () {
	assertEquals 'John: 15 - Michael: 0' &quot;`displayScore 'John' 1 'Michael' 0`&quot;
}
</pre><p>And the implementation:</p><pre class="brush: bash; title: ; notranslate">
function displayScore () {
	if [ &quot;$2&quot; -eq '1' ]; then
		playerOneScore='15'
	fi

	echo &quot;$1: $playerOneScore - $3: $4&quot;
}
</pre><p>I only check the second parameter. This looks like I&#8217;m cheating, but it is the simplest code to make the test pass. Writing another test forces us to add more logic, but what test should we write next?</p><p>There are two paths we can take. Testing if the second player recieves a point forces us to write another <code>if</code> statement, but we only have to add an <code>else</code> statement if we choose to test the first player&#8217;s second point. The latter implies an easier implementation, so let&#8217;s try that:</p><pre class="brush: bash; title: ; notranslate">
function testItCanOutputScoreAsInTennisForSecondPointFirstPlayer () {
	assertEquals 'John: 30 - Michael: 0' &quot;`displayScore 'John' 2 'Michael' 0`&quot;
}
</pre><p>And the implementation:</p><pre class="brush: bash; title: ; notranslate">
function displayScore () {
	if [ &quot;$2&quot; -eq '1' ]; then
		playerOneScore='15'
	else
		playerOneScore='30'
	fi

	echo &quot;$1: $playerOneScore - $3: $4&quot;
}
</pre><p>This still looks cheating, but it works perfectly. Continuing on for the third point:</p><pre class="brush: bash; title: ; notranslate">
function testItCanOutputScoreAsInTennisForTHIRDPointFirstPlayer () {
	assertEquals 'John: 40 - Michael: 0' &quot;`displayScore 'John' 3 'Michael' 0`&quot;
}
</pre><p>The implementation:</p><pre class="brush: bash; title: ; notranslate">function displayScore () {
	if [ &quot;$2&quot; -eq '1' ]; then
		playerOneScore='15'
	elif [ &quot;$2&quot; -eq '2' ]; then
		playerOneScore='30'
	else
		playerOneScore='40'
	fi

	echo &quot;$1: $playerOneScore - $3: $4&quot;
}</pre><p>This <code>if-elif-else</code> is starting to annoy me. I want to change it, but let&#8217;s first refactor our tests. We have three very similar tests; so let&#8217;s write them into a single test that makes three assertions:</p><pre class="brush: bash; title: ; notranslate">
function testItCanOutputScoreWhenFirstPlayerWinsFirst3Points () {
	assertEquals 'John: 15 - Michael: 0' &quot;`displayScore 'John' 1 'Michael' 0`&quot;
	assertEquals 'John: 30 - Michael: 0' &quot;`displayScore 'John' 2 'Michael' 0`&quot;
	assertEquals 'John: 40 - Michael: 0' &quot;`displayScore 'John' 3 'Michael' 0`&quot;
}
</pre><p>That&#8217;s better, and it still passes. Now, let&#8217;s create a similar test for the second player:</p><pre class="brush: bash; title: ; notranslate">
function testItCanOutputScoreWhenSecondPlayerWinsFirst3Points () {
	assertEquals 'John: 0 - Michael: 15' &quot;`displayScore 'John' 0 'Michael' 1`&quot;
	assertEquals 'John: 0 - Michael: 30' &quot;`displayScore 'John' 0 'Michael' 2`&quot;
	assertEquals 'John: 0 - Michael: 40' &quot;`displayScore 'John' 0 'Michael' 3`&quot;
}
</pre><p>Running this test results in interesting output:</p><pre class="brush: bash; title: ; notranslate">
testItCanOutputScoreWhenSecondPlayerWinsFirst3Points
ASSERT:expected:&lt;John: 0 - Michael: 15&gt; but was:&lt;John: 40 - Michael: 1&gt;
ASSERT:expected:&lt;John: 0 - Michael: 30&gt; but was:&lt;John: 40 - Michael: 2&gt;
ASSERT:expected:&lt;John: 0 - Michael: 40&gt; but was:&lt;John: 40 - Michael: 3&gt;
</pre><p>Well that was unexpected. We knew that Michael would have incorrect scores. The surprise is John; he should have 0 not 40. Let&#8217;s fix that by first modifying the <code>if-elif-else</code> expression:</p><pre class="brush: bash; title: ; notranslate">
function displayScore () {
	if [ &quot;$2&quot; -eq '1' ]; then
		playerOneScore='15'
	elif [ &quot;$2&quot; -eq '2' ]; then
		playerOneScore='30'
	elif [ &quot;$2&quot; -eq '3' ]; then
		playerOneScore='40'
	else
		playerOneScore=$2
	fi

	echo &quot;$1: $playerOneScore - $3: $4&quot;
}
</pre><p>The <code>if-elif-else</code> is now more complex, but we at least fixed the John&#8217;s scores:</p><pre class="brush: bash; title: ; notranslate">
testItCanOutputScoreWhenSecondPlayerWinsFirst3Points
ASSERT:expected:&lt;John: 0 - Michael: 15&gt; but was:&lt;John: 0 - Michael: 1&gt;
ASSERT:expected:&lt;John: 0 - Michael: 30&gt; but was:&lt;John: 0 - Michael: 2&gt;
ASSERT:expected:&lt;John: 0 - Michael: 40&gt; but was:&lt;John: 0 - Michael: 3&gt;
</pre><p>Now let&#8217;s fix Michael:</p><pre class="brush: bash; title: ; notranslate">
function displayScore () {
	echo &quot;$1: `convertToTennisScore $2` - $3: `convertToTennisScore $4`&quot;
}

function convertToTennisScore () {
	if [ &quot;$1&quot; -eq '1' ]; then
		playerOneScore='15'
	elif [ &quot;$1&quot; -eq '2' ]; then
		playerOneScore='30'
	elif [ &quot;$1&quot; -eq '3' ]; then
		playerOneScore='40'
	else
		playerOneScore=$1
	fi

	echo $playerOneScore;
}
</pre><p>That worked well! Now it&#8217;s time to finally refactor that ugly <code>if-elif-else</code> expression:</p><pre class="brush: bash; title: ; notranslate">
function convertToTennisScore () {
	declare -a scoreMap=('0' '15' '30' '40')
	echo ${scoreMap[$1]};
}
</pre><p>Value maps are wonderful! Let&#8217;s move on to the &#8220;Deuce&#8221; case:</p><pre class="brush: bash; title: ; notranslate">
function testItSayDeuceWhenPlayersAreEqualAndHaveEnoughPoinst () {
	assertEquals 'Deuce' &quot;`displayScore 'John' 3 'Michael' 3`&quot;
}
</pre><p>We check for &#8220;Deuce&#8221; when all players have at least a score of 40.</p><pre class="brush: bash; title: ; notranslate">
function displayScore () {
	if [ $2 -gt 2 ] &amp;&amp; [ $4 -gt 2 ] &amp;&amp; [ $2 -eq $4 ]; then
		echo &quot;Deuce&quot;
	else
		echo &quot;$1: `convertToTennisScore $2` - $3: `convertToTennisScore $4`&quot;
	fi
}
</pre><p>Now we test for the first player&#8217;s advantage:</p><pre class="brush: bash; title: ; notranslate">
function testItCanOutputAdvantageForFirstPlayer () {
	assertEquals 'John: Advantage' &quot;`displayScore 'John' 4 'Michael' 3`&quot;
}
</pre><p>And to make it pass:</p><pre class="brush: bash; title: ; notranslate">
function displayScore () {
	if [ $2 -gt 2 ] &amp;&amp; [ $4 -gt 2 ] &amp;&amp; [ $2 -eq $4 ]; then
		echo &quot;Deuce&quot;
	elif [ $2 -gt 2 ] &amp;&amp; [ $4 -gt 2 ] &amp;&amp; [ $2 -gt $4 ]; then
		echo &quot;$1: Advantage&quot;
	else
		echo &quot;$1: `convertToTennisScore $2` - $3: `convertToTennisScore $4`&quot;
	fi
}
</pre><p>There&#8217;s that ugly <code>if-elif-else</code> again, and we have a lot of duplication as well. All our tests pass, so let&#8217;s refactor:</p><pre class="brush: bash; title: ; notranslate">
function displayScore () {
	if outOfRegularScore $2 $4 ; then
		checkEquality $2 $4
		checkFirstPlayerAdv $1 $2 $4
	else
		echo &quot;$1: `convertToTennisScore $2` - $3: `convertToTennisScore $4`&quot;
	fi
}

function outOfRegularScore () {
	[ $1 -gt 2 ] &amp;&amp; [ $2 -gt 2 ]
	return $?
}

function checkEquality () {
	if [ $1 -eq $2 ]; then
		echo &quot;Deuce&quot;
	fi
}

function checkFirstPlayerAdv () {
	if [ $2 -gt $3 ]; then
		echo &quot;$1: Advantage&quot;
	fi
}
</pre><p>This&#8217;ll work for now. Let&#8217;s test the advantage for the second player:</p><pre class="brush: bash; title: ; notranslate">
function testItCanOutputAdvantageForSecondPlayer () {
	assertEquals 'Michael: Advantage' &quot;`displayScore 'John' 3 'Michael' 4`&quot;
}
</pre><p>And the code:</p><pre class="brush: bash; title: ; notranslate">
function displayScore () {
	if outOfRegularScore $2 $4 ; then
		checkEquality $2 $4
		checkAdvantage $1 $2 $3 $4
	else
		echo &quot;$1: `convertToTennisScore $2` - $3: `convertToTennisScore $4`&quot;
	fi
}

function checkAdvantage () {
	if [ $2 -gt $4 ]; then
		echo &quot;$1: Advantage&quot;
	elif [ $4 -gt $2 ]; then
		echo &quot;$3: Advantage&quot;
	fi
}
</pre><p>This works, but we have some duplication in the <code>checkAdvantage</code> function. Let&#8217;s simplify it and call it twice:</p><pre class="brush: bash; title: ; notranslate">
function displayScore () {
	if outOfRegularScore $2 $4 ; then
		checkEquality $2 $4
		checkAdvantage $1 $2 $4
		checkAdvantage $3 $4 $2
	else
		echo &quot;$1: `convertToTennisScore $2` - $3: `convertToTennisScore $4`&quot;
	fi
}

function checkAdvantage () {
	if [ $2 -gt $3 ]; then
		echo &quot;$1: Advantage&quot;
	fi
}</pre><p>This is actually better than our previous solution, and it reverts to the original implementation of this method. But we now we have another problem: I feel uncomfortable with the <code>$1</code>, <code>$2</code>, <code>$3</code> and <code>$4</code> variables. They need meaningful names:</p><pre class="brush: bash; title: ; notranslate">
function displayScore () {
	firstPlayerName=$1; firstPlayerScore=$2
	secondPlayerName=$3; secondPlayerScore=$4

	if outOfRegularScore $firstPlayerScore $secondPlayerScore; then
		checkEquality $firstPlayerScore $secondPlayerScore
		checkAdvantageFor $firstPlayerName $firstPlayerScore $secondPlayerScore
		checkAdvantageFor $secondPlayerName $secondPlayerScore $firstPlayerScore
	else
		echo &quot;$1: `convertToTennisScore $2` - $3: `convertToTennisScore $4`&quot;
	fi
}

function checkAdvantageFor () {
	if [ $2 -gt $3 ]; then
		echo &quot;$1: Advantage&quot;
	fi
}
</pre><p>This makes our code longer, but it is significantly more expressive. I like it.</p><p>It&#8217;s time to find a winner:</p><pre class="brush: bash; title: ; notranslate">
function testItCanOutputWinnerForFirstPlayer () {
	assertEquals 'John: Winner' &quot;`displayScore 'John' 5 'Michael' 3`&quot;
}
</pre><p>We only have to modify the <code>checkAdvantageFor</code> function:</p><pre class="brush: bash; title: ; notranslate">
function checkAdvantageFor () {
	if [ $2 -gt $3 ]; then
		if [ `expr $2 - $3` -gt 1 ]; then
			echo &quot;$1: Winner&quot;
		else
			echo &quot;$1: Advantage&quot;
		fi
	fi
}
</pre><p>We are almost done! As our last step, we&#8217;ll write the code in <code>tennisGame.sh</code> to make the acceptance test pass. This will be fairly simple code:</p><pre class="brush: bash; title: ; notranslate">
#! /usr/bin/env sh

### tennisGame.sh ###

. ./functions.sh

playersLine=`head -n 1 $1`
echo &quot;$playersLine&quot;
firstPlayer=`getFirstPlayerFrom &quot;$playersLine&quot;`
secondPlayer=`getSecondPlayerFrom &quot;$playersLine&quot;`

wholeScoreFileContent=`cat $1`
totalNoOfLines=`echo &quot;$wholeScoreFileContent&quot; | wc -l`
for currentLine in `seq 2 $totalNoOfLines`
	do
	firstPlayerScore=$(getScoreFor $firstPlayer &quot;`echo \&quot;$wholeScoreFileContent\&quot; | head -n $currentLine`&quot;)
	secondPlayerScore=$(getScoreFor $secondPlayer &quot;`echo \&quot;$wholeScoreFileContent\&quot; | head -n $currentLine`&quot;)
	displayScore $firstPlayer $firstPlayerScore $secondPlayer $secondPlayerScore
done
</pre><p>We read the first line to retrieve the names of the two players, and then we incrementally read the file to compute the score.</p><hr
/><h2>Final Thoughts</h2><p>Shell scripts can easily grow from a few lines of code to a few hundred of lines. When this happens, maintenance becomes increasingly difficult. Using TDD and unit testing can greatly help to make your complex script easier to maintain&mdash;not to mention that it forces you to build your complex scripts in a more professional manner.</p><div class="feedflare">
<a href="http://feeds.feedburner.com/~ff/nettuts?a=8e2tSC6ql7w:FU7kmOJl9R0:yIl2AUoC8zA"><img src="http://feeds.feedburner.com/~ff/nettuts?d=yIl2AUoC8zA" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=8e2tSC6ql7w:FU7kmOJl9R0:F7zBnMyn0Lo"><img src="http://feeds.feedburner.com/~ff/nettuts?i=8e2tSC6ql7w:FU7kmOJl9R0:F7zBnMyn0Lo" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=8e2tSC6ql7w:FU7kmOJl9R0:V_sGLiPBpWU"><img src="http://feeds.feedburner.com/~ff/nettuts?i=8e2tSC6ql7w:FU7kmOJl9R0:V_sGLiPBpWU" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=8e2tSC6ql7w:FU7kmOJl9R0:gIN9vFwOqvQ"><img src="http://feeds.feedburner.com/~ff/nettuts?i=8e2tSC6ql7w:FU7kmOJl9R0:gIN9vFwOqvQ" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=8e2tSC6ql7w:FU7kmOJl9R0:TzevzKxY174"><img src="http://feeds.feedburner.com/~ff/nettuts?d=TzevzKxY174" border="0"></img></a>
</div><img src="http://feeds.feedburner.com/~r/nettuts/~4/8e2tSC6ql7w" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:12:"Patkos Csaba";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:81:"http://net.tutsplus.com/tutorials/tools-and-tips/test-driving-shell-scripts/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:38:"http://purl.org/rss/1.0/modules/slash/";a:1:{s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:2:"16";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:76:"http://net.tutsplus.com/tutorials/tools-and-tips/test-driving-shell-scripts/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:5;a:6:{s:4:"data";s:11:"           ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:5:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:24:"Promise-Based Validation";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:54:"http://feedproxy.google.com/~r/nettuts/~3/g_CrQeWOv6w/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:84:"http://net.tutsplus.com/tutorials/javascript-ajax/promise-based-validation/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Thu, 25 Apr 2013 21:46:03 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:3:{i:0;a:5:{s:4:"data";s:17:"JavaScript & AJAX";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:1;a:5:{s:4:"data";s:9:"Tutorials";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:2;a:5:{s:4:"data";s:8:"promises";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:32:"http://net.tutsplus.com/?p=31473";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:18404:"<a
href='http://rss.buysellads.com/click.php?z=1260013&k=d754f1e9ba63a736ba8ff5ece958f7dd&a=31473&c=1458126849' target='_blank'><img
src='http://rss.buysellads.com/img.php?z=1260013&k=d754f1e9ba63a736ba8ff5ece958f7dd&a=31473&c=1458126849' border='0' alt='' /></a><p>The concept of &#8220;Promises&#8221; has changed the way we write asynchronous JavaScript. Over the past year, many frameworks have incorporated some form of the Promise pattern to make asynchronous code easier to write, read and maintain. For example, jQuery added <a
href="http://api.jquery.com/category/deferred-object/">$.Deferred()</a>, and NodeJS has the <a
href="http://documentup.com/kriskowal/q/">Q</a> and <a
href="https://github.com/dfilatov/jspromise">jspromise</a> modules that work on both client and server. Client-side MVC frameworks, such as <a
href="http://emberjs.com">EmberJS</a> and <a
href="http://angularjs.org/">AngularJS</a>, also implement their own versions of Promises.</p><p><span
id="more-31473"></span></p><p>But it doesn&#8217;t have to stop there: we can rethink older solutions and apply Promises to them. In this article, we&#8217;ll do just that: validate a form using the Promise pattern to expose a super simple API.</p><hr
/><h2>What is a Promise?</h2><blockquote
class="pullquote"><p> Promises notify the result of an operation.</p></blockquote><p>Simply put, Promises notify the result of an operation. The result can be a success or a failure, and the operation, itself, can be anything that abides by a simple contract. I chose to use the word <em>contract</em> because you can design this contract in several different ways. Thankfully, the development community reached a consensus and created a specification called <a
href="http://promises-aplus.github.io/promises-spec/">Promises/A+</a>.</p><p>Only the operation truly knows when it has completed; as such, it is responsibile for notifying its result using the Promises/A+ contract. In other words, it <em>promises</em> to tell you the final result on completion.</p><p>The operation returns a <code>promise</code> object, and you can attach your callbacks to it by using the <code>done()</code> or <code>fail()</code> methods. The operation can notify its outcome by calling <code>promise.resolve()</code> or <code>promise.reject()</code>, respectively. This is depicted in the following figure:</p> <figure
class='tutorial_image'><img
src='http://cdn.tutsplus.com/net.tutsplus.com/uploads/2013/04/promise-validation-promise.png' alt='Figure for Promises' title='' border='0'></figure><hr
/><h2>Using Promises for Form Validation</h2><p>Let me paint a plausible scenario.</p><blockquote
class="pullquote"><p>We can rethink older solutions and apply Promises to them.</p></blockquote><p>Client-side form validation always begins with the simplest of intentions. You may have a sign-up form with <em>Name</em> and <em>Email</em> fields, and you need to ensure that the user provides valid input for both fields. That seems fairly straightforward, and you start implementing your solution.</p><p>You are then told that email addresses must be unique, and you decide to validate the email address on the server. So, the user clicks the submit button, the server checks the email&#8217;s uniqueness and the page refreshes to display any errors. That seems like the right approach, right? Nope. Your client wants a slick user experience; visitors should see any error messages without refreshing the page.</p><p>Your form has the <em>Name</em> field that doesn&#8217;t require any server-side support, but then you have the <em>Email</em> field that requires you to make a request to the server. Server requests means <code>$.ajax()</code> calls, so you will have to perform email validation in your callback function. If your form has multiple fields that require server-side support, your code will be a nested mess of <code>$.ajax()</code> calls in callbacks. Callbacks inside callbacks: &#8220;Welcome to callback hell! We hope you have a miserable stay!&#8221;.</p><p>So, how do we handle callback hell?</p><h3>The Solution I Promised</h3><p>Take a step back and think about this problem. We have a set of operations that can either succeed or fail. Either of these results can be captured as a <code>Promise</code>, and the operations can be anything from simple client-side checks to complex server-side validations. Promises also give you the added benefit of consistency, as well as letting you avoid conditionally checking on the type of validation. Lets see how we can do this.</p><blockquote><p>As I noted earlier, there are several promise implementations in the wild, but I will focus on jQuery&#8217;s <a
href="http://api.jquery.com/deferred">$.Deferred()</a> Promise implementation.</p></blockquote><p>We will build a simple validation framework where every check immediately returns either a result or a Promise. As a user of this framework, you only have to remember one thing: <em>&#8220;it always returns a Promise&#8221;</em>. Lets get started.</p><h3>Validator Framework using Promises</h3><p>I think it&#8217;s easier to appreciate the simplicity of Promises from the consumer&#8217;s point of view. Lets say I have a form with three fields: Name, Email and Address:</p><pre class="brush: xml; title: ; notranslate">
&lt;form&gt;
  &lt;div class=&quot;row&quot;&gt;
    &lt;div class=&quot;large-4 columns&quot;&gt;
      &lt;label&gt;Name&lt;/label&gt;
      &lt;input type=&quot;text&quot; class=&quot;name&quot;/&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;div class=&quot;row&quot;&gt;
    &lt;div class=&quot;large-4 columns&quot;&gt;
      &lt;label&gt;Email&lt;/label&gt;
      &lt;input type=&quot;text&quot; class=&quot;email&quot;/&gt;
    &lt;/div&gt;
  &lt;/div&gt;

  &lt;div class=&quot;row&quot;&gt;
    &lt;div class=&quot;large-4 columns&quot;&gt;
      &lt;label&gt;Address&lt;/label&gt;
      &lt;input type=&quot;text&quot; class=&quot;address&quot;/&gt;
    &lt;/div&gt;
  &lt;/div&gt;

&lt;/form&gt;
</pre><p>I will first configure the validation criteria with the following object. This also serves as our framework&#8217;s API:</p><pre class="brush: jscript; title: ; notranslate">
var validationConfig = {
  '.name': {
    checks: 'required',
    field: 'Name'
  },
  '.email': {
    checks: ['required'],
    field: 'Email'
  },
  '.address': {
    checks: ['random', 'required'],
    field: 'Address'
  }
};
</pre><p>The keys of this config object are jQuery selectors; their values are objects with the following two properties:</p><ul><li><code>checks</code>: a string or array of validations.</li><li><code>field</code>: the human-readable field name, which will be used for reporting errors for that field</li></ul><p>We can call our validator, exposed as the global variable <code>V</code>, like this:</p><pre class="brush: jscript; title: ; notranslate">
V.validate(validationConfig)
  .done(function () {
      // Success
  })
  .fail(function (errors) {
      // Validations failed. errors has the details
  });
</pre><p>Note the use of the <code>done()</code> and <code>fail()</code> callbacks; these are the default callbacks for handing a Promise&#8217;s result. If we happen to add more form fields, you could simply augment the <code>validationConfig</code> object without disturbing the rest of the setup (the <a
href="http://en.wikipedia.org/wiki/Open/closed_principle">Open-Closed Principle</a> in action). In fact, we can add other validations, like the uniqueness constraint for email addresses, by extending the validator framework (which we will see later).</p><p>So that&#8217;s the consumer-facing API for the validator framework. Now, let&#8217;s dive in and see how it works under the hood.</p><h3>Validator, Under the Hood</h3><p>The validator is exposed as an object with two properties:</p><ul><li><code>type</code>: contains the different kinds of validations, and it is also serves as the extension point for adding more.</li><li><code>validate</code>: the core method that performs the validations based upon the provided config object.</li></ul><p>The overall structure can be summarized as:</p><pre class="brush: jscript; title: ; notranslate">
var V = (function ($) {

var validator = {

  /*
  * Extension point - just add to this hash
  * 
  * V.type['my-validator'] = {
  *   ok: function(value){ return true; },
  *   message: 'Failure message for my-validator'
  *   }
  */
  type: {
    'required': {
      ok: function (value) {
          // is valid ?
      },
      message: 'This field is required'
    },

    ...
  },

  /**
   *
   * @param config
   * {
   *   '&lt;jquery-selector&gt;': string | object | [ string ]
   * }
   */
  validate: function (config) {

    // 1. Normalize the configuration object  

    // 2. Convert each validation to a promise  

    // 3. Wrap into a master promise

    // 4. Return the master promise
  }
};

})(jQuery);
</pre><p>The <code>validate</code> method provides the underpinnings of this framework. As seen in the comments above, there are four steps that happen here:</p><p><strong>1. Normalize the configuration object.</strong></p><p>This is where we go through our config object and convert it into an internal representation. This is mostly to capture all the information we need to carry out the validation and report errors if necessary:</p><pre class="brush: jscript; title: ; notranslate">
function normalizeConfig(config) {
  config = config || {};

  var validations = [];

  $.each(config, function (selector, obj) {

    // make an array for simplified checking
    var checks = $.isArray(obj.checks) ? obj.checks : [obj.checks];

    $.each(checks, function (idx, check) {
      validations.push({
        control: $(selector),
        check: getValidator(check),
        checkName: check,
        field: obj.field
      });
    });

  });
  return validations;
}

function getValidator(type) {
  if ($.type(type) === 'string' &amp;&amp; validator.type[type]) return validator.type[type];

  return validator.noCheck;
}

</pre><p>This code loops over the keys in the config object and creates an internal representation of the validation. We will use this representation in the <code>validate</code> method.</p><p>The <code>getValidator()</code> helper fetches the validator object from the <code>type</code> hash. If we don&#8217;t find one, we return the <code>noCheck</code> validator which always returns true.</li></p><p><strong>2. Convert each validation to a Promise.</strong></p><p>Here, we ensure every validation is a Promise by checking the return value of <code>validation.ok()</code>. If it contains the <code>then()</code> method, we know it&#8217;s a Promise (this is as per the Promises/A+ spec). If not, we create an ad-hoc Promise that resolves or rejects depending on the return value.</p><pre class="brush: jscript; title: ; notranslate">    
validate: function (config) {
  // 1. Normalize the configuration object
  config = normalizeConfig(config);
  var promises = [],
    checks = [];

  // 2. Convert each validation to a promise
  $.each(config, function (idx, v) {
    var value = v.control.val();
    var retVal = v.check.ok(value);

    // Make a promise, check is based on Promises/A+ spec
    if (retVal.then) {
      promises.push(retVal);
    }
    else {
      var p = $.Deferred();

      if (retVal) p.resolve();
      else p.reject();

      promises.push(p.promise());
    }
    checks.push(v);
  });
  // 3. Wrap into a master promise

  // 4. Return the master promise
}
</pre><p><strong>3. Wrap into a master Promise.</strong></p><p>We created an array of Promises in the previous step. When they all succeed, we want to either resolve once or fail with detailed error information. We can do this by wrapping all of the Promises into a single Promise and propagate the result. If everything goes well, we just resolve on the master promise.</p><p>For errors, we can read from our internal validation representation and use it for reporting. Since there can be multiple validation failures, we loop over the <code>promises</code> array and read the <code>state()</code> result. We collect all of the rejected promises into the <code>failed</code> array and call <code>reject()</code> on the master promise:</p><pre class="brush: jscript; title: ; notranslate">
// 3. Wrap into a master promise
var masterPromise = $.Deferred();
$.when.apply(null, promises)
  .done(function () {
    masterPromise.resolve();
  })
  .fail(function () {
    var failed = [];
    $.each(promises, function (idx, x) {
      if (x.state() === 'rejected') {
        var failedCheck = checks[idx];
        var error = {
          check: failedCheck.checkName,
          error: failedCheck.check.message,
          field: failedCheck.field,
          control: failedCheck.control
        };
        failed.push(error);
      }
    });
    masterPromise.reject(failed);
  });

// 4. Return the master promise
return masterPromise.promise();
</pre><p><strong>4. Return the master promise.</strong></p><p>Finally we return the master promise from the <code>validate()</code> method. This is the Promise on which the client code sets up the <code>done()</code> and <code>fail()</code> callbacks.</p><p>Steps two and three are the crux of this framework. By normalizing the validations into a Promise, we can handle them consistently. We have more control with a master Promise object, and we can attach additional contextual information that may be useful to the end user.</p><hr
/><h2>Using the Validator</h2><p>See the demo file for a full use of the validator framework. We use the <code>done()</code> callback to report success and <code>fail()</code> to show a list of errors against each of the fields. The screenshots below show the success and failure states:</p> <figure
class='tutorial_image'><img
src='http://cdn.tutsplus.com/net.tutsplus.com/uploads/2013/04/promise-validation-demo-success.png' alt='Demo showing Success' title='' border='0'></figure> <figure
class='tutorial_image'><img
src='http://cdn.tutsplus.com/net.tutsplus.com/uploads/2013/04/promise-validation-demo-failure.png' alt='Demo showing failures' title='' border='0'></figure><p>The demo uses the same HTML and validation configuration mentioned earlier in this article. The only addition is the code that displays the alerts. Note the use of the <code>done()</code> and <code>fail()</code> callbacks to handle the validation results.</p><pre class="brush: jscript; title: ; notranslate">
function showAlerts(errors) {
  var alertContainer = $('.alert');
  $('.error').remove();

  if (!errors) {
    alertContainer.html('&lt;small class=&quot;label success&quot;&gt;All Passed&lt;/small&gt;');
  } else {
    $.each(errors, function (idx, err) {
      var msg = $('&lt;small&gt;&lt;/small&gt;')
          .addClass('error')
          .text(err.error);

      err.control.parent().append(msg);
    });
  }
}

$('.validate').click(function () {

  $('.indicator').show();
  $('.alert').empty();

  V.validate(validationConfig)
      .done(function () {
        $('.indicator').hide();
        showAlerts();
      })
      .fail(function (errors) {
        $('.indicator').hide();
        showAlerts(errors);
      });

});
</pre><h3>Extending the Validator</h3><p>I mentioned earlier that we can add more validation operations to the framework by extending the validator&#8217;s <code>type</code> hash. Consider the <code>random</code> validator as an example. This validator randomly succeeds or fails. I know its not a useful validator, but it&#8217;s worth noting some of its concepts:</p><ul><li>Use <code>setTimeout()</code> to make the validation async. You can also think of this as simulating network latency.</li><li>Return a Promise from the <code>ok()</code> method.</li></ul><pre class="brush: jscript; title: ; notranslate">  
// Extend with a random validator
V.type['random'] = {
  ok: function (value) {
    var deferred = $.Deferred();

    setTimeout(function () {
      var result = Math.random() &lt; 0.5;
      if (result) deferred.resolve();
      else deferred.reject();

    }, 1000);

    return deferred.promise();
  },
  message: 'Failed randomly. No hard feelings.'
};
</pre><p>In the demo, I used this validation on the <em>Address</em> field like so:</p><pre class="brush: jscript; title: ; notranslate">
var validationConfig = {
  /* cilpped for brevity */

  '.address': {
    checks: ['random', 'required'],
    field: 'Address'
  }
};
</pre><hr
/><h2>Summary</h2><p>I hope that this article has given you a good idea of how you can apply Promises to old problems and build your own framework around them. The Promise-based approach is a fantastic solution to abstract operations that may or may not run synchronously. You can also chain callbacks and even compose higher-order Promises from a set of other Promises.</p><p>The Promise pattern is applicable in a variety of scenarios, and you&#8217;ll hopefully encounter some of them and see an immediate match!</p><hr
/><h2>References</h2><ul><li><a
href="http://promises-aplus.github.io/promises-spec/">Promises/A+ spec</a></li><li><a
href="http://api.jquery.com/category/deferred-object/">jQuery.Deferred()</a></li><li><a
href="http://documentup.com/kriskowal/q/">Q</a></li><li><a
href="https://github.com/dfilatov/jspromise">jspromise</a></li></ul><div class="feedflare">
<a href="http://feeds.feedburner.com/~ff/nettuts?a=g_CrQeWOv6w:gXDzrJ7UQEk:yIl2AUoC8zA"><img src="http://feeds.feedburner.com/~ff/nettuts?d=yIl2AUoC8zA" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=g_CrQeWOv6w:gXDzrJ7UQEk:F7zBnMyn0Lo"><img src="http://feeds.feedburner.com/~ff/nettuts?i=g_CrQeWOv6w:gXDzrJ7UQEk:F7zBnMyn0Lo" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=g_CrQeWOv6w:gXDzrJ7UQEk:V_sGLiPBpWU"><img src="http://feeds.feedburner.com/~ff/nettuts?i=g_CrQeWOv6w:gXDzrJ7UQEk:V_sGLiPBpWU" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=g_CrQeWOv6w:gXDzrJ7UQEk:gIN9vFwOqvQ"><img src="http://feeds.feedburner.com/~ff/nettuts?i=g_CrQeWOv6w:gXDzrJ7UQEk:gIN9vFwOqvQ" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=g_CrQeWOv6w:gXDzrJ7UQEk:TzevzKxY174"><img src="http://feeds.feedburner.com/~ff/nettuts?d=TzevzKxY174" border="0"></img></a>
</div><img src="http://feeds.feedburner.com/~r/nettuts/~4/g_CrQeWOv6w" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:12:"Pavan Podila";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:80:"http://net.tutsplus.com/tutorials/javascript-ajax/promise-based-validation/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:38:"http://purl.org/rss/1.0/modules/slash/";a:1:{s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:2:"17";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:75:"http://net.tutsplus.com/tutorials/javascript-ajax/promise-based-validation/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:6;a:6:{s:4:"data";s:11:"           ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:5:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:27:"Testing Laravel Controllers";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:54:"http://feedproxy.google.com/~r/nettuts/~3/AtMxwaB4LZA/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:75:"http://net.tutsplus.com/tutorials/php/testing-laravel-controllers/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Tue, 23 Apr 2013 17:13:10 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:3:{i:0;a:5:{s:4:"data";s:3:"PHP";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:1;a:5:{s:4:"data";s:7:"laravel";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:2;a:5:{s:4:"data";s:3:"tdd";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:32:"http://net.tutsplus.com/?p=31456";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:37562:"<a
href='http://rss.buysellads.com/click.php?z=1260013&k=d754f1e9ba63a736ba8ff5ece958f7dd&a=31456&c=914510113' target='_blank'><img
src='http://rss.buysellads.com/img.php?z=1260013&k=d754f1e9ba63a736ba8ff5ece958f7dd&a=31456&c=914510113' border='0' alt='' /></a><p>Testing controllers isn&#8217;t the easiest thing in the world. Well, let me rephrase that: testing them is a cinch; what&#8217;s difficult, at least at first, is determining <em>what</em> to test.</p><p>Should a controller test verify text on the page? Should it touch the database? Should it ensure that variables exist in the view? If this is your first hay-ride, these things can be confusing! Let me help.</p><p><span
id="more-31456"></span></p><blockquote><p>Controller tests should verify responses, ensure that the correct database access methods are triggered, and assert that the appropriate instance variables are sent to the view.</p></blockquote><p>The process of testing a controller can be divided into three pieces.</p><ul><li><strong>Isolate:</strong> Mock all dependencies (perhaps excluding the <code>View</code>).</li><li><strong>Call:</strong> Trigger the desired controller method.</li><li><strong>Ensure:</strong> Perform assertions, verifying that the stage has been set properly.</li></ul><hr
/><h2>The Hello World of Controller Testing</h2><p>The best way to learn these things is through examples. Here&#8217;s the &quot;<em>hello world</em>&quot; of controller testing in Laravel.</p><pre class="brush: php; title: ; notranslate">
&lt;?php

# app/tests/controllers/PostsControllerTest.php

class PostsControllerTest extends TestCase {

  public function testIndex()
  {
      $this-&gt;client-&gt;request('GET', 'posts');
  }

}
</pre><p>Laravel leverages a handful of Symfony&#8217;s components to ease the process of testing routes and views, including HttpKernel, DomCrawler, and BrowserKit. This is why it&#8217;s paramount that your PHPUnit tests inherit from, not <code>PHPUnit\_Framework\_TestCase</code>, but <code>TestCase</code>. Don&#8217;t worry, Laravel still extends the former, but it helps setup the Laravel app for testing, as well as provides a variety of helper assertion methods that you are encouraged to use. More on that shortly.</p><p>In the code snippet above, we make a <code>GET</code> request to <code>/posts</code>, or <code>localhost:8000/posts</code>. Assuming that this line is added to a fresh installation of Laravel, Symfony will throw a <code>NotFoundHttpException</code>. If working along, try it out by running <code>phpunit</code> from the command line.</p><pre class="brush: bash; title: ; notranslate">
$ phpunit
1) PostsControllerTest::testIndex
Symfony\Component\HttpKernel\Exception\NotFoundHttpException:
</pre><p>In <em>human-speak</em>, this essentially translates to, &quot;<em>Hey, I tried to call that route, but you don&#8217;t have anything registered, fool!</em>&quot;</p><p>As you can imagine, this type of request is common enough to the point that it makes sense to provide a helper method, such as <code>$this-&gt;call()</code>. In fact, Laravel does that very thing! This means that the previous example can be refactored, like so:</p><pre class="brush: php; title: ; notranslate">
#app/tests/controllers/PostsControllerTest.php

public function testIndex()
{
    $this-&gt;call('GET', 'posts');
}
</pre><h3>Overloading is Your Friend</h3><p>Though we&#8217;ll stick with the base functionality in this chapter, in my personal projects, I take things a step further by allowing for such methods as <code>$this-&gt;get()</code>, <code>$this-&gt;post()</code>, etc. Thanks to PHP overloading, this only requires the addition of a single method, which you could add to <code>app/tests/TestCase.php</code>.</p><pre class="brush: php; title: ; notranslate">
# app/tests/TestCase.php

public function __call($method, $args)
{
    if (in_array($method, ['get', 'post', 'put', 'patch', 'delete']))
    {
        return $this-&gt;call($method, $args[0]);
    }

    throw new BadMethodCallException;
}
</pre><p>Now, you&#8217;re free to write <code>$this-&gt;get('posts')</code> and achieve the exact same result as the previous two examples. As noted above, however, let&#8217;s stick with the framework&#8217;s base functionality for simplicity&#8217;s sake.</p><p>To make the test pass, we only need to prepare the proper route.</p><pre class="brush: php; title: ; notranslate">
&lt;?php

# app/routes.php

Route::get('posts', function()
{
    return 'all posts';
});
</pre><p>Running <code>phpunit</code> again will return us to green.</p><hr
/><h2>Laravel&#8217;s Helper Assertions</h2><p>A test that you&#8217;ll find yourself writing repeatedly is one that ensures that a controller passes a particular variable to a view. For example, the <code>index</code> method of <code>PostsController</code> should pass a <code>$posts</code> variable to its associated view, right? That way, the view can filter through all posts, and display them on the page. This is an important test to write!</p><p>If it&#8217;s that common a task, then, once again, wouldn&#8217;t it make sense for Laravel to provide a helper assertion to accomplish this very thing? Of course it would. And, of course, Laravel does!</p><p><code>Illuminate\Foundation\Testing\TestCase</code> includes a number of methods that will drastically reduce the amount of code needed to perform basic assertions. This list includes:</p><ul><li><code>assertViewHas</code></li><li><code>assertResponseOk</code></li><li><code>assertRedirectedTo</code></li><li><code>assertRedirectedToRoute</code></li><li><code>assertRedirectedToAction</code></li><li><code>assertSessionHas</code></li><li><code>assertSessionHasErrors</code></li></ul><p>The following examples calls <code>GET /posts</code> and verifies that its views receives the variable, <code>$posts</code>.</p><pre class="brush: php; title: ; notranslate">
# app/tests/controllers/PostsControllerTest.php

public function testIndex()
{
    $this-&gt;call('GET', 'posts');

    $this-&gt;assertViewHas('posts');
}
</pre><blockquote><p><strong>Tip:</strong> When it comes to formatting, I prefer to provide a line break between a test&#8217;s assertion and the code that prepares the stage.</p></blockquote><p><code>assertViewHas</code> is simply a bit of sugar that inspects the response object &#8211; which is returned from <code>$this-&gt;call()</code> &#8211; and verifies that the data associated with the view contains a <code>posts</code> variable.</p><p>When inspecting the response object, you have two core choices.</p><ul><li><code>$response-&gt;getOriginalContent()</code>: Fetch the original content, or the returned <code>View</code>. Optionally, you may access the <code>original</code> property directly, rather than calling the <code>getOriginalContent</code> method.</li><li><code>$response-&gt;getContent()</code>: Fetch the rendered output. If a <code>View</code> instance is returned from the route, then <code>getContent()</code> will be equal to the HTML output. This can be helpful for DOM verifications, such as &quot;<em>the view must contain this string.</em>&quot;</li></ul><p>Let&#8217;s assume that the <code>posts</code> route consists of:</p><pre class="brush: php; title: ; notranslate">
&lt;?php

# app/routes.php

Route::get('posts', function()
{
    return View::make('posts.index');
});
</pre><p>Should we run <code>phpunit</code>, it will squawk with a helpful <em>next step</em> message:</p><pre class="brush: bash; title: ; notranslate">
1) PostsControllerTest::testIndex
Failed asserting that an array has the key 'posts'.
</pre><p>To make it green, we simply fetch the posts and pass it to the view.</p><pre class="brush: php; title: ; notranslate">

# app/routes.php

Route::get('posts', function()
{
    $posts = Post::all();

    return View::make('posts.index', ['posts', $posts]);
});
</pre><p>One thing to keep in mind is that, as the code currently stands, it only ensures that the variable, <code>$posts</code>, is passed to the view. It doesn&#8217;t inspect its value. The <code>assertViewHas</code> optionally accepts a second argument to verify the value of the variable, as well as its existence.</p><pre class="brush: php; title: ; notranslate">

# app/tests/controllers/PostsControllerTest.php

public function testIndex()
{
    $this-&gt;call('GET', 'posts');

    $this-&gt;assertViewHas('posts', 'foo');
}
</pre><p>With this modified code, unles the view has a variable, <code>$posts</code>, that is equal to <code>foo</code>, the test will fail. In this situation, though, it&#8217;s likely that we&#8217;d rather not specify a value, but instead declare that the value be an instance of Laravel&#8217;s <code>Illuminate\Database\Eloquent\Collection</code> class. How might we accomplish that? PHPUnit provides a helpful <code>assertInstanceOf</code> assertion to fill this very need!</p><pre class="brush: php; title: ; notranslate">

# app/tests/controllers/PostsControllerTest.php

public function testIndex()
{
    $response = $this-&gt;call('GET', 'posts');

    $this-&gt;assertViewHas('posts');

    // getData() returns all vars attached to the response.
    $posts = $response-&gt;original-&gt;getData()['posts'];

    $this-&gt;assertInstanceOf('Illuminate\Database\Eloquent\Collection', $posts);
}
</pre><p>With this modification, we&#8217;ve declared that the controller <strong>must</strong> pass <code>$posts</code> &#8211; an instance of <code>Illuminate\Database\Eloquent\Collection</code> &#8211; to the view. Excellent.</p><hr
/><h2>Mocking the Database</h2><p>There&#8217;s one glaring problem with our tests so far. Did you catch it?</p><blockquote><p>For each test, a SQL query is being executed on the database. Though this is useful for certain kinds of testing (acceptance, integration), for basic controller testing, it will only serve to decrease performance.</p></blockquote><p>I&#8217;ve drilled this into your skull multiple times at this point. We&#8217;re not interested in testing Eloquent&#8217;s ability to fetch records from a database. It has its own tests. Taylor knows it works! Let&#8217;s not waste time and processing power repeating those same tests.</p><p>Instead, it&#8217;s best to mock the database, and merely verify that the appropriate methods are called with the correct arguments. Or, in other words, we want to ensure that <code>Post::all()</code> never fires and hits the database. We know that works, so it doesn&#8217;t require testing.</p><p>This section will depend heavily on the Mockery library. Please review that chapter <a
href="http://leanpub.com/laravel-testing-decoded">from my book</a>, if you&#8217;re not yet familiar with it.</p><h3>Required Refactoring</h3><p>Unfortunately, so far, we&#8217;ve structured the code in a way that makes it virtually impossible to test.</p><pre class="brush: php; title: ; notranslate">
# app/routes.php

Route::get('posts', function()
{
    // Ouch. We can't test this!!
    $posts = Post::all();

    return View::make('posts.index')
        -&gt;with('posts', $posts);
});
</pre><p>This is precisely why it&#8217;s considered bad practice to nest Eloquent calls into your controllers. Don&#8217;t confuse Laravel&#8217;s facades, which are testable and can be swapped out with mocks (<code>Queue::shouldReceive()</code>), with your Eloquent models. The solution is to inject the database layer into the controller through the constructor. This requires some refactoring.</p><blockquote><p><strong>Warning:</strong> Storing logic within route callbacks is useful for small projects and APIs, but they make testing incredibly difficult. For applications of any considerable size, use controllers.</p></blockquote><p>Let&#8217;s register a new resource by replacing   the <code>posts</code> route with:</p><pre class="brush: php; title: ; notranslate">
# app/routes.php

Route::resource('posts', 'PostsController');
</pre><p>&#8230;and create the necessary resourceful controller with Artisan.</p><pre class="brush: bash; title: ; notranslate">
$ php artisan controller:make PostsController
Controller created successfully!
</pre><p>Now, rather than referencing the <code>Post</code> model directly, we&#8217;ll inject it into the controller&#8217;s constructor. Here&#8217;s a condensed example that omits all restful methods except the one that we&#8217;re currently interested in testing.</p><pre class="brush: php; title: ; notranslate">
&lt;?php

# app/controllers/PostsController.php

class PostsController extends BaseController {

  protected $post;

  public function __construct(Post $post)
  {
      $this-&gt;post = $post;
  }

  public function index()
  {
      $posts = $this-&gt;post-&gt;all();

      return View::make('posts.index')
          -&gt;with('posts', $posts);
  }

}
</pre><blockquote><p>Please note that it&#8217;s a better idea to typehint an interface, rather than reference the Eloquent model, itself. But, one thing at a time! Let&#8217;s work up to that.</p></blockquote><p>This is a significantly better way to structure the code. Because the model is now injected, we have the ability to swap it out with a mocked version for testing. Here&#8217;s an example of doing just that:</p><pre class="brush: php; title: ; notranslate">
&lt;?php

# app/tests/controllers/PostsControllerTest.php

class PostsControllerTest extends TestCase {

  public function __construct()
  {
      // We have no interest in testing Eloquent
      $this-&gt;mock = Mockery::mock('Eloquent', 'Post');
  }

  public function tearDown()
  {
      Mockery::close();
  }

  public function testIndex()
  {
      $this-&gt;mock
           -&gt;shouldReceive('all')
           -&gt;once()
           -&gt;andReturn('foo');

      $this-&gt;app-&gt;instance('Post', $this-&gt;mock);

      $this-&gt;call('GET', 'posts');

      $this-&gt;assertViewHas('posts');
  }

}
</pre><p>The key benfit to this restructuring is that, now, the database will never needlessly be hit. Instead, using Mockery, we merely verify that the <code>all</code> method is triggered on the model.</p><pre class="brush: php; title: ; notranslate">
$this-&gt;mock
    -&gt;shouldReceive('all')
    -&gt;once();
</pre><p>Unfortunately, if you choose to forego coding to an interface, and instead inject the <code>Post</code> model into the controller, a bit of trickery has to be used in order to get around Eloquent&#8217;s use of statics, which can clash with Mockery. This is why we hijack both the <code>Post</code> and <code>Eloquent</code> classes within the test&#8217;s constructor, before the official versions have been loaded. This way, we have a clean slate to declare any expectations. The downside, of course, is that we can&#8217;t default to any existing methods, through the use of Mockery methods, like <code>makePartial()</code>.</p><h3>The IoC Container</h3><p>Laravel&#8217;s IoC container drastically eases the process of injecting dependencies into your classes. Each time a controller is requested, it is resolved out of the IoC container. As such, when we need to declare that a mock version of <code>Post</code> should be used for testing, we only need to provide Laravel with the instance of <code>Post</code> that should be used.</p><pre class="brush: php; title: ; notranslate">
$this-&gt;app-&gt;instance('Post', $this-&gt;mock);
</pre><blockquote><p>Think of this code as saying, &quot;<em>Hey Laravel, when you need an instance of <code>Post</code>, I want you to use my mocked version.</em>&quot; Because the app extends the <code>Container</code>, we have access to all IoC methods directly off of it.</p></blockquote><p>Upon instantiation of the controller, Laravel leverages the power of PHP reflection to read the typehint and inject the dependency for you. That&#8217;s right; you don&#8217;t have to write a single binding to allow for this; it&#8217;s automated!</p><hr
/><h2>Redirections</h2><p>Another common expectation that you&#8217;ll find yourself writing is one that ensures that the user is redirected to the proper location, perhaps upon adding a new post to the database. How might we accomplish this?</p><pre class="brush: php; title: ; notranslate">
# app/tests/controllers/PostsControllerTest.php

public function testStore()
{
    $this-&gt;mock
         -&gt;shouldReceive('create')
         -&gt;once();

    $this-&gt;app-&gt;instance('Post', $this-&gt;mock);

    $this-&gt;call('POST', 'posts');

    $this-&gt;assertRedirectedToRoute('posts.index');

}
</pre><p>Assuming that we&#8217;re following a restful flavor, to add a new post, we&#8217;d <code>POST</code> to the collection, or <code>posts</code> (don&#8217;t confuse the <code>POST</code> request method with the resource name, which just happens to have the same name).</p><pre class="brush: php; title: ; notranslate">
$this-&gt;call('POST', 'posts');
</pre><p>Then, we only need to leverage another of Laravel&#8217;s helper assertions, <code>assertRedirectedToRoute</code>.</p><blockquote><p><strong>Tip:</strong> When a resource is registered with Laravel (<code>Route::resource()</code>), the framework will automatically register the necessary named routes. Run <code>php artisan routes</code> if you ever forget what these names are.</p></blockquote><p>You might prefer to also ensure that the <code>$_POST</code> superglobal is passed to the <code>create</code> method. Even though we aren&#8217;t physically submitting a form, we can still allow for this, via the <code>Input::replace()</code> method, which allows us to &quot;stub&quot; this array. Here&#8217;s the modified test, which uses Mockery&#8217;s <code>with()</code> method to verify the arguments passed to the method referenced by <code>shouldReceive</code>.</p><pre class="brush: php; title: ; notranslate">
# app/tests/controllers/PostsControllerTest.php

public function testStore()
{
    Input::replace($input = ['title' =&gt; 'My Title']);&lt;/p&gt;

    $this-&gt;mock
         -&gt;shouldReceive('create')
         -&gt;once()
         -&gt;with($input);

    $this-&gt;app-&gt;instance('Post', $this-&gt;mock);

    $this-&gt;call('POST', 'posts');

    $this-&gt;assertRedirectedToRoute('posts.index');
}
</pre><hr
/><h2>Paths</h2><p>One thing that we haven&#8217;t considered in this test is validation. There should be two separate paths through the <code>store</code> method, dependent upon whether the validation passes:</p><ol><li>Redirect back to the &quot;Create Post&quot; form, and display the form validation errors.</li><li>Redirect to the collection, or the named route, <code>posts.index</code>.</li></ol><blockquote><p>As a best practice, each test should represent but one path through your code.</p></blockquote><p>This first path will be for failed validation.</p><pre class="brush: php; title: ; notranslate">
# app/tests/controllers/PostsControllerTest.php

public function testStoreFails()
{
    // Set stage for a failed validation
    Input::replace(['title' =&gt; '']);

    $this-&gt;app-&gt;instance('Post', $this-&gt;mock);

    $this-&gt;call('POST', 'posts');

    // Failed validation should reload the create form
    $this-&gt;assertRedirectedToRoute('posts.create');

    // The errors should be sent to the view
    $this-&gt;assertSessionHasErrors(['title']);
}
</pre><p>The code snippet above explicitly declares which errors should exist. Alternatively, you may omit the argument to <code>assertSessionHasErrors</code>, in which case it will merely verify that a message bag has been flashed (in translation, your Redirection includes <code>withErrors($errors)</code>).</p><p>Now for the test that handles successful validation.</p><pre class="brush: php; title: ; notranslate">
# app/tests/controllers/PostsControllerTest.php

public function testStoreSuccess()
{
    // Set stage for successful validation
    Input::replace(['title' =&gt; 'Foo Title']);&lt;/p&gt;

    $this-&gt;mock
         -&gt;shouldReceive('create')
         -&gt;once();

    $this-&gt;app-&gt;instance('Post', $this-&gt;mock);

    $this-&gt;call('POST', 'posts');

    // Should redirect to collection, with a success flash message
    $this-&gt;assertRedirectedToRoute('posts.index', ['flash']);
}
</pre><p>The production code for these two tests might look like:</p><pre class="brush: php; title: ; notranslate">
# app/controllers/PostsController.php

public function store()
{
    $input = Input::all();

    // We'll run validation in the controller for convenience
    // You should export this to the model, or a service
    $v = Validator::make($input, ['title' =&gt; 'required']);

    if ($v-&gt;fails())
    {
        return Redirect::route('posts.create')
            -&gt;withInput()
            -&gt;withErrors($v-&gt;messages());
    }

    $this-&gt;post-&gt;create($input);

    return Redirect::route('posts.index')
        -&gt;with('flash', 'Your post has been created!');
}
</pre><p>Notice how the <code>Validator</code> is nested directly in the controller? Generally, I&#8217;d recommend that you abstract this away to a service. That way, you can test your validation in isolation from any controllers or  routes. Nonetheless, let&#8217;s leave things as they are for simplicity&#8217;s sake. One thing to keep in mind is that we aren&#8217;t mocking the <code>Validator</code>, though you certainly could do so. Because this class is a facade, it can easily be swapped out with a mocked version, via the Facade&#8217;s <code>shouldReceive</code> method, without us needing to worry about injecting an instance through the constructor. Win!</p><pre class="brush: php; title: ; notranslate">
# app/controllers/PostsController.php

Validator::shouldReceive('make')
    -&gt;once()
    -&gt;andReturn(Mockery::mock(['fails' =&gt; 'true']));
</pre><p>From time to time, you&#8217;ll find that a method that needs to be mocked should return an object, itself. Luckily, with Mockery, this is a piece of cake: we only need to create an anonymous mock, and pass an array, which signals the method name and response value, respectively. As such:</p><pre class="brush: php; title: ; notranslate">
Mockery::mock(['fails' =&gt; 'true'])
</pre><p>will prepare an object, containing a <code>fails()</code> method that returns <code>true</code>.</p><hr
/><h2>Repositories</h2><p>To allow for optimal flexibility, rather than creating a direct link between your controller and an ORM, like Eloquent, it&#8217;s better to code to an interface. The considerable advantage to this approach is that, should you perhaps need to swap out Eloquent for, say, Mongo or Redis, doing so literally requires the modification of a single line. Even better, the controller doesn&#8217;t ever need to be touched.</p><blockquote><p>Repositories represent the data access layer of your application.</p></blockquote><p>What might an interface for managing the database layer of a <code>Post</code> look like? This should get you started.</p><pre class="brush: php; title: ; notranslate">
&lt;?php

# app/repositories/PostRepositoryInterface.php

interface PostRepositoryInterface {

    public function all();

    public function find($id);

    public function create($input);

}
</pre><p>This can certainly be extended, but we&#8217;ve added the bare minimum methods for the demo: <code>all</code>, <code>find</code>, and <code>create</code>. Notice that the repository interfaces are being stored within <code>app/repositories</code>. Because this folder is not autoloaded by default, we need to update the <code>composer.json</code> file for the application to reference it.</p><pre class="brush: jscript; title: ; notranslate">
// composer.json

&quot;autoload&quot;: {
  &quot;classmap&quot;: [
    // ....
    &quot;app/repositories&quot;
  ]
}
</pre><blockquote><p>When a new class is added to this directory, don&#8217;t forget to <code>composer dump-autoload -o</code>. The <code>-o</code>, (<em>optimize</em>) flag is optional, but should always be used, as a best practice.</p></blockquote><p>If you attempt to inject this interface into your controller, Laravel will snap at you. Go ahead; try it out and see. Here&#8217;s the modified <code>PostController</code>, which has been updated to inject an interface, rather than the <code>Post</code> Eloquent model.</p><pre class="brush: php; title: ; notranslate">
&lt;?php

# app/controllers/PostsController.php

use Repositories\PostRepositoryInterface as Post;

class PostsController extends BaseController {

    protected $post;

    public function __construct(Post $post)
    {
        $this-&gt;post = $post;
    }

    public function index()
    {
        $posts = $this-&gt;post-&gt;all();

        return View::make('posts.index', ['posts' =&gt; $posts]);
    }

}
</pre><p>If you run the server and view the output, you&#8217;ll be met with the dreaded (but beautiful) Whoops error page, declaring that &quot;<em>PostRepositoryInterface is not instantiable.</em>&quot;</p> <figure
class=tutorial_image> <img
src="http://cdn.tutsplus.com/net.tutsplus.com/uploads/2013/04/instantiable.jpg" alt="Not Instantiable"><br
/> </figure><p>If you think about it, of course the framework is squawking! Laravel is smart, but it&#8217;s not a mind reader. It needs to be told which implementation of the interface should be used within the controller.</p><p>For now, let&#8217;s add this binding to <code>app/routes.php</code>. Later, we&#8217;ll instead make use of service providers to store this sort of logic.</p><pre class="brush: php; title: ; notranslate">
# app/routes.php

App::bind(
    'Repositories\PostRepositoryInterface',
    'Repositories\EloquentPostRepository'
);
</pre><p>Verbalize this function call as, &quot;<em>Laravel, baby, when you need an instance of <code>PostRepositoryInterface</code>, I want you to use <code>EloquentPostRepository</code>.</em>&quot;</p><p><code>app/repositories/EloquentPostRepository</code> will simply be a wrapper around Eloquent that implements <code>PostRepositoryInterface</code>. This way, we&#8217;re not restricting the API (and every other implementation) to Eloquent&#8217;s interpretation; we can name the methods however we wish.</p><pre class="brush: php; title: ; notranslate">
&lt;?php namespace Repositories;

# app/repositories/EloquentPostRepository.php

use Repositories\PostRepositoryInterface;
use Post;

class EloquentPostRepository implements PostRepositoryInterface {

  public function all()
  {
      return Post::all();
  }

  public function find($id)
  {
      return Post::find($id);
  }

  public function create($input)
  {
      return Post::create($input);
  }

}
</pre><blockquote><p>Some might argue that the <code>Post</code> model should be injected into this implementation for testability purposes. If you agree, simply inject it through the constructor, per usual.</p></blockquote><p>That&#8217;s all it should take! Refresh the browser, and things should be back to normal. Only, now, your application is far better structured, and the controller is no longer linked to Eloquent.</p><p>Let&#8217;s imagine that, a few months from now, your boss informs you that you need to swap Eloquent out with Redis. Well, because you&#8217;ve structured your application in this future-proof way, you only need to create the new <code>app/repositories/RedisPostRepository</code> implementation:</p><pre class="brush: php; title: ; notranslate">
&lt;?php namespace Repositories;

# app/repositories/RedisPostRepository.php

use Repositories\PostRepositoryInterface;

class RedisPostRepository implements PostRepositoryInterface {

  public function all()
  {
      // return all with Redis
  }

  public function find($id)
  {
      // return find one with Redis
  }

  public function create($input)
  {
      // return create with Redis
  }

}
</pre><p>And update the binding:</p><pre class="brush: php; title: ; notranslate">
# app/routes.php

App::bind(
    'Repositories\PostRepositoryInterface',
    'Repositories\RedisPostRepository'
);
</pre><p>Instantly, you&#8217;re now leveraging Redis in your controller. Notice how <code>app/controllers/PostsController.php</code> was never touched? That&#8217;s the beauty of it!</p><hr
/><h2>Structure</h2><p>So far in this lesson, our organization has been a bit lacking. IoC bindings in the <code>routes.php</code> file? All repositories grouped together in one directory? Sure, that may work in the beginning, but, very quickly, it&#8217;ll become apparent that this doesn&#8217;t scale.</p><p>In the final section of this article, we&#8217;ll PSR-ify our code, and leverage service providers to register any applicable bindings.</p><blockquote><p>PSR-0 defines the mandatory requirements that must be adhered to for autoloader interoperability.</p></blockquote><p>A PSR-0 loader may be registered with Composer, via the <code>psr-0</code> object.</p><pre class="brush: jscript; title: ; notranslate">
// composer.json

&quot;autoload&quot;: {
    &quot;psr-0&quot;: {
        &quot;Way&quot;: &quot;app/lib/&quot;
    }
}
</pre><p>The syntax can be confusing at first. It certainly was for me. An easy way to decipher <code>&quot;Way&quot;: &quot;app/lib/&quot;</code> is to think to yourself, &quot;<em>The base folder for the <code>Way</code> namespace is located in <code>app/lib</code>.</em>&quot; Of course, replace my last name with the name of your project. The directory structure to match this would be:</p><ul><li>app/<ul><li>lib/</li><li>Way/</li></ul></li></ul><p>Next, rather than grouping all repositories into a <code>repositories</code> directory, a more elegant approach might be to categorize them into multiple directories, like so:</p><ul><li>app/<ul><li>lib/</li><li>Way/<ul><li>Storage/</li><li>Post/<ul><li>PostRepositoryInterface.php</li><li>EloquentPostRepository.php</li></ul></li></ul></li></ul></li></ul><p>It&#8217;s vital that we adhere to this naming and folder convention, if we want the autoloading to work as expected. The only remaining thing to do is update the namespaces for <code>PostRepositoryInterface</code> and <code>EloquentPostRepository</code>.</p><pre class="brush: php; title: ; notranslate">
&lt;?php namespace Way\Storage\Post;

# app/lib/Way/Storage/Post/PostRepositoryInterface.php

interface PostRepositoryInterface {

    public function all();

    public function find($id);

    public function create($input);

}
</pre><p>And for the implementation:</p><pre class="brush: php; title: ; notranslate">
&lt;?php namespace Way\Storage\Post;

# app/lib/Way/Storage/Post/EloquentPostRepository.php

use Post;

class EloquentPostRepository implements PostRepositoryInterface {

    public function all()
    {
        return Post::all();
    }

    public function find($id)
    {
        return Post::find($id);
    }

    public function create($input)
    {
        return Post::create($input);
    }

}
</pre><p>There we go; that&#8217;s much cleaner. But what about those pesky bindings? The routes file may be a convenient place to experiment, but it makes little sense to store them there permanently. Instead, we&#8217;ll use service providers.</p><blockquote><p>Service providers are nothing more than bootstrap classes that can be used to do anything you wish: register a binding, hook into an event, import a routes file, etc.</p></blockquote><p>A service provider&#8217;s <code>register()</code> will be triggered automatically by Laravel.</p><pre class="brush: php; title: ; notranslate">
&lt;?php namespace Way\Storage;

# app/lib/Way/Storage/StorageServiceProvider.php

use Illuminate\Support\ServiceProvider;

class StorageServiceProvider extends ServiceProvider {

    // Triggered automatically by Laravel
    public function register()
    {
        $this-&gt;app-&gt;bind(
            'Way\Storage\Post\PostRepositoryInterface',
            'Way\Storage\Post\EloquentPostRepository'
        );
    }

}
</pre><p>To make this file known to Laravel, you only need to include it in <code>app/config/app.php</code>, within the <code>providers</code> array.</p><pre class="brush: php; title: ; notranslate">
# app/config/app.php

'providers' =&gt; array(
    'Illuminate\Foundation\Providers\ArtisanServiceProvider',
    'Illuminate\Auth\AuthServiceProvider',
    // ...
    'Way\Storage\StorageServiceProvider'
)
</pre><p>Good; now we have a dedicated file for registering new bindings.</p><h3>Updating the Tests</h3><p>With our new structure in place, rather than mocking the Eloquent model, itself, we can instead mock <code>PostRepositoryInterface</code>. Here&#8217;s an example of one such test:</p><pre class="brush: php; title: ; notranslate">
# app/tests/controllers/PostsControllerTest.php

public function testIndex()
{
    $mock = Mockery::mock('Way\Storage\Post\PostRepositoryInterface');
    $mock-&gt;shouldReceive('all')-&gt;once();

    $this-&gt;app-&gt;instance('Way\Storage\Post\PostRepositoryInterface', $mock);

    $this-&gt;call('GET', 'posts');

    $this-&gt;assertViewHas('posts');
}
</pre><p>However, we can improve this. It stands to reason that every method within <code>PostsControllerTest</code> will require a mocked version of the repository. As such, it&#8217;s better to extract some of this prep work into its own method, like so:</p><pre class="brush: php; title: ; notranslate">
# app/tests/controllers/PostsControllerTest.php

public function setUp()
{
    parent::setUp();

    $this-&gt;mock('Way\Storage\Post\PostRepositoryInterface');
}

public function mock($class)
{
    $mock = Mockery::mock($class);

    $this-&gt;app-&gt;instance($class, $mock);

    return $mock;
}

public function testIndex()
{
    $this-&gt;mock-&gt;shouldReceive('all')-&gt;once();

    $this-&gt;call('GET', 'posts');

    $this-&gt;assertViewHas('posts');
}
</pre><p>Not bad, ay?</p><p>Now, if you want to be super-fly, and are willing to add a touch of test logic to your production code, you could even perform your mocking within the Eloquent model! This would allow for:</p><pre class="brush: php; title: ; notranslate">
Post::shouldReceive('all')-&gt;once();
</pre><p>Behind the scenes, this would mock <code>PostRepositoryInterface</code>, and update the IoC binding. You can&#8217;t get much more readable than that!</p><p>Allowing for this syntax only requires you to update the <code>Post</code> model, or, better, a <code>BaseModel</code> that all of the Eloquent models extend. Here&#8217;s an example of the former:</p><pre class="brush: php; title: ; notranslate">
&lt;?php

# app/models/Post.php

class Post extends Eloquent {

    public static function shouldReceive()
    {
        $class = get_called_class();
        $repo = &quot;Way\\Storage\\{$class}\\{$class}RepositoryInterface&quot;;
        $mock = Mockery::mock($repo);

        App::instance($repo, $mock);

        return call_user_func_array([$mock, 'shouldReceive'], func_get_args());
    }

}
</pre><p>If you can manage the inner &quot;<em>Should I be embedding test logic into production code</em>&quot; battle, you&#8217;ll find that this allows for significantly more readable tests.</p><pre class="brush: php; title: ; notranslate">
&lt;?php

# app/tests/controllers/PostsControllerTest.php

class PostsControllerTest extends TestCase {

    public function tearDown()
    {
        Mockery::close();
    }

    public function testIndex()
    {
        Post::shouldReceive('all')-&gt;once();

        $this-&gt;call('GET', 'posts');

        $this-&gt;assertViewHas('posts');
    }

    public function testStoreFails()
    {
        Input::replace($input = ['title' =&gt; '']);

        $this-&gt;call('POST', 'posts');

        $this-&gt;assertRedirectedToRoute('posts.create');
        $this-&gt;assertSessionHasErrors();
    }

    public function testStoreSuccess()
    {
        Input::replace($input = ['title' =&gt; 'Foo Title']);

        Post::shouldReceive('create')-&gt;once();

        $this-&gt;call('POST', 'posts');

        $this-&gt;assertRedirectedToRoute('posts.index', ['flash']);
    }

}
</pre><p>It feels good, doesn&#8217;t it? Hopefully, this article hasn&#8217;t been too overwhelming. The key is to learn how to organize your repositories in such a way to make them as easy as possible to mock and inject into your controllers. As a result of that effort, your tests will be lightning fast!</p><blockquote><p>This article is an excerpt from my upcoming book, <a
href="https://leanpub.com/laravel-testing-decoded">Laravel Testing Decoded</a>. Stay tuned for its release in May, 2013!</p></blockquote><div class="feedflare">
<a href="http://feeds.feedburner.com/~ff/nettuts?a=AtMxwaB4LZA:jGG7ZbI99-0:yIl2AUoC8zA"><img src="http://feeds.feedburner.com/~ff/nettuts?d=yIl2AUoC8zA" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=AtMxwaB4LZA:jGG7ZbI99-0:F7zBnMyn0Lo"><img src="http://feeds.feedburner.com/~ff/nettuts?i=AtMxwaB4LZA:jGG7ZbI99-0:F7zBnMyn0Lo" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=AtMxwaB4LZA:jGG7ZbI99-0:V_sGLiPBpWU"><img src="http://feeds.feedburner.com/~ff/nettuts?i=AtMxwaB4LZA:jGG7ZbI99-0:V_sGLiPBpWU" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=AtMxwaB4LZA:jGG7ZbI99-0:gIN9vFwOqvQ"><img src="http://feeds.feedburner.com/~ff/nettuts?i=AtMxwaB4LZA:jGG7ZbI99-0:gIN9vFwOqvQ" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=AtMxwaB4LZA:jGG7ZbI99-0:TzevzKxY174"><img src="http://feeds.feedburner.com/~ff/nettuts?d=TzevzKxY174" border="0"></img></a>
</div><img src="http://feeds.feedburner.com/~r/nettuts/~4/AtMxwaB4LZA" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:11:"Jeffrey Way";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:71:"http://net.tutsplus.com/tutorials/php/testing-laravel-controllers/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:38:"http://purl.org/rss/1.0/modules/slash/";a:1:{s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:2:"21";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:66:"http://net.tutsplus.com/tutorials/php/testing-laravel-controllers/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:7;a:6:{s:4:"data";s:12:"            ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:5:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:26:"Meet the Connect Framework";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:54:"http://feedproxy.google.com/~r/nettuts/~3/oKU4_qbFK0Q/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:86:"http://net.tutsplus.com/tutorials/javascript-ajax/meet-the-connect-framework/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Mon, 22 Apr 2013 14:53:41 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:4:{i:0;a:5:{s:4:"data";s:17:"JavaScript & AJAX";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:1;a:5:{s:4:"data";s:9:"Tutorials";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:2;a:5:{s:4:"data";s:7:"connect";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:3;a:5:{s:4:"data";s:4:"node";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:32:"http://net.tutsplus.com/?p=31220";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:21872:"<a
href='http://rss.buysellads.com/click.php?z=1260013&k=d754f1e9ba63a736ba8ff5ece958f7dd&a=31220&c=865966103' target='_blank'><img
src='http://rss.buysellads.com/img.php?z=1260013&k=d754f1e9ba63a736ba8ff5ece958f7dd&a=31220&c=865966103' border='0' alt='' /></a><p>Newcomers to NodeJS typically find its API difficult to grasp. Luckily, many developers have created frameworks that make it easier to work with Node. <a
href="http://www.senchalabs.org/connect/">Connect</a> is one such framework. It sits on top of Node&#8217;s API and draws the line between comfort and control.</p><p><span
id="more-31220"></span></p><p>Think of Connect as a stack of middleware. With every request, Connect filters through the layers of middleware, each having the opportunity to process the HTTP request. When T.J. Holowaychuk <a
href="http://tjholowaychuk.com/post/664516126/connect-middleware-for-nodejs">announced Connect</a>, he said there were two types of middleware. The first is a <em>filter</em>.</p><blockquote><p>Filters process the request, but they do not respond to it (think of server logging).</p></blockquote><p>The other type is a <em>provider</em>, which responds to the request. You can incorporate as many layers of middleware as you want; the request passes through each layer until one of the middleware responds to the request.</p><hr
/><h2>Basic Syntax</h2><p>First, you need to install the Connect package through npm:</p><pre class="brush: bash; title: ; notranslate">
npm install connect
</pre><p>Now create a <code>server.js</code> file, and add the following code:</p><pre class="brush: jscript; title: ; notranslate">
var connect = require(&quot;connect&quot;);
</pre><p>The <code>connect</code> variable is a function that returns a new Connect application. So, our next step is to create that app:</p><pre class="brush: jscript; title: ; notranslate">
var app = connect();
</pre><p>You don&#8217;t need to create an <code>app</code> variable for most of your applications. The functions involved in creating an application (<code>connect()</code> and <code>use()</code>) are chainable:</p><pre class="brush: jscript; title: ; notranslate">
connect()
    .use(/* middleware */)
    .use(/* middleware */)
    .listen(3000);
</pre><p>The <code>use()</code> function adds a layer of middleware to the application, and the <code>listen()</code> function tells our application to begin accepting connections on the specified port (3000 in this example).</p><p>Let&#8217;s start with something simple: logging. The code for a Connect application that uses only the logging middleware is rather simple:</p><pre class="brush: jscript; title: ; notranslate">
connect()
    .use(connect.logger())
    .listen(3000);
</pre><blockquote
class="pullquote"><p>By default, Node parses very little of the incoming request.</p></blockquote><p>Add that code to your file, and start the server by running <code>node server.js</code>. Navigate to any path in your browser, and ignore the &#8220;Cannot GET &#8230;&#8221; results. We&#8217;re not interested in what the server sent back to the browser; we&#8217;re interested in the server&#8217;s log. Look at the terminal, and you&#8217;ll see the log of your requests. Be sure to check out the <a
href="http://www.senchalabs.org/connect/logger.html">logger documentation</a> for information on its other features and customization.</p><p>That was a filter; now let&#8217;s look at a provider. The simplest provider is the static provider; it serves static files from a specified folder. Here&#8217;s its syntax:</p><pre class="brush: jscript; title: ; notranslate">
.use(connect.static(__dirname + &quot;/public&quot;)
</pre><p>You can probably guess the purpose of Node&#8217;s <code>__dirname</code> variable: it&#8217;s the path to the current directory. This middleware statically serves anything from a <code>public</code> folder in the current directory. So, create <code>public/page.html</code> and add an <code>&lt;h1&gt;</code> element. Restart the server (<code>node server.js</code>), and navigate to <code>localhost:3000/page.html</code> in your browser. You should <code>page.html</code> rendered in the browser.</p><p>Let&#8217;s now take a quick look at some of Connect&#8217;s other middleware options.</p><hr
/><h2>Parsing Request Bodies</h2><p>By default, Node parses very little of the incoming request, but you can incorporate several different filters to parse the request if you need to handle more complexity. There are four filters:</p><ul><li><code>connect.json()</code> parses JSON request bodies (where the <code>content-type</code> is <code>application/json</code>).</li><li><code>connect.urlencoded()</code> parses <code>x-ww-form-urlencoded</code> request bodies.</li><li><code>connect.multipart()</code> parses <code>multipart/form-data</code> request bodies.</li><li><code>connect.bodyParser()</code> is a shortcut for enabling all of the three above.</li></ul><p>Using any of these filters gives you the ability to access your parsed body via <code>request.body</code> (we&#8217;ll talk about how to get that <code>request</code> object soon).</p><p>I think these filters are a good example of how to fine-grain your control with Connect. You can use very little processing in order to streamline your application.</p><hr
/><h2>Parsing Cookies and Sessions</h2><p>Cookies and sessions are an important part of any web application, and there are several pieces of middleware that help manage them. The <code>connect.cookieParser()</code> parses cookies for you, and you can retrieve the cookies and their values, via the <code>request.cookies</code> object. This is more useful if you add the <code>connect.session()</code> filter to your app. This filter requires the cookie parser to already be in place. Here&#8217;s a small example:</p><pre class="brush: jscript; title: ; notranslate">
connect()
    .use(connect.cookieParser())
    .use(connect.session({ secret: 'some secret text', cookie: { maxAge: 30000 }}))
    .use(function(req, res) {
        var sess = req.session,
            url = req.url.split(&quot;/&quot;);

    if (url[1] == &quot;name&quot; &amp;&amp; url[2]) {
        sess.name = url[2];
        res.end(&quot;name saved: &quot; + url[2]);
    } else if (sess.name) {
        res.write(&quot;session-stored name: &quot; + sess.name);    
        res.end(&quot;stored for another: &quot; + (sess.cookie.maxAge / 1000) + &quot; seconds&quot;);
    } else {
        res.end(&quot;no stored name; go to /name/{name} to save a name&quot;);
    }
}).listen(3000);
</pre><blockquote
class="pullquote"><p>Every middleware function you write needs to either pass the request to the <code>next</code> layer or respond to the request.</p></blockquote><p>After the <code>cookieParser</code>, we include the <code>session</code> filter and pass it a two options:</p><ul><li>The <code>secret</code> creates a signed cookie which keeps track of the session.</li><li>The <code>cookie.maxAge</code> defines its life-span in milliseconds; the 30000 in this code is 30 seconds.</li></ul><p>In the final <code>use()</code> call, we pass a function that responds to the request. We use two properties from the <code>request</code> object: <code>req.session</code> for session data, and <code>req.url</code> for the request URL.</p><p>If  the application receives a request for <code>/name/some_name</code>, then it stores the value <code>some_name</code> in <code>req.session.name</code>. Anything stored within a session can be retrieved in subsequent requests for the length of our session. Any requests made for <code>/name/other</code> replaces the session variable, and any requests to other URLs output the session variable&#8217;s value and the time left for the session.</p><p>So, you can navigate to <code>localhost:3000/name/your_name</code>, and then go to <code>localhost:3000</code> to see <code>your_name</code>. Refresh the page a few times and watch the seconds count down. When the session expires, you&#8217;ll see the default &#8220;no stored name&#8221; message.</p><p>I mentioned that the <code>cookieParser</code> filter must come before <code>session</code>.</p><blockquote><p>The order of inclusion is important with middleware because the request is passed, in order, from layer to layer.</p></blockquote><p>Because <code>session</code> needs the parsed cookie data, the request must go through <code>cookieParser</code> before <code>session</code>.</p><p>I could explain every other built-in piece of middleware, but I&#8217;ll just mention a few more before we write our own code to interface with Connect.</p><ul><li><a
href="http://www.senchalabs.org/connect/compress.html">compress</a>: Gzip compression middleware</li><li><a
href="http://www.senchalabs.org/connect/basicAuth.html">basicAuth</a>: basic http authentication</li><li><a
href="http://www.senchalabs.org/connect/directory.html">directory</a>: directory listing middleware</li><li><a
href="http://www.senchalabs.org/connect/errorHandler.html">errorHandler</a>: flexible error handler</li></ul><hr
/><h2>Writing Your Own Middleware</h2><p>You just learned how to write your own code with Connect. Here&#8217;s the basic syntax once again:</p><pre class="brush: jscript; title: ; notranslate">
.use(function (req, res, next) {

})
</pre><p>The function&#8217;s three parameters are important; they provide access to the outside world. The <code>req</code> parameter is, of course, the request object, and <code>res</code> is the response. The third parameter, <code>next</code>, is the key to making functions that work well in the middleware stack. It&#8217;s a function that passes the request to the next middleware in the stack. See this example:</p><pre class="brush: jscript; title: ; notranslate">
connect()
    .use(function (req, res, next) {
        if (req.method === 'POST') {
            res.end(&quot;This is a POST request&quot;);
        } else {
            next();
        }
    })
    .use(function (req, res) {
        res.end(&quot;This is not a POST request (probably a GET request)&quot;);
    }).listen(3000);
</pre><p>This code uses two middleware functions. The first function checks the request method to see if it&#8217;s a POST request. If it is, it responds by saying so. Otherwise, we call <code>next()</code> and pass the request to the next function, which responds no matter what. Use <code>curl</code> to test both layers in the terminal:</p><pre class="brush: bash; title: ; notranslate">
$ curl http://localhost:3000
This is not a POST request (probably a GET request)

$ curl -X POST http://localhost:3000
This is a POST request
</pre><p>If you don&#8217;t like the terminal, try <a
href="https://chrome.google.com/webstore/detail/advanced-rest-client/hgmloofddffdnphfgcellkdfbfbjeloo">this useful Chrome plugin</a>.</p><p>It&#8217;s important to remember that every middleware function you write needs to either pass the request to the <code>next</code> layer or respond to the request. If your function branches (via if statements or other conditionals), you must ensure that every branch passes the request or responds to it. If your app hangs in the browser, it&#8217;s probably because you forgot to call <code>next()</code> at some point.</p><p>Now, what about those <code>request</code> and <code>response</code> parameters? These are the very same request and response objects you receive when using a &#8220;raw&#8221; Node server:</p><pre class="brush: jscript; title: ; notranslate">
require(&quot;http&quot;).createServer(function (req, res) {
    // ...
}).listen(3000);
</pre><p>If you haven&#8217;t used Node&#8217;s server API before, let me show you what you can do with it.</p><hr
/><h2>The Request Object</h2><p>The <code>request</code> object is actually an <code>http.IncomingMessage</code> object, and its important properties are listed below::</p><ul><li><code>req.method</code> tells you which HTTP method was used.</li><li><code>req.url</code> tells you which URL was requested.</li><li><code>req.headers</code> is an object with the header names and values.</li><li><code>req.query</code> is an object with any data in a query string (to parse that, you&#8217;ll need the <code>connect.query()</code> middleware in place).</li><li><code>req.body</code> is an object of the form data (you&#8217;ll need some body parsing middleware in place).</li><li><code>req.cookies</code> is an object of the cookie data (requires cookie parsing).</li><li><code>req.session</code> is an object of the session data (again, you&#8217;ll need cookie parsing and session middleware in place)</li></ul><p>You can see all of this at work with the following code:</p><pre class="brush: jscript; title: ; notranslate">
connect()
    .use(connect.query()) // gives us req.query
    .use(connect.bodyParser())  // gives us req.body
    .use(connect.cookieParser()) // for session
    .use(connect.session({ secret: &quot;asdf&quot; }))     // gives us req.session
    .use(function (req, res) {
        res.write(&quot;req.url: &quot; + req.url + &quot;\n\n&quot;);
        res.write(&quot;req.method: &quot; + req.method + &quot;\n\n&quot;);
        res.write(&quot;req.headers: &quot; + JSON.stringify(req.headers) + &quot;\n\n&quot;);
        res.write(&quot;req.query: &quot; + JSON.stringify(req.query) + &quot;\n\n&quot;);
        res.write(&quot;req.body: &quot; + JSON.stringify(req.body) + &quot;\n\n&quot;);
        res.write(&quot;req.cookies: &quot; + JSON.stringify(req.cookies) + &quot;\n\n&quot;);
        res.write(&quot;req.session: &quot; + JSON.stringify(req.session));
        res.end();
    }).listen(3000);
</pre><p>To see something for each one of these values, you need to post some data to a URL with a query string. The following should be enough:</p><pre class="brush: bash; title: ; notranslate">
curl -X POST -d &quot;name=YourName&quot; &quot;http://localhost:3000/some/url?some=data&quot;
</pre><p>With those seven properties, you can manage just about any request you&#8217;ll receive. I don&#8217;t think trailers are used often (I&#8217;ve never seen them in my experience), but you can use <code>req.trailers</code> if you expect them in your requests (trailers are just like headers, but after the body).</p><p>So, what about your response?</p><hr
/><h2>The Response Object</h2><p>The raw response object doesn&#8217;t provide the luxuries that libraries (like Express) gives you. For example, you can&#8217;t respond with a simple render call to a premade template&mdash;at least, not by default. Very little is assumed in the response, so you need to fill in all the little details.</p><p>We&#8217;ll start with the status code and the response headers. You can set these all at once using the <code>writeHead()</code> method. Here&#8217;s an example from the Node docs:</p><pre class="brush: jscript; title: ; notranslate">
var body = 'hello world';
response.writeHead(200, {
    'Content-Length': body.length,
    'Content-Type': 'text/plain' 
});
</pre><p>If you need to individually set headers, you can use the <code>setHeader()</code> method:</p><pre class="brush: jscript; title: ; notranslate">
connect()
    .use(function (req, res) {
        var accept = req.headers.accept.split(&quot;,&quot;),
            body, type;
            console.log(accept);
        if (accept.indexOf(&quot;application/json&quot;) &amp;gt; -1) {
            type = &quot;application/json&quot;;
            body = JSON.stringify({ message: &quot;hello&quot; });
        } else if (accept.indexOf(&quot;text/html&quot;) &amp;gt; -1) {
            type = &quot;text/html&quot;;
            body = &quot;&lt;h1&gt; Hello! &lt;/h1&gt;&quot;;
        } else {
            type = &quot;text/plain&quot;;
            body = &quot;hello!&quot;;
        }
        res.statusCode = 200;
        res.setHeader(&quot;Content-Type&quot;, type);
        res.end(body);
    }).listen(3000);
</pre><p>Add this code to a file, start up the server and request it from the browser. You got HTML! Now run:</p><pre class="brush: bash; title: ; notranslate">
curl http://localhost:3000
</pre><p>And you&#8217;ll receive plain text. For JSON, try this:</p><pre class="brush: bash; title: ; notranslate">
curl -H &quot;accept:application/json&quot; http://localhost:3000
</pre><p>All from the same URL!</p><p>Use <code>res.getHeader(name)</code> if you need to know what headers have already been set. Tou can also use <code>res.removeHeader(name)</code> to remove a header.</p><p>Of course, a response is useless without a body. As you&#8217;ve seen throughout this tutorial, you can write chunks of data to the body with the <code>res.write()</code> method. This accepts a string or <a
href="http://nodejs.org/api/buffer.html">buffer</a> object as an argument. If it&#8217;s a string, the second parameter is the encoding type (it defaults to <code>utf8</code>).</p><p>The <code>res.end()</code> method closes the body, but you can pass data to it to write to the response stream. This is useful in situations where you only need to output a single line.</p><hr
/><h2>Third-Party Middleware</h2><p>It&#8217;s somewhat difficult to respond with larger HTML bodies in plain old Node and Connect. This is a good place to throw third-party middleware into the mix. You can find a list of third-party middleware <a
href="https://github.com/senchalabs/connect/wiki">on the Connect Github wiki</a>. As an example, we&#8217;re going to use the <a
href="https://github.com/Yitsushi/connect-jade">connect-jade package</a>, which allows us to render jade views.</p><p>First, install <code>connect-jade</code>:</p><pre class="brush: bash; title: ; notranslate">
npm install connect-jade
</pre><p>Next, require and add it as middleware. You&#8217;ll want to set a few default values:</p><pre class="brush: jscript; title: ; notranslate">
var connect = require(&quot;connect&quot;),
    connectJade = require(&quot;connect-jade&quot;);

connect()
    .use(connectJade({
        root: __dirname + &quot;/views&quot;,
        defaults: {
            title: &quot;MyApp&quot;
        }
    }))
    .use(function (req, res) {
        res.render(&quot;index&quot;, { heading: &quot;Welcome to My App&quot; });
    }).listen(3000);
</pre><p>Set the root as the directory that contains the view files. You can also set <code>defaults</code>; these are variables that are available inside every view, unless we override them later when calling <code>render()</code>.</p><p>The final function in this code makes a call to <code>res.render()</code>. This method is provided by the <code>connect-jade</code> package.</p><blockquote><p>The first argument it accepts is the name of the view to render.</p></blockquote><p>It&#8217;s the path to the view, <em>sans</em> the path that we defined when adding the middleware, <em>sans</em> the jade file extension. For this code, we need a <code>views/index.jade</code> template to render. We&#8217;ll keep it simple:</p><pre class="brush: xml; title: ; notranslate">
html
  head
    title= title
  body
    h1= heading
</pre><p>If you&#8217;re not familiar with <a
href="http://jade-lang.com/">jade</a>, we indent tag names to create an HTML structure. The equal sign retrieves the value of a JavaScript variable. Those variables come from the <code>defaults</code> we set up, plus the (optional) second parameter object passed to <code>res.render()</code>.</p><p>There are many other <a
href="https://github.com/senchalabs/connect/wiki">third-party middlewares</a>, but they work similar to each other. You install them via npm, require them and put them into action.</p><hr
/><h2>Modules as Middleware</h2><p>If you dig into how Connect works, you&#8217;ll find that each layer is actually a Node module&mdash;a very intelligent design. If you use Connect for sizeable applications, it would be ideal to write your code in Node module format. You might have an <code>app.js</code> file like this:</p><pre class="brush: jscript; title: ; notranslate">
// app.js
module.exports = function (req, res, next) {
    res.end(&quot;this comes from a module&quot;);
};
</pre><p>And in your <code>server.js</code>:</p><pre class="brush: jscript; title: ; notranslate">
var connect = require(&quot;connect&quot;),
    app = require(&quot;./app&quot;);

connect()
    .use(app)
    .listen(3000);
</pre><hr
/><h2>Conclusion</h2><p>If you want a beginner-friendly library that makes it easy to build large web apps, then Connect isn&#8217;t your solution. Connect is meant to be a thin layer on top of the raw Node API that gives you complete control over your server application. If you want a bit more, I recommend <a
href="http://expressjs.com/">Express</a> (by the same folks, incidentally). Otherwise, Connect is a fantastic, extensible library for Node web applications.</p><div class="feedflare">
<a href="http://feeds.feedburner.com/~ff/nettuts?a=oKU4_qbFK0Q:jWZ4rhZp3lY:yIl2AUoC8zA"><img src="http://feeds.feedburner.com/~ff/nettuts?d=yIl2AUoC8zA" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=oKU4_qbFK0Q:jWZ4rhZp3lY:F7zBnMyn0Lo"><img src="http://feeds.feedburner.com/~ff/nettuts?i=oKU4_qbFK0Q:jWZ4rhZp3lY:F7zBnMyn0Lo" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=oKU4_qbFK0Q:jWZ4rhZp3lY:V_sGLiPBpWU"><img src="http://feeds.feedburner.com/~ff/nettuts?i=oKU4_qbFK0Q:jWZ4rhZp3lY:V_sGLiPBpWU" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=oKU4_qbFK0Q:jWZ4rhZp3lY:gIN9vFwOqvQ"><img src="http://feeds.feedburner.com/~ff/nettuts?i=oKU4_qbFK0Q:jWZ4rhZp3lY:gIN9vFwOqvQ" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=oKU4_qbFK0Q:jWZ4rhZp3lY:TzevzKxY174"><img src="http://feeds.feedburner.com/~ff/nettuts?d=TzevzKxY174" border="0"></img></a>
</div><img src="http://feeds.feedburner.com/~r/nettuts/~4/oKU4_qbFK0Q" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:14:"Andrew Burgess";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:82:"http://net.tutsplus.com/tutorials/javascript-ajax/meet-the-connect-framework/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:38:"http://purl.org/rss/1.0/modules/slash/";a:1:{s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:2:"15";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:77:"http://net.tutsplus.com/tutorials/javascript-ajax/meet-the-connect-framework/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:8;a:6:{s:4:"data";s:11:"           ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:5:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:35:"Writing a Shell Script From Scratch";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:54:"http://feedproxy.google.com/~r/nettuts/~3/kd9cz6hLDAU/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:94:"http://net.tutsplus.com/tutorials/tools-and-tips/writing-a-shell-script-from-scratch/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Fri, 19 Apr 2013 21:27:17 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:3:{i:0;a:5:{s:4:"data";s:12:"Tools & Tips";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:1;a:5:{s:4:"data";s:7:"console";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:2;a:5:{s:4:"data";s:8:"terminal";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:32:"http://net.tutsplus.com/?p=31426";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:22743:"<a
href='http://rss.buysellads.com/click.php?z=1260013&k=d754f1e9ba63a736ba8ff5ece958f7dd&a=31426&c=365706990' target='_blank'><img
src='http://rss.buysellads.com/img.php?z=1260013&k=d754f1e9ba63a736ba8ff5ece958f7dd&a=31426&c=365706990' border='0' alt='' /></a><p>Writing shell scripts can be rather daunting, primarily because the shell isn&#39;t the most friendly of languages to use. However, I hope to show you in this tutorial that shell scripting is actually not as tough or as scary as you might expect.</p><p><span
id="more-31426"></span></p><p>For this tutorial, we&#39;ll write a script that makes the process of using the <a
href="http://pivotal.github.com/jasmine/">Jasmine test framework</a> a little bit easier. Actually, I wouldn&#39;t use this script today; I would use <a
href="http://gruntjs.com/">Grunt.js</a> or something similar. However, I wrote this script before Grunt was around, and I found that writing it proved to be an excellent way to get more comfortable with shell scripting, so that&#39;s why we&#39;re using it.</p><blockquote><p>One note: this tutorial is loosely associated with my upcoming <a
href="http://tutsplus.com">Tuts+ Premium</a> course,  &quot;Advanced Command Line Techniques.&quot; To learn more about pretty much anything in this tutorial, stay tuned for that course&#8217;s release. Hereafter in this tutorial, it will be referred to as &quot;the course.&quot;</p></blockquote><p>So, our script, which I call <code>jazz</code>, will have four main features:</p><ul><li>It will download Jasmine from the web, unzip it, and delete the sample code.</li><li>It will create JavaScript files and their associated spec files, and pre-fill them with a bit of template code.</li><li>It will open the tests in the browser.</li><li>It will display the help text, which outlines the above.</li></ul><p>Let&#39;s begin with the script file.</p><hr
/><h2><span>Step 1 -</span> Creating the File</h2><p>Writing a shell script is only useful if you can use it from the terminal; to be able to use your custom scripts on the terminal, you need to put them in a folder that is in your terminal&#39;s <code>PATH</code> variable (you can see your <code>PATH</code> variable by running <code>echo $PATH</code>). I&#39;ve created a <code>~/bin</code> folder (where <code>~</code> is the home directory) on my computer, and that&#39;s where I like to keep custom scripts (if you do the same, you&#39;ll have to add it to your path). So, just create a file, called <code>jazz</code>, and put it in your folder.</p><p>Of course, we&#39;ll also have to make that file executable; otherwise, we won&#39;t be able to run it. We can do this by running the following command:</p><p><pre class="brush: bash; title: ; notranslate">
    chmod +x jazz
</pre></p><p>Now that we can actually execute the script, let&#39;s add a very important part. All shell scripts should begin with a <a
href="https://en.wikipedia.org/wiki/Shebang_(Unix">shebang</a>). As Wikipedia says, this should be the first line of the script; it states what interpreter, or shell, this script should be run with. We&#39;re just going to use a basic, standard shell:</p><p><pre class="brush: bash; title: ; notranslate">
    #!/bin/sh
</pre></p><p>All right, with all that set up, we&#39;re ready to start writing the actual code.</p><hr
/><h2><span> Step 2 &#8211; </span> Outlining the Script Flow</h2><p>Earlier, I pointed out what the different features of our shell script should be. But how will the script know which feature to run? We&#39;ll use a combination of a shell parameter and a case statement. When running the script from the command line, we&#39;ll use a sub-command, like this:</p><p><pre class="brush: bash; title: ; notranslate">
    jazz init
    jazz create SomeFile
    jazz run
    jazz help
</pre></p><p>This should look familiar, especially if you&#39;ve used Git:</p><p><pre class="brush: bash; title: ; notranslate">
    git init
    git status
    git commit
</pre></p><p>Based on that first parameter (<code>init</code>, <code>create</code>, <code>run</code>, <code>help</code>), our case statement will decide what to run. However, we do need a default case: what happens if no first parameter is given, or we get an unrecognized first parameter? In those cases, we&#39;ll show the help text. So, let&#39;s get started!</p><hr
/><h2><span> Step 3 &#8211; </span> Writing the Help Text</h2><p>We begin with the <code>if</code> statement that checks for our first parameter:</p><p><pre class="brush: bash; title: ; notranslate">
    if [ $1 ]
    then
        # do stuff 
    else
        # show help
    fi
</pre></p><p>You might be a little confused at first, because a shell <code>if</code> statement is pretty different from a &quot;regular&quot; programming language&#39;s <code>if</code> statement. To get a better understanding of it, watch the screencast on conditional statements in the course. This code checks for the presence of a first parameter (<code>$1</code>); if it&#39;s there, we&#39;ll execute the <code>then</code> code; <code>else</code>, we&#39;ll show the help text.</p><p>It&#39;s a good idea to wrap the printing of the help text in a function, because we need to call it more than once. We do need to define the function before it is called, so we&#39;ll put it at the top. I like this, because now, as soon as I open the file, I see the documentation for the script, which can be a helpful reminder when returning to code you haven&#39;t seen in a while. Without further ado, here&#39;s the <code>help</code> function:</p><p><pre class="brush: bash; title: ; notranslate">
    function help () {
        echo &quot;jazz - A simple script that makes using the Jasmine testing framework in a standalone project a little simpler.&quot;
        echo &quot;
        echo &quot;    jazz init                  - include jasmine in the project&quot;;
        echo &quot;    jazz create FunctionName   - creates ./src/FunctionName.js ./spec/FunctionNameSpec.js&quot;;
        echo &quot;    jazz run                   - runs tests in browser&quot;;
    }
</pre></p><p>Now, just replace that <code># show help</code> function with a call to the <code>help</code> function.</p><p><pre class="brush: bash; title: ; notranslate">
    else
        help
    fi
</pre></p><hr
/><h2><span> Step 4 &#8211; </span> Writing the Case Statement</h2><p>If there is a first parameter, we need to figure out which it is. For this, we use a <code>case</code> statement:</p><pre class="brush: bash; title: ; notranslate">
	case &quot;$1&quot; in
		init)
		
		;;
		create)
		
		;;
		run)
		
		;;
		*)
			help
		;;
	esac
</pre><p>We pass the first parameter to the <code>case</code> statement; then, it should match one of four things: &quot;init&quot;, &quot;create&quot;, &quot;run&quot;, or our wildcard, default case. Notice that we don&#39;t have an explicit &quot;help&quot; case: that&#39;s just our default case. This works, because anything other than &quot;init&quot;, &quot;create&quot;, and &quot;run&quot; aren&#39;t commands we recognize, so it should get the help text.</p><p>Now we&#39;re ready to write the functional code, and we&#39;ll start with <code>jazz init</code>.</p><hr
/><h2><span> Step 5 &#8211; </span> Preparing Jasmine with <code>jazz init</code></h2><p>All the code we write here will go within our <code>init)</code> case, from the case statement above. The first step is to actually download the standalone version of Jasmine, which comes in a zip file:</p><p><pre class="brush: bash; title: ; notranslate">
    echo &quot;Downloading Jasmine ...&quot;
    curl -sO $JASMINE_LINK
</pre></p><p>We first echo a little message, and then we use <code>curl</code> to download the zip. The <code>s</code> flag makes it silent (no output) and the <code>O</code> flag saves the contents of the zip to a file (otherwise, it would pipe it to standard out). But what&#39;s with that <code>$JASMINE_LINK</code> variable? Well, you could put the actual link to the zip file there, but I prefer to put it in a variable for two reasons: first, it keeps us from repeating part of the path, as you&#39;ll see in a minute. Second, with that variable near the top of the file, it makes it easy to change the version of Jasmine we&#39;re using: just change that one variable. Here&#39;s that variable declaration (I put it outside the <code>if</code> statement, near the top):</p><p><pre class="brush: bash; title: ; notranslate">
    JASMIME_LINK=&quot;http://cloud.github.com/downloads/pivotal/jasmine/jasmine-standalone-1.3.1.zip&quot;
</pre></p><p>Remember, no spaces around the equals-sign in that line.</p><p>Now that we have our zip file, we can unzip it and prepare the contents:</p><p><pre class="brush: bash; title: ; notranslate">
    unzip -q &lt;code&gt;basename $JASMINE_LINK&lt;/code&gt;
    rm -rf &lt;code&gt;basename $JASMINE_LINK&lt;/code&gt; src/*.js spec/*.js
</pre></p><p>In two of these lines, we&#39;re using <code>basename $JASMINE_LINK</code>; the <code>basename</code> command just reduces a path to the base name: so <code>path/to/file.zip</code> becomes just <code>file.zip</code>. This allows us to use that <code>$JASMINE_LINK</code> variable to reference our local zip file.</p><p>After we unzip, we&#39;ll delete that zip file, as well as all the JavaScript files in the <code>src</code> and <code>spec</code> directories. These are the sample files that Jasmine comes with, and we don&#39;t need them.</p><p>Next, we have a Mac-only issue to deal with. By default, when you download something from the internet on a Mac, when you try to run it for the first time, you&#39;ll be asked to confirm that you want to run it. This is because of the extended attribute <code>com.apple.quarantine</code> that Apple puts on the file. We need to remove this attribute.</p><pre class="brush: bash; title: ; notranslate">
    if which xattr &gt; /dev/null &amp;&amp; [ &quot;&lt;code&gt;xattr SpecRunner.html&lt;/code&gt;&quot; = &quot;com.apple.quarantine&quot; ]
    then
        xattr -d com.apple.quarantine SpecRunner.html
    fi
</pre><p>We begin by checking for the presence of the <code>xattr</code> command, because it doesn&#39;t exist on some Unix systems (I&#39;m not sure, but it may be a Mac-only program). If you watched the course screencast on conditionals, you&#39;ll know that we can pass any command to <code>if</code>; if it has an exit status of anything but <code>0</code>, it&#39;s false. If <code>which</code> finds the <code>xattr</code> command, it will exit with <code>0</code>; otherwise, it will exit with <code>1</code>. In either case, <code>which</code> will display some output; we can keep that from showing by redirecting it to <code>/dev/null</code> (this is a <a
href="https://en.wikipedia.org/wiki//dev/null">special file</a> that discards all data written to it).</p><p>That double ampersand is an boolean AND; it&#39;s there for the second condition we want to check. That is, does the <code>SpecRunner.html</code> have that attribute? We can simply run the <code>xattr</code> command on the file, and compare it&#39;s output to the string we&#39;re expecting. (We can&#39;t just expect the file to have the attribute, because you can actually turn this feature off in Mac OS X, and we&#39;ll get an error when trying to remove it if the file doesn&#39;t have the attribute).</p><p>So, if <code>xattr</code> is found and the file has the attribute, we&#39;ll remove it, with the <code>d</code> (for delete) flag. Pretty straightforward, right?</p><p>The final step is to edit <code>SpecRunner.html</code>. Currently, it contains scripts tags for the sample JavaScript files that we deleted; we should also delete those scripts tags. I happen to know that those script tags span lines 12 to 18 in the files. So, we can use the stream editor <code>sed</code> to delete those lines:</p><p><pre class="brush: bash; title: ; notranslate">
    sed -i &quot;&quot; '12,18d' SpecRunner.html
    echo &quot;Jasmine initialized!&quot;
</pre></p><p>The <code>i</code> flag tells <code>sed</code> to edit the file in place, or to save the output from the command to the same file we passed in; the empty string after the flag means that we don&#39;t want <code>sed</code> to back up the file for us; if you wanted that, you could just put a file extension in that string (like <code>.bak</code>, to get <code>SpecRunner.html.bak</code>).</p><p>Finally, we&#39;ll let the user know that Jasmine has been initialized. And that&#39;s it for our <code>jazz init</code> command.</p><hr
/><h2><span> Step 6 &#8211; </span> Creating Files with <code>jazz create</code></h2><p>Next up, we&#39;re going to let our users create JavaScript files and their associated spec files. This portion of the code will go in the &#8220;create&quot; section of the <code>case</code> statement we wrote earlier.</p><p><pre class="brush: bash; title: ; notranslate">
    if [ $2 ]
    then
        # create files
    else
        echo &quot;please include a name for the file&quot;
    fi
</pre></p><p>When using <code>jazz create</code>, we need to include a name for the file as the second parameter: <code>jazz create View</code>, for example. We&#39;ll use this to create <code>src/View.js</code> and <code>spec/ViewSpec.js</code>. So, if there isn&#39;t a second parameter, we&#39;ll remind the user to add one.</p><p>If there is a file name, we&#39;ll start by creating those two files (inside the <code>then</code> part above):</p><p><pre class="brush: bash; title: ; notranslate">
    echo &quot;function $2 () {\n\n}&quot; &gt; src/$2.js
    echo &quot;describe('$2', function () {\n\n});&quot; &gt; spec/$2Spec.js
</pre></p><p>Of course, you can put whatever you want into your <code>src</code> file. I&#39;m doing something basic here; so <code>jazz create View</code> will create <code>src/View.js</code> with this:</p><pre class="brush: jscript; title: ; notranslate">
function View () {

}
</pre><p>You could replace that first <code>echo</code> line with this:</p><p><pre class="brush: bash; title: ; notranslate">
    echo &quot;var $2 = (function () {\n\tvar $2Prototype = {\n\n\t};\n\n\treturn {\n\t\tcreate : function (attrs) {\n\t\t\tvar o = Object.create($2Prototype);\n\t\t\textend(o, attrs);\n\t\t\treturn o;\n\t\t}\n \t};\n}());&quot; &gt; src/$2.js
</pre></p><p>And then <code>jazz create View</code> will result in this:</p><pre class="brush: jscript; title: ; notranslate">
    var View = (function () {
        var ViewPrototype = {
        
        };
    
        return {
            create : function (attrs) {
                var o = Object.create(ViewPrototype);
                extend(o, attrs);
                return o;
            }
        };
    }());
</pre><p>So, really, your imagination is the limit. Of course, you&#39;ll want the spec file to be the standard Jasmine spec code, which is what I have above; but you can tweak that however you like as well.</p><p>The next step is to add the script tags for these files to <code>SpecRunner.html</code>. At first, this might seem tricky: how can we add lines to the middle of a file programmatically? Once again, it&#39;s <code>sed</code> that does the job.</p><p><pre class="brush: bash; title: ; notranslate">
    sed -i &quot;&quot; &quot;11a\\
    &lt;script src='src/$2.js'&gt;&lt;/script&gt;\\
    &lt;script src='spec/$2Spec.js'&gt;&lt;/script&gt;
    &quot; SpecRunner.html
</pre></p><p>We start just like we did before: in-place edit without a backup. Then our command: at line 11, we want to append the two following lines. It&#39;s important to escape the two new-lines, so that they&#39;ll appear in the text. As you can see, this just inserts those two scripts tags, exactly what we need for this step.</p><p>We can end with some output:</p><p><pre class="brush: bash; title: ; notranslate">
    echo &quot;Created:&quot;
    echo &quot;\t- src/$2.js&quot;
    echo &quot;\t- spec/$2Spec.js&quot;
    echo &quot;Edited:&quot;
    echo &quot;\t- SpecRunner.html&quot;
</pre></p><p>And that&#39;s <code>jazz create</code>!</p><hr
/><h2><span> Step 7 &#8211; </span> Running the Specs with <code>jazz run</code></h2><p>The last step is to actually run the tests. This means opening the <code>SpecRunner.html</code> file in a browser. There&#39;s a bit of a caveat here. On Mac OS X, we can use the <code>open</code> command to open a file in it&#39;s default program; this won&#39;t work on any other OS, but that&#39;s the way I do it here. Unfortunately, there&#39;s no real cross-platform way to do this, that I know of. If you&#39;re using this script under Cygwin on Windows, you can use <code>cygstart</code> in place of <code>open</code>; otherwise, try googling &quot;[your OS] shell script open browser&quot; and see what you come up with. Unfortunately, some versions of Linux (at least Ubuntu, in my experience) have an <code>open</code> command that&#39;s for something completely different. All this to say, your mileage with the following may vary.</p><pre class="brush: bash; title: ; notranslate">if [ &quot;`which open`&quot; = '/usr/bin/open' ] 
then
    open SpecRunner.html
else
    echo &quot;Please open SpecRunner.html in your browser&quot;
fi
</pre><p>By now, you know exactly what this does: if we have <code>open</code>, we&#39;ll open <code>SpecRunner.html</code>, otherwise, we&#39;ll just print a message telling the user to open the file in the browser.</p><p>Originally, that <code>if</code> condition looked like this:</p><pre class="brush: plain; title: ; notranslate">if which open &gt; /dev/null
</pre><p>As we did with <code>xattr</code>, it just checked for existence of <code>open</code>; however, since I found out that there&#39;s a different <code>open</code> command on Linux (even on my Ubuntu server, which can&#39;t even open a browser!), I figured it might be better to compare the path of the <code>open</code> program, since the Linux one is at <code>/bin/open</code> (again, at least on Ubuntu server).</p><p>All this extra wordiness about <code>open</code> might sound like an excuse for my lack of a good solution, it actually points out something important about the command line. Don&#39;t mistake understanding the terminal with understanding a computer&#39;s configuration. This tutorial, and the associated course, have taught you a little bit more about the Bash shell (and the Z shell), but that doesn&#39;t mean each computer you use will be configured the same; there are many ways to install new commands (or different versions of commands), as well as remove commands. <em>Caveat developer</em>.</p><p>Well, that&#39;s the entire script! Here it is again, all together:</p><pre class="brush: bash; title: ; notranslate">
    #! /bin/sh

    function help () {
        echo &quot;jazz - A simple script that makes using the Jasmine testing framework in a standalone project a little simpler.&quot;
        echo &quot;&quot;
        echo &quot;    jazz init                  - include jasmine in the project&quot;;
        echo &quot;    jazz create FunctionName   - creates ./src/FunctionName.js ./spec/FunctionNameSpec.js&quot;;
        echo &quot;    jazz run                   - runs tests in browser&quot;;
    }

    JASMIME_LINK=&quot;http://cloud.github.com/downloads/pivotal/jasmine/jasmine-standalone-1.3.1.zip&quot;

    if [ $1 ] 
    then
      case &quot;$1&quot; in
      init)
        echo &quot;Downloading Jasmine . . .&quot;
        curl -sO $JASMIME_LINK 
        unzip -q `basename $JASMIME_LINK` 
        rm `basename $JASMIME_LINK` src/*.js spec/*.js
        
        if which xattr &gt; /dev/null &amp;&amp; [ &quot;`xattr SpecRunner.html`&quot; = &quot;com.apple.quarantine&quot; ]
        then
          xattr -d com.apple.quarantine SpecRunner.html
        fi

        sed -i &quot;&quot; &quot;12,18d&quot; SpecRunner.html
        echo &quot;Jasmine initialized!&quot;
      ;;
      create)
        if [ $2 ]
        then 
          echo &quot;function $2 () {\n\n}&quot; &gt; ./src/$2.js
          echo &quot;describe('$2', function () {\nit('runs');\n});&quot; &gt; ./spec/$2Spec.js
          sed -i &quot;&quot; &quot;11a\\
          &lt;script src='src/$2.js'&gt;&lt;/script&gt;\\
          &lt;script src='spec/$2Spec.js'&gt;&lt;/script&gt;
          &quot; SpecRunner.html
          echo &quot;Created:&quot;
          echo &quot;\t- src/$2.js&quot;
          echo &quot;\t- spec/$2Spec.js&quot;
          echo &quot;Edited:&quot;
          echo &quot;\t- SpecRunner.html&quot;
        else
          echo 'please add a name for the file'
        fi
      ;;
      &quot;run&quot;)
        if [ &quot;`which open`&quot; = '/usr/bin/open' ] 
        then
          open ./SpecRunner.html
        else
          echo &quot;Please open SpecRunner.html in your browser&quot;
        fi
      ;;
      *)
        help;
      ;;
      esac
    else
      help;
    fi
</pre><p>Well, go on, give it a try!</p><p><pre class="brush: bash; title: ; notranslate">
    mkdir project
    cd project
    jazz init
    jazz create Dog
    # edit src/Dog.js and spec/DogSpec.js
    jazz run
</pre></p><p>By the way, if you want to have some more fun with this project, you can <a
href="https://github.com/andrew8088/jazz">find it on Github</a>.</p><hr
/><h2>Conclusion</h2><p>So there you have it! We&#39;ve just written an intermediate level shell script; that wasn&#39;t so bad, now, was it? Don&#8217;t forget to stay tuned for my upcoming <a
href="http://tutsplus.com">Tuts+ Premium</a> course; you&#39;ll learn a lot more about many of the techniques used in this article, as well as countless others. Have fun on the terminal!</p><div class="feedflare">
<a href="http://feeds.feedburner.com/~ff/nettuts?a=kd9cz6hLDAU:jC7bqt1ahxQ:yIl2AUoC8zA"><img src="http://feeds.feedburner.com/~ff/nettuts?d=yIl2AUoC8zA" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=kd9cz6hLDAU:jC7bqt1ahxQ:F7zBnMyn0Lo"><img src="http://feeds.feedburner.com/~ff/nettuts?i=kd9cz6hLDAU:jC7bqt1ahxQ:F7zBnMyn0Lo" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=kd9cz6hLDAU:jC7bqt1ahxQ:V_sGLiPBpWU"><img src="http://feeds.feedburner.com/~ff/nettuts?i=kd9cz6hLDAU:jC7bqt1ahxQ:V_sGLiPBpWU" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=kd9cz6hLDAU:jC7bqt1ahxQ:gIN9vFwOqvQ"><img src="http://feeds.feedburner.com/~ff/nettuts?i=kd9cz6hLDAU:jC7bqt1ahxQ:gIN9vFwOqvQ" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=kd9cz6hLDAU:jC7bqt1ahxQ:TzevzKxY174"><img src="http://feeds.feedburner.com/~ff/nettuts?d=TzevzKxY174" border="0"></img></a>
</div><img src="http://feeds.feedburner.com/~r/nettuts/~4/kd9cz6hLDAU" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:14:"Andrew Burgess";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:90:"http://net.tutsplus.com/tutorials/tools-and-tips/writing-a-shell-script-from-scratch/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:38:"http://purl.org/rss/1.0/modules/slash/";a:1:{s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:2:"12";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:85:"http://net.tutsplus.com/tutorials/tools-and-tips/writing-a-shell-script-from-scratch/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}i:9;a:6:{s:4:"data";s:11:"           ";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";s:5:"child";a:5:{s:0:"";a:7:{s:5:"title";a:1:{i:0;a:5:{s:4:"data";s:17:"Reflection in PHP";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"link";a:1:{i:0;a:5:{s:4:"data";s:54:"http://feedproxy.google.com/~r/nettuts/~3/eUw_aN38rD8/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:65:"http://net.tutsplus.com/tutorials/php/reflection-in-php/#comments";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:7:"pubDate";a:1:{i:0;a:5:{s:4:"data";s:31:"Thu, 18 Apr 2013 17:46:16 +0000";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:8:"category";a:3:{i:0;a:5:{s:4:"data";s:3:"PHP";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:1;a:5:{s:4:"data";s:9:"Tutorials";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:2;a:5:{s:4:"data";s:10:"reflection";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:4:"guid";a:1:{i:0;a:5:{s:4:"data";s:32:"http://net.tutsplus.com/?p=31408";s:7:"attribs";a:1:{s:0:"";a:1:{s:11:"isPermaLink";s:5:"false";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:11:"description";a:1:{i:0;a:5:{s:4:"data";s:18576:"<a
href='http://rss.buysellads.com/click.php?z=1260013&k=d754f1e9ba63a736ba8ff5ece958f7dd&a=31408&c=431502751' target='_blank'><img
src='http://rss.buysellads.com/img.php?z=1260013&k=d754f1e9ba63a736ba8ff5ece958f7dd&a=31408&c=431502751' border='0' alt='' /></a><p>Reflection is generally defined as a program&#8217;s ability to inspect itself and modify its logic at execution time. In less technical terms, reflection is asking an object to tell you about its properties and methods, and altering those members (even private ones). In this lesson, we&#8217;ll dig into how this is accomplished, and when it might prove useful.</p><p><span
id="more-31408"></span></p><hr
/><h2>A Little History</h2><p>At the dawn of the age of programming, there was the assembly language. A program written in assembly resides on physical registers inside the computer. Its composition, methods and values could be inspected at any time by reading the registers. Even more, you could alter the program while it was running by simply modifying those registers. It required some intimate knowledge about the running program, but it was inherently reflective.</p><blockquote
class="pullquote"><p>As with any cool toy, use reflection, but don&#8217;t abuse it.</p></blockquote><p>As higher-level programming languages (like C) came along, this reflectivity faded and disappeared. It was later re-introduced with object-oriented programming.</p><p>Today, most programming languages can use reflection. Statically typed languages, such as Java, have little to no problems with reflection. What I find interesting, however, is that any dynamically-typed language (like PHP or Ruby) is heavily based on reflection. Without the concept of reflection, duck-typing would most likely be impossible to implement. When you send one object to another (a parameter, for example), the receiving object has no way of knowing the structure and type of that object. All it can do is use reflection to identify the methods that can and cannot be called on the received object.</p><hr
/><h2>A Simple Example</h2><p>Reflection is prevalent in PHP. In fact, there are several situations when you may use it without even knowing it. For example:</p><pre class="brush: php; title: ; notranslate">
// Nettuts.php

require_once 'Editor.php';

class Nettuts {

	function publishNextArticle() {
		$editor = new Editor('John Doe');
		$editor-&gt;setNextArticle('135523');
		$editor-&gt;publish();
	}

}
</pre><p>And:</p><pre class="brush: php; title: ; notranslate">
// Editor.php

class Editor {

	private $name;
	public $articleId;

	function __construct($name) {
		$this-&gt;name = $name;
	}

	public function setNextArticle($articleId) {
		$this-&gt;articleId = $articleId;
	}

	public function publish() {
		// publish logic goes here
		return true;
	}

}
</pre><p>In this code, we have a direct call to a locally initialized variable with a known type. Creating the editor in <code>publishNextArticle()</code> makes it obvious that the <code>$editor</code> variable is of type <code>Editor</code>. No reflection is needed here, but let&#8217;s introduce a new class, called <code>Manager</code>:</p><pre class="brush: php; title: ; notranslate">
// Manager.php

require_once './Editor.php';
require_once './Nettuts.php';

class Manager {

	function doJobFor(DateTime $date) {
		if ((new DateTime())-&gt;getTimestamp() &gt; $date-&gt;getTimestamp()) {
			$editor = new Editor('John Doe');
			$nettuts = new Nettuts();
			$nettuts-&gt;publishNextArticle($editor);
		}
	}

}
</pre><p>Next, modify <code>Nettuts</code>, like so:</p><pre class="brush: php; title: ; notranslate">
// Nettuts.php

class Nettuts {

	function publishNextArticle($editor) {
		$editor-&gt;setNextArticle('135523');
		$editor-&gt;publish();
	}

}
</pre><p>Now, <code>Nettuts</code> has absolutely no relation to the <code>Editor</code> class. It does not include its file, it does not initialize its class and it does not even know it exists. I could pass an object of any type into the <code>publishNextArticle()</code> method and the code would work.</p> <figure
class="tutorial_image"> <img
src="http://cdn.tutsplus.com/net.tutsplus.com/authors/jeremymcpeak/php-reflection-class-diagram1.png" alt="Class Diagram" /><br
/> </figure><p>As you can see from this class diagram, <code>Nettuts</code> only has a direct relationship to <code>Manager</code>. <code>Manager</code> creates it, and therefore, <code>Manager</code> depends on <code>Nettuts</code>. But <code>Nettuts</code> no longer has any relation to the <code>Editor</code> class, and <code>Editor</code> is only related to <code>Manager</code>.</p><p>At runtime, <code>Nettuts</code> uses an <code>Editor</code> object, thus the &lt;&lt;uses&gt;&gt; and the question mark. At runtime, PHP inspects the received object and verifies that it implements the <code>setNextArticle()</code> and <code>publish()</code> methods.</p><h3>Object Member Information</h3><p>We can make PHP display the details of an object. Let&#8217;s create a PHPUnit test to help us easily exercise our code:</p><pre class="brush: php; title: ; notranslate">
// ReflectionTest.php

require_once '../Editor.php';
require_once '../Nettuts.php';

class ReflectionTest extends PHPUnit_Framework_TestCase {

	function testItCanReflect() {
		$editor = new Editor('John Doe');
		$tuts = new Nettuts();
		$tuts-&gt;publishNextArticle($editor);
	}

}
</pre><p>Now, add a <code>var_dump()</code> to <code>Nettuts</code>:</p><pre class="brush: php; title: ; notranslate">
// Nettuts.php

class NetTuts {

	function publishNextArticle($editor) {
		$editor-&gt;setNextArticle('135523');
		$editor-&gt;publish();
		var_dump(new ReflectionClass($editor));
	}

}
</pre><p>Run the test, and watch the magic happen in the output:</p><pre class="brush: xml; title: ; notranslate">PHPUnit 3.6.11 by Sebastian Bergmann.

.object(ReflectionClass)#197 (1) {
  [&quot;name&quot;]=&gt;
  string(6) &quot;Editor&quot;
}
Time: 0 seconds, Memory: 2.25Mb

OK (1 test, 0 assertions)</pre><p>Our reflection class has a <code>name</code> property set to the original type of the <code>$editor</code> variable: <code>Editor</code>, but that&#8217;s not much information. What about <code>Editor</code>&#8216;s methods?</p><pre class="brush: php; title: ; notranslate">
// Nettuts.php

class Nettuts {

	function publishNextArticle($editor) {
		$editor-&gt;setNextArticle('135523');
		$editor-&gt;publish();

		$reflector = new ReflectionClass($editor);
		var_dump($reflector-&gt;getMethods());
	}

}</pre><p>In this code, we assign the reflection class&#8217; instance to the <code>$reflector</code> variable so that we can now trigger its methods. <code>ReflectionClass</code> exposes a large set of methods that you can use to obtain an object&#8217;s information. One of these methods is <code>getMethods()</code>, which returns an array containing each method&#8217;s information.</p><pre class="brush: xml; title: ; notranslate">
PHPUnit 3.6.11 by Sebastian Bergmann.

.array(3) {
  [0]=&gt;
  &amp;object(ReflectionMethod)#196 (2) {
    [&quot;name&quot;]=&gt;
    string(11) &quot;__construct&quot;
    [&quot;class&quot;]=&gt;
    string(6) &quot;Editor&quot;
  }
  [1]=&gt;
  &amp;object(ReflectionMethod)#195 (2) {
    [&quot;name&quot;]=&gt;
    string(14) &quot;setNextArticle&quot;
    [&quot;class&quot;]=&gt;
    string(6) &quot;Editor&quot;
  }
  [2]=&gt;
  &amp;object(ReflectionMethod)#194 (2) {
    [&quot;name&quot;]=&gt;
    string(7) &quot;publish&quot;
    [&quot;class&quot;]=&gt;
    string(6) &quot;Editor&quot;
  }
}

Time: 0 seconds, Memory: 2.25Mb

OK (1 test, 0 assertions)
</pre><p>Another method, <code>getProperties()</code>, retrieves the properties (even private properties!) of the object:</p><pre class="brush: xml; title: ; notranslate">
PHPUnit 3.6.11 by Sebastian Bergmann.

.array(2) {
  [0]=&gt;
  &amp;object(ReflectionProperty)#196 (2) {
    [&quot;name&quot;]=&gt;
    string(4) &quot;name&quot;
    [&quot;class&quot;]=&gt;
    string(6) &quot;Editor&quot;
  }
  [1]=&gt;
  &amp;object(ReflectionProperty)#195 (2) {
    [&quot;name&quot;]=&gt;
    string(9) &quot;articleId&quot;
    [&quot;class&quot;]=&gt;
    string(6) &quot;Editor&quot;
  }
}

Time: 0 seconds, Memory: 2.25Mb

OK (1 test, 0 assertions)
</pre><p>The elements in the arrays returned from <code>getMethod()</code> and <code>getProperties()</code> are of type <code>ReflectionMethod</code> and <code>ReflectionProperty</code>, respectively; these objects are quite useful:</p><pre class="brush: php; title: ; notranslate">
// Nettuts.php

class Nettuts {

	function publishNextArticle($editor) {
		$editor-&gt;setNextArticle('135523');
		$editor-&gt;publish(); // first call to publish()

		$reflector = new ReflectionClass($editor);
		$publishMethod = $reflector-&gt;getMethod('publish');
		$publishMethod-&gt;invoke($editor); // second call to publish()
	}

}
</pre><p>Here, we use <code>getMethod()</code> to retrieve a single method with the name of &#8220;publish&#8221;; the result of which is a <code>ReflectionMethod</code> object. Then, we call the <code>invoke()</code> method, passing it the <code>$editor</code> object, in order to execute the editor&#8217;s <code>publish()</code> method a second time.</p><p>This process was simple in our case, because we already had an <code>Editor</code> object to pass to <code>invoke()</code>. We may have several <code>Editor</code> objects in some circumstances, giving us the luxury of choosing which object to use. In other circumstances, we may have no objects to work with, in which case we would need to obtain one from <code>ReflectionClass</code>.</p><p>Let&#8217;s modify <code>Editor</code>&#8216;s <code>publish()</code> method to demonstrate the double call:</p><pre class="brush: php; title: ; notranslate">
// Editor.php

class Editor {

	[ ... ]

	public function publish() {
		// publish logic goes here
		echo (&quot;HERE\n&quot;);
		return true;
	}

}
</pre><p>And the new output:</p><pre class="brush: xml; title: ; notranslate">
PHPUnit 3.6.11 by Sebastian Bergmann.

.HERE
HERE

Time: 0 seconds, Memory: 2.25Mb

OK (1 test, 0 assertions)
</pre><h3>Manipulating Instance Data</h3><p>We can also modify code at execution time. What about modifying a private variable that has no public setter? Let&#8217;s add a method to <code>Editor</code> that retrieves the editor&#8217;s name:</p><pre class="brush: php; title: ; notranslate">
// Editor.php

class Editor {

	private $name;
	public $articleId;

	function __construct($name) {
		$this-&gt;name = $name;
	}

	[ ... ]

	function getEditorName() {
		return $this-&gt;name;
	}

}
</pre><p>This new method is called, <code>getEditorName()</code>, and simply returns the value from the private <code>$name</code> variable. The <code>$name</code> variable is set at creation time, and we have no public methods that let us change it. But we can access this variable using reflection. You might first try the more obvious approach:</p><pre class="brush: php; title: ; notranslate">
// Nettuts.php

class Nettuts {

	function publishNextArticle($editor) {
		var_dump($editor-&gt;getEditorName());

		$reflector = new ReflectionClass($editor);
		$editorName = $reflector-&gt;getProperty('name');
		$editorName-&gt;getValue($editor);

	}

}
</pre><p>Even though this outputs the value at the <code>var_dump()</code> line, it throws an error when trying to retrieve the value with reflection:</p><pre class="brush: xml; title: ; notranslate">PHPUnit 3.6.11 by Sebastian Bergmann.

Estring(8) &quot;John Doe&quot;
Time: 0 seconds, Memory: 2.50Mb

There was 1 error:

1) ReflectionTest::testItCanReflect
ReflectionException: Cannot access non-public member Editor::name

[...]/Reflection in PHP/Source/NetTuts.php:13
[...]/Reflection in PHP/Source/Tests/ReflectionTest.php:13
/usr/bin/phpunit:46

FAILURES!
Tests: 1, Assertions: 0, Errors: 1.</pre><p>In order to fix this problem, we need to ask the <code>ReflectionProperty</code> object to grant us access to the private variables and methods:</p><pre class="brush: php; title: ; notranslate">// Nettuts.php

class Nettuts {

	function publishNextArticle($editor) {
		var_dump($editor-&gt;getEditorName());

		$reflector = new ReflectionClass($editor);
		$editorName = $reflector-&gt;getProperty('name');
		$editorName-&gt;setAccessible(true);
		var_dump($editorName-&gt;getValue($editor));
	}

}</pre><p>Calling <code>setAccessible()</code> and passing <code>true</code> does the trick:</p><pre class="brush: xml; title: ; notranslate">PHPUnit 3.6.11 by Sebastian Bergmann.

.string(8) &quot;John Doe&quot;
string(8) &quot;John Doe&quot;
Time: 0 seconds, Memory: 2.25Mb

OK (1 test, 0 assertions)</pre><p>As you can see, we&#8217;ve managed to read private variable. The first line of output is from the object&#8217;s own <code>getEditorName()</code> method, and the second comes from reflection. But what about changing a private variable&#8217;s value? Use the <code>setValue()</code> method:</p><pre class="brush: php; title: ; notranslate">// Nettuts.php

class Nettuts {

	function publishNextArticle($editor) {
		var_dump($editor-&gt;getEditorName());

		$reflector = new ReflectionClass($editor);
		$editorName = $reflector-&gt;getProperty('name');
		$editorName-&gt;setAccessible(true);
		$editorName-&gt;setValue($editor, 'Mark Twain');
		var_dump($editorName-&gt;getValue($editor));
	}

}</pre><p>And that&#8217;s it. This code changes &#8220;John Doe&#8221; to &#8220;Mark Twain&#8221;.</p><pre class="brush: xml; title: ; notranslate">PHPUnit 3.6.11 by Sebastian Bergmann.

.string(8) &quot;John Doe&quot;
string(10) &quot;Mark Twain&quot;
Time: 0 seconds, Memory: 2.25Mb

OK (1 test, 0 assertions)</pre><hr
/><h2>Indirect Reflection Use</h2><p>Some of PHP&#8217;s built-in functionality indirectly uses reflection&mdash;one being the <code>call_user_func()</code> function.</p><h3>The Callback</h3><p>The <code>call_user_func()</code> function accepts an array: the first element pointing to an object, and the second a method&#8217;s name. You can supply an optional parameter, which is then passed to the called method. For example:</p><pre class="brush: php; title: ; notranslate">
// Nettuts.php

class Nettuts {

	function publishNextArticle($editor) {
		var_dump($editor-&gt;getEditorName());

		$reflector = new ReflectionClass($editor);
		$editorName = $reflector-&gt;getProperty('name');
		$editorName-&gt;setAccessible(true);
		$editorName-&gt;setValue($editor, 'Mark Twain');
		var_dump($editorName-&gt;getValue($editor));

		var_dump(call_user_func(array($editor, 'getEditorName')));
	}

}
</pre><p>The following output demonstrates that the code retrieves the proper value:</p><pre class="brush: xml; title: ; notranslate">PHPUnit 3.6.11 by Sebastian Bergmann.

.string(8) &quot;John Doe&quot;
string(10) &quot;Mark Twain&quot;
string(10) &quot;Mark Twain&quot;
Time: 0 seconds, Memory: 2.25Mb

OK (1 test, 0 assertions)</pre><h3>Using a Variable&#8217;s Value</h3><p>Another example of indirect reflection is calling a method by the value contained within a variable, as opposed to directly calling it. For example:</p><pre class="brush: php; title: ; notranslate">
// Nettuts.php

class Nettuts {

	function publishNextArticle($editor) {
		var_dump($editor-&gt;getEditorName());

		$reflector = new ReflectionClass($editor);
		$editorName = $reflector-&gt;getProperty('name');
		$editorName-&gt;setAccessible(true);
		$editorName-&gt;setValue($editor, 'Mark Twain');
		var_dump($editorName-&gt;getValue($editor));

		$methodName = 'getEditorName';
		var_dump($editor-&gt;$methodName());
	}

}
</pre><p>This code produces the same output as the previous example. PHP simply replaces the variable with the string it represents and calls the method. It even works when you want to create objects by using variables for class names.</p><hr
/><h2>When Should We Use Reflection?</h2><p>Now that we&#8217;ve put the technical details behind us, when should we leverage reflection? Here are a few scenarios:</p><ul><li><strong>Dynamic typing</strong> is probably impossible without reflection.</li><li><strong>Aspect Oriented Programming</strong> listens from method calls and places code around methods, all accomplished with reflection.</li><li><strong>PHPUnit</strong> relies heavily on reflection, as do other mocking frameworks.</li><li><strong>Web frameworks</strong> in general use reflection for different purposes. Some use it to initialize models, constructing objects for views and more. Laravel makes heavy use of reflection to inject dependencies.</li><li><strong>Metaprogramming</strong>, like our last example, is hidden reflection.</li><li><strong>Code analysis frameworks</strong> use reflection to understand your code.</li></ul><hr
/><h2>Final Thoughts</h2><p>As with any cool toy, use reflection, but don&#8217;t abuse it. Reflection is costly when you inspect many objects, and it has the potential to complicate your project&#8217;s architecture and design. I recommend that you make use of it only when it actually gives you an advantage, or when you have no other viable option.</p><p>Personally, I&#8217;ve only used reflection in a few instances, most commonly when using third party modules that lack documentation. I find myself frequently using code similar to the last example. It&#8217;s easy to call the proper method, when your MVC responds with a variable containing &#8220;add&#8221; or &#8220;remove&#8221; values.</p><p>Thanks for reading!</p><div class="feedflare">
<a href="http://feeds.feedburner.com/~ff/nettuts?a=eUw_aN38rD8:la2MqgJF9Rw:yIl2AUoC8zA"><img src="http://feeds.feedburner.com/~ff/nettuts?d=yIl2AUoC8zA" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=eUw_aN38rD8:la2MqgJF9Rw:F7zBnMyn0Lo"><img src="http://feeds.feedburner.com/~ff/nettuts?i=eUw_aN38rD8:la2MqgJF9Rw:F7zBnMyn0Lo" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=eUw_aN38rD8:la2MqgJF9Rw:V_sGLiPBpWU"><img src="http://feeds.feedburner.com/~ff/nettuts?i=eUw_aN38rD8:la2MqgJF9Rw:V_sGLiPBpWU" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=eUw_aN38rD8:la2MqgJF9Rw:gIN9vFwOqvQ"><img src="http://feeds.feedburner.com/~ff/nettuts?i=eUw_aN38rD8:la2MqgJF9Rw:gIN9vFwOqvQ" border="0"></img></a> <a href="http://feeds.feedburner.com/~ff/nettuts?a=eUw_aN38rD8:la2MqgJF9Rw:TzevzKxY174"><img src="http://feeds.feedburner.com/~ff/nettuts?d=TzevzKxY174" border="0"></img></a>
</div><img src="http://feeds.feedburner.com/~r/nettuts/~4/eUw_aN38rD8" height="1" width="1"/>";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:32:"http://purl.org/dc/elements/1.1/";a:1:{s:7:"creator";a:1:{i:0;a:5:{s:4:"data";s:12:"Patkos Csaba";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:36:"http://wellformedweb.org/CommentAPI/";a:1:{s:10:"commentRss";a:1:{i:0;a:5:{s:4:"data";s:61:"http://net.tutsplus.com/tutorials/php/reflection-in-php/feed/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:38:"http://purl.org/rss/1.0/modules/slash/";a:1:{s:8:"comments";a:1:{i:0;a:5:{s:4:"data";s:2:"24";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:1:{s:8:"origLink";a:1:{i:0;a:5:{s:4:"data";s:56:"http://net.tutsplus.com/tutorials/php/reflection-in-php/";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}}}s:44:"http://purl.org/rss/1.0/modules/syndication/";a:2:{s:12:"updatePeriod";a:1:{i:0;a:5:{s:4:"data";s:6:"hourly";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:15:"updateFrequency";a:1:{i:0;a:5:{s:4:"data";s:1:"1";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:27:"http://www.w3.org/2005/Atom";a:1:{s:4:"link";a:2:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:3:{s:3:"rel";s:4:"self";s:4:"type";s:19:"application/rss+xml";s:4:"href";s:35:"http://feeds.feedburner.com/nettuts";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}i:1;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:2:{s:3:"rel";s:3:"hub";s:4:"href";s:32:"http://pubsubhubbub.appspot.com/";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}s:42:"http://rssnamespace.org/feedburner/ext/1.0";a:3:{s:4:"info";a:1:{i:0;a:5:{s:4:"data";s:0:"";s:7:"attribs";a:1:{s:0:"";a:1:{s:3:"uri";s:7:"nettuts";}}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:14:"emailServiceId";a:1:{i:0;a:5:{s:4:"data";s:7:"nettuts";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}s:18:"feedburnerHostname";a:1:{i:0;a:5:{s:4:"data";s:28:"http://feedburner.google.com";s:7:"attribs";a:0:{}s:8:"xml_base";s:0:"";s:17:"xml_base_explicit";b:0;s:8:"xml_lang";s:0:"";}}}}}}}}}}}}s:4:"type";i:128;s:7:"headers";a:10:{s:12:"content-type";s:23:"text/xml; charset=UTF-8";s:4:"etag";s:27:"95P5y+D9f0pP2w5YvI3vWwQwQpc";s:13:"last-modified";s:29:"Sun, 05 May 2013 15:25:03 GMT";s:16:"content-encoding";s:4:"gzip";s:4:"date";s:29:"Sun, 05 May 2013 15:46:08 GMT";s:7:"expires";s:29:"Sun, 05 May 2013 15:46:08 GMT";s:13:"cache-control";s:18:"private, max-age=0";s:22:"x-content-type-options";s:7:"nosniff";s:16:"x-xss-protection";s:13:"1; mode=block";s:6:"server";s:3:"GSE";}s:5:"build";s:14:"20121030175911";}