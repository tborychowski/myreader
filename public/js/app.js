window.App=function(t,e){"use strict";var n=(e.rootPath||"")+"/json/",r=function(t,n){return"object"!=typeof t?e.Error("Server response error"):t&&"error"===t.result?e.Error(t):(t&&"warning"===t.result&&e.Error(t),void(n&&"function"==typeof n&&n.call(n,t)))};return e.Get=function(a,i,s,o){var u={url:n+a,type:"get",data:i};return"number"==typeof s&&(o=s),"function"==typeof i&&(s=i,i={}),o&&(u.timeout=o),t.ajax(u).fail(e.Error).done(function(t){r(t,s)})},e.Post=function(a,i,s){var o={url:n+a,type:"post",data:JSON.stringify(i)};return"function"==typeof i&&(s=i,i={}),t.ajax(o).fail(e.Error).done(function(t){r(t,s)})},e.Put=function(a,i,s){var o={url:n+a,type:"put",data:JSON.stringify(i)};return"function"==typeof i&&(s=i,i={}),t.ajax(o).fail(e.Error).done(function(t){r(t,s)})},e.Delete=function(a,i){var s={url:n+a,type:"delete"};return t.ajax(s).fail(e.Error).done(function(t){r(t,i)})},e}(jQuery,window.App||{},this),function(){"use strict";String.prototype.trim=function(t){return this.ltrim(t).rtrim(t)},String.prototype.ltrim=function(t){return this.replace(new RegExp("^"+(t?t:"\\s")+"+"),"")},String.prototype.rtrim=function(t){return this.replace(new RegExp((t?t:"\\s")+"+$"),"")},String.prototype.ucfirst=function(){return this.toLowerCase().replace(/\b([a-z])/gi,function(t){return t.toUpperCase()})},String.prototype.stripTags=function(){for(var t=new RegExp("<\\/?\\w+(\\s*[^>])*>"),e=this;t.test(e);)e=e.replace(t,"");return e},Object.keys||(Object.keys=function(){var t=Object.prototype.hasOwnProperty,e=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],r=n.length;return function(a){if("object"!=typeof a&&"function"!=typeof a||null===a)throw new TypeError("Object.keys called on non-object");var i,s=[],o=0;for(i in a)t.call(a,i)&&s.push(i);if(e)for(;r>o;o++)t.call(a,n[o])&&s.push(n[o]);return s}}())}(this),window.App=function(t){"use strict";var e={};return t.Publish=function(t,n){if(e[t])for(var r,a=0;r=e[t][a++];)r.fn.apply(r.scope,n||[])},t.Subscribe=function(t,n,r){return e[t]||(e[t]=[]),e[t].push({fn:n,scope:r||n}),[t,n,r]},t.Unsubscribe=function(t){var n,r=0,a=t[0];if(e[a])for(;n=e[a][r];r++)n.fn==t[1]&&e[a].splice(r,1)},t}(window.App||{}),window.App=function(t,e){"use strict";return t.Storage={get:function(t,n){if(n=(n||"session")+"Storage",!e[n])return e.log("Browser does not support "+n+"!");var r=e[n][t];return r?JSON.parse(r):void 0},set:function(t,n,r){return r=(r||"session")+"Storage",e[r]?void(e[r][t]=JSON.stringify(n)):e.log("Browser does not support "+r+"!")},del:function(t,n){return n=(n||"session")+"Storage",e[n]?void(e[n][t]&&delete e[n][t]):e.log("Browser does not support "+n+"!")}},t}(window.App||{},this),window.App=function(t,e){"use strict";return t.UTIL={isTouch:/iPhone|iPod|iPad/gi.test(navigator.userAgent),isIE:function(t,e,n){var r=e.getElementsByTagName("br");do e.innerHTML="<!--[if gt IE "+ ++t+"]><br><![endif]-->";while(r[0]);return t>4?t:n}(3,document.createElement("p"),!1),getType:function(t){return t?Object.prototype.toString.call(t).slice(8,-1).toLowerCase():"undefined"},objToUrl:function(t){if("object"!==this.getType(t))return"";var n=null,r=[];for(n in t)t.hasOwnProperty(n)&&r.push(e.escape(n)+"="+e.escape(t[n]));return r.join("&")},urlToObj:function(t,n){if(!t||!t.length)return{};for(var r={},a=t.replace(/^\?/,"").split("&"),i=null,s=0,o=null,u=null,c=null;o=a[s++];)i=o.split("="),u=e.unescape(i[0]),c=e.unescape(i[1]),c.indexOf(",")>-1&&(c=c.split(",")),n&&(c=this.varToRealType(c)),void 0===r[u]?r[u]=c:"string"==typeof r[u]||"number"==typeof r[u]?r[u]=[r[u],c]:r[u].push(c);return r},getParam:function(t,e,n){var r=this.urlToObj(e||location.search,n);return void 0!==r[t]?r[t]:!1},isNumber:function(t){return"number"==typeof t?!0:"string"!=typeof t?!1:/^[\-+]?[0-9]*\.?[0-9]+([eE][\-+]?[0-9]+)?$/.test(t)},varToRealType:function(t){if(this.isNumber(t)){var e=t;t=parseFloat(""+t),""+t!==e&&(t=e)}else"true"===t?t=!0:"false"===t&&(t=!1);if(""===t&&(t=void 0),"array"===this.getType(t))for(var n=0,r=t.length;r>n;n++)t[n]=this.varToRealType(t[n]);return t},areObjectsEqual:function(t,e){if(t===e)return!0;if(!(t instanceof Object&&e instanceof Object))return!1;if(t.constructor!==e.constructor)return!1;for(var n in t)if(t.hasOwnProperty(n)){if(!e.hasOwnProperty(n))return!1;if(t[n]!==e[n]){if("object"!=typeof t[n])return!1;if(!this.areObjectsEqual(t[n],e[n]))return!1}}for(n in e)if(e.hasOwnProperty(n)&&!t.hasOwnProperty(n))return!1;return!0},isObjectEmpty:function(t){if(!t||"object"!=typeof t)return!0;for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},clearProperties:function(){if(arguments.length<1)return{};var t,e=arguments[0],n={},r="",a=[];arguments.length>1&&(a=Array.prototype.slice.call(arguments,1));for(r in e)e.hasOwnProperty(r)&&(t=e[r],void 0!==t&&null!==t&&("array"!==this.getType(t)||t.length)&&("object"===this.getType(t)&&this.isObjectEmpty(t)||("string"!=typeof t||t.length)&&(this.inArray(a,r)>-1||(n[r]=t))));return n},numberFormat:function(t,e){var n,r,a,i=/(\d+)(\d{3})/;for(t=t||"0",e=e||0,a=(""+t).split("."),r=a[0],n=a[1],n=e>0?((n||"")+new Array(e+1).join("0")).substr(0,e):"";i.test(r);)r=r.replace(i,"$1,$2");return r+(n?"."+n:"")},rand:function(t,e){return e=e||0,Math.floor(Math.random()*(t-e+1)+e)},inArray:function(t,e){if("array"!==this.getType(t))return!1;var n,r=0;if("object"==typeof e){for(r=0;n=t[r++];)if(this.areObjectsEqual(n,e))return r-1}else for(r=0;n=t[r++];)if(n===e)return r-1;return-1},removeFromArray:function(t,e){var n,r=[],a=0;if("object"==typeof e)for(;n=t[a++];)this.areObjectsEqual(n,e)||r.push(n);else for(;n=t[a++];)n!==e&&r.push(n);return r},uniqueArray:function(t){for(var e,n=[],r=t.length,a=0;r>a;a++){for(e=a+1;r>e;e++)"object"==typeof t[a]&&this.areObjectsEqual(t[a],t[e])?e=++a:t[a]===t[e]&&(e=++a);n.push(t[a])}return n},stripTags:function(t){for(var e=new RegExp("<\\/?\\w+(\\s*[^>])*>");e.test(t);)t=t.replace(e,"");return t},decodeEntities:function(t){if(!t)return"";if(-1===(""+t).indexOf("&"))return t;var e=document.createElement("div");return this.isIE&&(t=t.replace(/&apos;/g,"&#39")),e.innerHTML=t,e.innerText||e.textContent}},t}(window.App||{},this),window.App=function(t,e,n){"use strict";return e.Msg=function(t,e){console.log(t,e),t&&"error"===t.type&&n.alert(t.text)},e.Error=function(t){if(t)if("string"==typeof t)e.Msg({type:"error",text:t});else{if((404===t.status||400===t.status)&&e.Msg("Requested service not available","error"),"abort"===t.statusText)return;t.details?e.Msg({type:"warning"===t.result?"warning":"error",text:t.details,delay:5}):e.Msg("Unknown server error.","error")}else e.Msg("Unknown server error.","error");return!1},t(function(){e.Publish("app/ready"),t("body").delay("1000").animate({scrollTop:0},0)}),e}(jQuery,window.App||{},this),function(t,e,n){"use strict";var r=null,a=function(){return e.Post("login",r.formParams(),function(t){"success"===t.result&&(location.href="./")}),!1},i=function(){if("login"===n.document.body.parentNode.className){if(r=t("form:first"),!r.length)return;r.on("submit",a)}};e.Subscribe("app/ready",i)}(jQuery,window.App,this),function(t,e){"use strict";var n=null,r=null,a=!1,i=[],s=null,o=200,u={},c=0,l=function(e){var n=t(this),r=n.data("action"),a=n.closest(".entry"),i=w(a.data("id"));"toggle-expand"===r&&v(i,a),"toggle-star"===r&&f(i,a),"toggle-unread"===r?p(i,a):(i.is_unread=!0,p(i,a)),e.stopPropagation()},d=function(t){t.preventDefault(),c++,S(u)},f=function(t,n){t||n||(n=r.find(".entry.active"),n.length||(n=r.find(".entry").first().addClass("active")),n.length&&(t=w(n.data("id")))),t&&n.length&&(t.is_starred=!t.is_starred,n.toggleClass("starred",t.is_starred),e.Put("items/"+t.id,{is_starred:t.is_starred},function(){e.Publish("nav/refresh")}))},p=function(t,n){t||n||(n=r.find(".entry.active"),n.length||(n=r.find(".entry").first().addClass("active")),n.length&&(t=w(n.data("id")))),t&&n.length&&(t.is_unread=!t.is_unread,n.toggleClass("unread",t.is_unread),e.Put("items/"+t.id,{is_unread:t.is_unread},function(){e.Publish("nav/refresh")}))},h=function(n){e.Put("items?"+t.param(n),{is_unread:!1},function(){e.Publish("nav/refresh",[{status:n.status,src:null,tag:null}])})},v=function(t,e){var n,r=e.find(".entry-body"),a=e.hasClass("expanded");a?(n=r.height(),n>o?(r.animate({height:o},function(){r.css({maxHeight:o,height:"auto"}),e.removeClass("expanded")}),m(e)):r.css({maxHeight:o})):(r.css("max-height","inherit"),n=r.height(),n>o&&r.height(o).animate({height:n},function(){e.addClass("expanded")}))},g=function(){var t,e=r.find(".entry.active");e&&e.length&&(t=e.prev(".entry"),t.length&&(e.removeClass("active"),m(t.addClass("active"))))},b=function(){var t,e,n=r.find(".entry.active");t=n&&n.length?n.next(".entry"):r.find(".entry").first(),t.length&&m(t,function(){n.length&&n.removeClass("active"),t.addClass("active"),e=w(t.data("id")),e.is_unread=!0,p(e,t)})},y=function(){var n=t(this);n.hasClass("active")?n.hasClass("unread")&&p():(n.siblings().removeClass("active"),n.prev().addClass("active"),e.Publish("nav/next"))},m=function(t,e){var a,i="fast";t&&t.length||(i=0,t=t||r.find(".entry").first()),a=t[0].offsetTop,n.animate({scrollTop:a},i),setTimeout(e||function(){},i)},w=function(t){for(var e,n=0;e=i[n++];)if(e.id===t)return e;return null},P=function(){return'<a href="#" class="load-more-items"><i class="icon-download"></i> load more...</a>'},j=function(t){var e=["entry"];return 1===t.is_unread&&e.push("unread"),1===t.is_starred&&e.push("starred"),'<div id="entry'+t.id+'" class="'+e.join(" ")+'" data-id="'+t.id+'"><div class="entry-header"><span class="entry-time">'+t.datetime+'</span><h3><a href="'+t.url+'" target="_blank">'+t.title+'</a></h3><span class="entry-source">from <a href="http://'+t.source.real_url+'" class="entry-source entry-source-'+t.source.id+'">'+t.source.name+'</a></span></div><div class="entry-body">'+t.content+'</div><div class="entry-footer"><div class="pull-right"><span class="tb-btn btn-expand expand" data-action="toggle-expand" title="Expand"><i class="icon-double-angle-down"></i></span><span class="tb-btn btn-expand collapse" data-action="toggle-expand" title="Collapse"><i class="icon-double-angle-up"></i></span></div><span class="tb-btn addstar" data-action="toggle-star" title="Star Item (s)"><i class="icon-star-empty"></i></span><span class="tb-btn unstar" data-action="toggle-star" title="Unstar Item (s)"><i class="icon-star"></i></span><span class="tb-btn mark-unread" data-action="toggle-unread" title="Mark as Unread (u)"><i class="icon-ok-sign"></i>mark as unread</span><span class="tb-btn mark-read" data-action="toggle-unread" title="Mark as Read (u)"><i class="icon-ok-circle"></i>mark as read</span></div></div>'},x=function(t){if(!t||!t.length)return s.removeClass("icon-spin"),r.html("");for(var e,n=0,a=[];e=t[n++];)a.push(j(e));20===t.length&&a.push(P()),c?(r.find(".load-more-items").remove(),r.append(a),i=i.concat(t)):(r.html(a),i=t,m()),s.removeClass("icon-spin"),o=parseInt(r.find(".entry .entry-body").first().css("max-height"),10)},S=function(n){a&&n&&(s.addClass("icon-spin"),e.UTIL.areObjectsEqual(u,n)||(u=n,c=0),c&&(n.page=c),e.Get("items?"+t.param(n),x))},C=function(){a||(r=t("body.main .main-wrapper"),r.length&&(n=t("body.main #main"),s=t("#toolbar .icon-repeat"),t(document).on("click",function(e){if(1===e.button){var n=t(e.target);n.is(".entry a")&&y.call(n.closest(".entry")[0])}}),r.on("click",".entry",y).on("click",".tb-btn",l).on("click",".load-more-items",d),a=!0))};e.Subscribe("entry/allread",h),e.Subscribe("entry/toggleStar",f),e.Subscribe("entry/toggleUnread",p),e.Subscribe("nav/next",b),e.Subscribe("nav/prev",g),e.Subscribe("nav/refresh",S),e.Subscribe("app/ready",C)}(jQuery,window.App,this),function(t,e,n){"use strict";var r=null,a=null,i=null,s=!1,o={status:"unread"},u=null,c=function(){var t=n.location.hash.substr(1);t.length&&(t=t.split("/"),t[0]&&(o.status=t[0]),t[1]&&t[2]&&("tag"===t[1]&&(o.tag=t[2]),"src"===t[1]&&(o.src=t[2]))),e.Publish("nav/refresh",[o])},l=function(t){var n=t.keyCode;83===n?e.Publish("entry/toggleStar"):85===n?e.Publish("entry/toggleUnread"):82===n?e.Publish("nav/refresh",[o]):32===n?e.Publish("nav/next"):33===n?e.Publish("nav/prev"):34===n&&e.Publish("nav/next")},d=function(){var r=t(this),a=r.data("action");"next"===a&&e.Publish("nav/next"),"prev"===a&&e.Publish("nav/prev"),"refresh"===a&&e.Publish("nav/refresh",[o]),"unread"===a&&p({status:"unread"}),"starred"===a&&p({status:"starred"}),"archive"===a&&p({status:"archive"}),"all-read"===a&&e.Publish("entry/allread",[o]),"add"===a&&e.Publish("source/add"),"settings"===a&&(n.location.href=e.rootPath+"/settings"),"logout"===a&&(n.location.href=e.rootPath+"/logout"),"back"===a&&(n.location.href=e.rootPath)},f=function(e){e.preventDefault();var n=t(this),r=n.data("navType"),a=n.data("action");o={status:o.status},"unread"===r&&(o.status="unread"),"tag"===r&&(o.tag=a),"src"===r&&(o.src=a),p()},p=function(r){r&&t.extend(o,r);var a,i=[o.status],s=n.location.hash.substr(1);o.tag?i.push("tag",o.tag):o.src&&i.push("src",o.src),a=i.join("/"),a!==s?n.location.hash=a:e.Publish("nav/refresh",[o])},h=function(){r.find(".nav-btn").removeClass("active"),o.tag?i.find(".nav-"+o.tag).addClass("active"):o.src?i.find(".nav-"+o.src).addClass("active"):r.find(".nav-header").addClass("active"),a.find(".status-buttons .btn-"+o.status).addClass("active").siblings(".btn").removeClass("active")},v=function(t){"undefined"!=typeof t&&(u=t);for(var e,n,r,a,s=0,o=i.find(".nav-source");e=u[s++];)if(e.items)for(r=0;n=e.items[r++];)a=o.filter(".nav-"+n.id),n.unread?a.show().find(".no-badge").html(n.unread):a.hide().find(".no-badge").html("");h()},g=function(t){r.find(".nav-header .badge").html(t.unread),a.find(".btn-unread .badge").html(t.unreadStr),a.find(".btn-starred .badge").html(t.starredStr),a.find(".btn-archive .badge").html(t.allStr),document.title="MyReader"+(t.unread>0?" ("+t.unread+")":"")},b=function(){i.length&&e.Get("stats",g)},y=function(n){s&&(t.extend(o,n),i.length&&e.Get("sourcetree?"+t.param(o),v),b())},m=function(){s||(r=t("#sidebar"),a=t("#mainToolbar, #sideToolbar"),(r.length||a.length)&&(r.length&&(i=r.find(".sidebar-sources")),n.onpopstate=c,t(document).on("keydown",l),a.on("click",".btn",d),r.on("click",".nav-btn",f),"#"===n.location.hash&&(n.location.hash="unread"),c(),s=!0))};e.Subscribe("app/ready",m),e.Subscribe("nav/refresh",y)}(jQuery,window.App,this),function(t,e){"use strict";var n=null,r=null,a=null,i=!1,s=[],o=function(){var e=t(this).closest(".entry"),n=v(e.data("id"));d(e,n)},u=function(e){var n=t(this),r=n.data("action"),a=n.closest(".entry"),i=v(a.data("id"));e.stopPropagation(),"edit"===r?d(a,i):"remove"===r?h(a,i):"cancel"===r?f(a,i):"save"===r?p(a,i):"update-all"===r&&P(n)},c=function(t){var e=t.keyCode,r=n.find(".entry.in-edit").first(),a=v(r.data("id"));27===e?f(r,a):13===e&&p(r,a)},l=function(){n.find(".new-item").length||n.prepend(y()),n.find('.in-edit input[name="url"]').focus()},d=function(t,e){t.replaceWith(y(e)),n.find('.in-edit input[name="url"]').focus()},f=function(t,e){e?t.replaceWith(b(e)):t.remove()},p=function(n,r){var a=n.find("form"),i=a.formParams(!0);r?t.extend(r,i):r=i,r.id?e.Put("sources/"+r.id,i,function(){f(n,r)}):e.Post("sources",i,function(e){t.extend(r,e),s.push(r),f(n,r)})},h=function(t,n){window.confirm("Are you sure you want to remove: "+n.name)&&e.Delete("sources/"+n.id,function(r){"success"===r.result&&(t.remove(),s=e.UTIL.removeFromArray(s,n))})},v=function(t){for(var e,n=0;e=s[n++];)if(e.id===t)return e;return null},g=function(t,e){var n=t.find("i").addClass("icon-spin"),r=t.find("span");e?(n.addClass("icon-spin"),r.html("Cancel update")):(n.removeClass("icon-spin"),r.html("Update now"))},b=function(t){return t=t||{},t.created_at&&t.created_at.date&&(t.created_at=t.created_at.date),t.updated_at&&t.updated_at.date&&(t.updated_at=t.updated_at.date),'<div class="entry" data-id="'+(t.id||"")+'"><div class="entry-header"><h3>'+(t.icon?'<img src="img/favicons/'+t.id+'.png"> ':"")+(t.name||"")+(t.tag?" &lt;"+t.tag+"&gt;":"")+'</h3><span class="entry-source">'+(t.url||"")+"</span></div>"+(t.last_error?'<div class="entry-body"><p class="error">'+t.last_error+"</p></div>":"")+'<div class="entry-footer"><span class="pull-right entry-time">updated: '+(t.updated_at||"")+'</span><span class="tb-btn btn-remove" data-action="remove"><i class="icon-trash"></i> Remove</span><span class="tb-btn btn-edit"   data-action="edit"><i class="icon-pencil"></i> Edit</span></div></div>'},y=function(t){return t=t||{},'<div class="entry in-edit '+(t.id?"":"new-item")+'" data-id="'+(t.id||"")+'"><form><div class="entry-header"><span class="entry-source"><input name="url" value="'+(t.url||"")+'" placeholder="url"></span><h3><input name="name" value="'+(t.name||"")+'" placeholder="name"><input name="tag" value="'+(t.tag||"")+'" placeholder="tag"></h3></div><div class="entry-footer"><span class="pull-right entry-time">added: '+(t.created_at||"")+'</span><span class="tb-btn btn-save"   data-action="save"><i class="icon-save"></i> Save</span><span class="tb-btn btn-cancel" data-action="cancel"><i class="icon-remove"></i> Cancel</span></div></form></div>'},m=function(t){if(t&&t.length){s=t;for(var e,r=0,a=[];e=s[r++];)a.push(b(e));n.html(a.join(""))}},w=function(){e.Get("sources",m)},P=function(t){return g(t,!0),a?a.abort():void(a=e.Get("update",function(e){g(t);var n="Update error!";"success"===e.result&&(n=e.feeds+" feeds updated\n"+e.items+" new items found\n"+e.removed+" old items removed"),window.alert(n)},2e4).always(function(){a=null,g(t)}))},j=function(){i||(n=t("body.settings .main-wrapper"),r=t("body.settings #sidebar"),n.length&&(n.on("click",".tb-btn",u),n.on("dblclick",".entry",o),r.on("click",".btn",u),t(document).on("keydown",c),w(),i=!0))};e.Subscribe("source/add",l),e.Subscribe("app/ready",j)}(jQuery,window.App,this);